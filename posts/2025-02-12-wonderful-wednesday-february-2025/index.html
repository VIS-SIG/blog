<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  { color: #00769e; background-color: #f1f3f5; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span { color: #00769e; } /* Normal */
code span.al { color: #ad0000; } /* Alert */
code span.an { color: #5e5e5e; } /* Annotation */
code span.at { color: #657422; } /* Attribute */
code span.bn { color: #ad0000; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #00769e; } /* ControlFlow */
code span.ch { color: #20794d; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #5e5e5e; } /* Comment */
code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
code span.dt { color: #ad0000; } /* DataType */
code span.dv { color: #ad0000; } /* DecVal */
code span.er { color: #ad0000; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #ad0000; } /* Float */
code span.fu { color: #4758ab; } /* Function */
code span.im { } /* Import */
code span.in { color: #5e5e5e; } /* Information */
code span.kw { color: #00769e; } /* Keyword */
code span.op { color: #5e5e5e; } /* Operator */
code span.ot { color: #00769e; } /* Other */
code span.pp { color: #ad0000; } /* Preprocessor */
code span.sc { color: #5e5e5e; } /* SpecialChar */
code span.ss { color: #20794d; } /* SpecialString */
code span.st { color: #20794d; } /* String */
code span.va { color: #111111; } /* Variable */
code span.vs { color: #20794d; } /* VerbatimString */
code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
</style>


  <!--radix_placeholder_meta_tags-->
<title>VIS-SIG Blog: Wonderful Wednesdays February 2025 (59)</title>

<meta property="description" itemprop="description" content="It is a real challenge to display adverse event data. There are a lot of different aspects to concentrate on. How this can be approached?"/>

<link rel="canonical" href="https://graphicsprinciples.github.io/posts/2025-02-12-wonderful-wednesday-february-2025/"/>

<!--  https://schema.org/Article -->
<meta property="article:published" itemprop="datePublished" content="2025-02-12"/>
<meta property="article:created" itemprop="dateCreated" content="2025-02-12"/>
<meta name="article:author" content="PSI VIS SIG"/>

<!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
<meta property="og:title" content="VIS-SIG Blog: Wonderful Wednesdays February 2025 (59)"/>
<meta property="og:type" content="article"/>
<meta property="og:description" content="It is a real challenge to display adverse event data. There are a lot of different aspects to concentrate on. How this can be approached?"/>
<meta property="og:url" content="https://graphicsprinciples.github.io/posts/2025-02-12-wonderful-wednesday-february-2025/"/>
<meta property="og:image" content="https://graphicsprinciples.github.io/posts/2025-02-12-wonderful-wednesday-february-2025/./images/Fig5_bmkrs-ThomasWeissensteiner.png"/>
<meta property="og:image:width" content="800"/>
<meta property="og:image:height" content="800"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:site_name" content="VIS-SIG Blog"/>

<!--  https://dev.twitter.com/cards/types/summary -->
<meta property="twitter:card" content="summary_large_image"/>
<meta property="twitter:title" content="VIS-SIG Blog: Wonderful Wednesdays February 2025 (59)"/>
<meta property="twitter:description" content="It is a real challenge to display adverse event data. There are a lot of different aspects to concentrate on. How this can be approached?"/>
<meta property="twitter:url" content="https://graphicsprinciples.github.io/posts/2025-02-12-wonderful-wednesday-february-2025/"/>
<meta property="twitter:image" content="https://graphicsprinciples.github.io/posts/2025-02-12-wonderful-wednesday-february-2025/./images/Fig5_bmkrs-ThomasWeissensteiner.png"/>
<meta property="twitter:image:width" content="800"/>
<meta property="twitter:image:height" content="800"/>

<!--  https://scholar.google.com/intl/en/scholar/inclusion.html#indexing -->
<meta name="citation_title" content="VIS-SIG Blog: Wonderful Wednesdays February 2025 (59)"/>
<meta name="citation_fulltext_html_url" content="https://graphicsprinciples.github.io/posts/2025-02-12-wonderful-wednesday-february-2025/"/>
<meta name="citation_online_date" content="2025/02/12"/>
<meta name="citation_publication_date" content="2025/02/12"/>
<meta name="citation_author" content="PSI VIS SIG"/>
<!--/radix_placeholder_meta_tags-->
  <!--radix_placeholder_rmarkdown_metadata-->

<script type="text/json" id="radix-rmarkdown-metadata">
{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","description","author","date","categories","base_url","preview","output","citation_url","canonical_url"]}},"value":[{"type":"character","attributes":{},"value":["Wonderful Wednesdays February 2025 (59)"]},{"type":"character","attributes":{},"value":["It is a real challenge to display adverse event data. There are a lot of different aspects to concentrate on. How this can be approached?"]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","url"]}},"value":[{"type":"character","attributes":{},"value":["PSI VIS SIG"]},{"type":"character","attributes":{},"value":["https://www.psiweb.org/sigs-special-interest-groups/visualisation"]}]}]},{"type":"character","attributes":{},"value":["02-12-2025"]},{"type":"character","attributes":{},"value":["Adverse events","Biomarker","Wonderful Wednesdays"]},{"type":"character","attributes":{},"value":["https://vis-sig.github.io/blog"]},{"type":"character","attributes":{},"value":["./images/Fig5_bmkrs-ThomasWeissensteiner.png"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["distill::distill_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["self_contained"]}},"value":[{"type":"logical","attributes":{},"value":[false]}]}]},{"type":"character","attributes":{},"value":["https://graphicsprinciples.github.io/posts/2025-02-12-wonderful-wednesday-february-2025/"]},{"type":"character","attributes":{},"value":["https://graphicsprinciples.github.io/posts/2025-02-12-wonderful-wednesday-february-2025/"]}]}
</script>
<!--/radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-resource-manifest">
  {"type":"character","attributes":{},"value":["code/1_AE-vis_weiquan.R","code/2_AE-vis_weiquan.R","code/3_AE-Thomas-Weissensteiner.Rmd","images/1_adae_tte_Wei_Quan.jpg","images/2_adae_cor_Wei_Quan.jpg","images/Fig1_sevAE_organSys_drugRel-ThomasWeissensteiner.png","images/Fig2_srsAE_organSys_drugRel-ThomasWeissensteiner.png","images/Fig2b_srsAE_organSys_sex-ThomasWeissensteiner.png","images/Fig3_patientMax_orgSys_drugRel_sex-ThomasWeissensteiner.png","images/Fig4_patientMax_orgSys_drugRel_race-ThomasWeissensteiner.png","images/Fig5_bmkrs-ThomasWeissensteiner.png","images/Fig6_patientMax_orgSys_drugRel_bmrkr1-ThomasWeissensteiner.png","images/Fig6_patientMax_orgSys_drugRel_bmrkr2-ThomasWeissensteiner.png","images/Fig7_patientMax_orgSys_drugRel_bmrkr1-ThomasWeissensteiner.png","images/Fig7_patientMax_orgSys_drugRel_bmrkr2-ThomasWeissensteiner.png","images/Fig8_fatalAE_dthCaus-ThomasWeissensteiner.png"]}
  </script>
  <!--radix_placeholder_navigation_in_header-->
<meta name="distill:offset" content="../.."/>

<script type="application/javascript">

  window.headroom_prevent_pin = false;

  window.document.addEventListener("DOMContentLoaded", function (event) {

    // initialize headroom for banner
    var header = $('header').get(0);
    var headerHeight = header.offsetHeight;
    var headroom = new Headroom(header, {
      tolerance: 5,
      onPin : function() {
        if (window.headroom_prevent_pin) {
          window.headroom_prevent_pin = false;
          headroom.unpin();
        }
      }
    });
    headroom.init();
    if(window.location.hash)
      headroom.unpin();
    $(header).addClass('headroom--transition');

    // offset scroll location for banner on hash change
    // (see: https://github.com/WickyNilliams/headroom.js/issues/38)
    window.addEventListener("hashchange", function(event) {
      window.scrollTo(0, window.pageYOffset - (headerHeight + 25));
    });

    // responsive menu
    $('.distill-site-header').each(function(i, val) {
      var topnav = $(this);
      var toggle = topnav.find('.nav-toggle');
      toggle.on('click', function() {
        topnav.toggleClass('responsive');
      });
    });

    // nav dropdowns
    $('.nav-dropbtn').click(function(e) {
      $(this).next('.nav-dropdown-content').toggleClass('nav-dropdown-active');
      $(this).parent().siblings('.nav-dropdown')
         .children('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $("body").click(function(e){
      $('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $(".nav-dropdown").click(function(e){
      e.stopPropagation();
    });
  });
</script>

<style type="text/css">

/* Theme (user-documented overrideables for nav appearance) */

.distill-site-nav {
  color: rgba(255, 255, 255, 0.8);
  background-color: #0F2E3D;
  font-size: 15px;
  font-weight: 300;
}

.distill-site-nav a {
  color: inherit;
  text-decoration: none;
}

.distill-site-nav a:hover {
  color: white;
}

@media print {
  .distill-site-nav {
    display: none;
  }
}

.distill-site-header {

}

.distill-site-footer {

}


/* Site Header */

.distill-site-header {
  width: 100%;
  box-sizing: border-box;
  z-index: 3;
}

.distill-site-header .nav-left {
  display: inline-block;
  margin-left: 8px;
}

@media screen and (max-width: 768px) {
  .distill-site-header .nav-left {
    margin-left: 0;
  }
}


.distill-site-header .nav-right {
  float: right;
  margin-right: 8px;
}

.distill-site-header a,
.distill-site-header .title {
  display: inline-block;
  text-align: center;
  padding: 14px 10px 14px 10px;
}

.distill-site-header .title {
  font-size: 18px;
  min-width: 150px;
}

.distill-site-header .logo {
  padding: 0;
}

.distill-site-header .logo img {
  display: none;
  max-height: 20px;
  width: auto;
  margin-bottom: -4px;
}

.distill-site-header .nav-image img {
  max-height: 18px;
  width: auto;
  display: inline-block;
  margin-bottom: -3px;
}



@media screen and (min-width: 1000px) {
  .distill-site-header .logo img {
    display: inline-block;
  }
  .distill-site-header .nav-left {
    margin-left: 20px;
  }
  .distill-site-header .nav-right {
    margin-right: 20px;
  }
  .distill-site-header .title {
    padding-left: 12px;
  }
}


.distill-site-header .nav-toggle {
  display: none;
}

.nav-dropdown {
  display: inline-block;
  position: relative;
}

.nav-dropdown .nav-dropbtn {
  border: none;
  outline: none;
  color: rgba(255, 255, 255, 0.8);
  padding: 16px 10px;
  background-color: transparent;
  font-family: inherit;
  font-size: inherit;
  font-weight: inherit;
  margin: 0;
  margin-top: 1px;
  z-index: 2;
}

.nav-dropdown-content {
  display: none;
  position: absolute;
  background-color: white;
  min-width: 200px;
  border: 1px solid rgba(0,0,0,0.15);
  border-radius: 4px;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.1);
  z-index: 1;
  margin-top: 2px;
  white-space: nowrap;
  padding-top: 4px;
  padding-bottom: 4px;
}

.nav-dropdown-content hr {
  margin-top: 4px;
  margin-bottom: 4px;
  border: none;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.nav-dropdown-active {
  display: block;
}

.nav-dropdown-content a, .nav-dropdown-content .nav-dropdown-header {
  color: black;
  padding: 6px 24px;
  text-decoration: none;
  display: block;
  text-align: left;
}

.nav-dropdown-content .nav-dropdown-header {
  display: block;
  padding: 5px 24px;
  padding-bottom: 0;
  text-transform: uppercase;
  font-size: 14px;
  color: #999999;
  white-space: nowrap;
}

.nav-dropdown:hover .nav-dropbtn {
  color: white;
}

.nav-dropdown-content a:hover {
  background-color: #ddd;
  color: black;
}

.nav-right .nav-dropdown-content {
  margin-left: -45%;
  right: 0;
}

@media screen and (max-width: 768px) {
  .distill-site-header a, .distill-site-header .nav-dropdown  {display: none;}
  .distill-site-header a.nav-toggle {
    float: right;
    display: block;
  }
  .distill-site-header .title {
    margin-left: 0;
  }
  .distill-site-header .nav-right {
    margin-right: 0;
  }
  .distill-site-header {
    overflow: hidden;
  }
  .nav-right .nav-dropdown-content {
    margin-left: 0;
  }
}


@media screen and (max-width: 768px) {
  .distill-site-header.responsive {position: relative; min-height: 500px; }
  .distill-site-header.responsive a.nav-toggle {
    position: absolute;
    right: 0;
    top: 0;
  }
  .distill-site-header.responsive a,
  .distill-site-header.responsive .nav-dropdown {
    display: block;
    text-align: left;
  }
  .distill-site-header.responsive .nav-left,
  .distill-site-header.responsive .nav-right {
    width: 100%;
  }
  .distill-site-header.responsive .nav-dropdown {float: none;}
  .distill-site-header.responsive .nav-dropdown-content {position: relative;}
  .distill-site-header.responsive .nav-dropdown .nav-dropbtn {
    display: block;
    width: 100%;
    text-align: left;
  }
}

/* Site Footer */

.distill-site-footer {
  width: 100%;
  overflow: hidden;
  box-sizing: border-box;
  z-index: 3;
  margin-top: 30px;
  padding-top: 30px;
  padding-bottom: 30px;
  text-align: center;
}

/* Headroom */

d-title {
  padding-top: 6rem;
}

@media print {
  d-title {
    padding-top: 4rem;
  }
}

.headroom {
  z-index: 1000;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
}

.headroom--transition {
  transition: all .4s ease-in-out;
}

.headroom--unpinned {
  top: -100px;
}

.headroom--pinned {
  top: 0;
}

/* adjust viewport for navbar height */
/* helps vertically center bootstrap (non-distill) content */
.min-vh-100 {
  min-height: calc(100vh - 100px) !important;
}

</style>

<script src="../../site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="../../site_libs/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"/>
<link href="../../site_libs/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"/>
<script src="../../site_libs/headroom-0.9.4/headroom.min.js"></script>
<script src="../../site_libs/autocomplete-0.37.1/autocomplete.min.js"></script>
<script src="../../site_libs/fuse-6.4.1/fuse.min.js"></script>

<script type="application/javascript">

function getMeta(metaName) {
  var metas = document.getElementsByTagName('meta');
  for (let i = 0; i < metas.length; i++) {
    if (metas[i].getAttribute('name') === metaName) {
      return metas[i].getAttribute('content');
    }
  }
  return '';
}

function offsetURL(url) {
  var offset = getMeta('distill:offset');
  return offset ? offset + '/' + url : url;
}

function createFuseIndex() {

  // create fuse index
  var options = {
    keys: [
      { name: 'title', weight: 20 },
      { name: 'categories', weight: 15 },
      { name: 'description', weight: 10 },
      { name: 'contents', weight: 5 },
    ],
    ignoreLocation: true,
    threshold: 0
  };
  var fuse = new window.Fuse([], options);

  // fetch the main search.json
  return fetch(offsetURL('search.json'))
    .then(function(response) {
      if (response.status == 200) {
        return response.json().then(function(json) {
          // index main articles
          json.articles.forEach(function(article) {
            fuse.add(article);
          });
          // download collections and index their articles
          return Promise.all(json.collections.map(function(collection) {
            return fetch(offsetURL(collection)).then(function(response) {
              if (response.status === 200) {
                return response.json().then(function(articles) {
                  articles.forEach(function(article) {
                    fuse.add(article);
                  });
                })
              } else {
                return Promise.reject(
                  new Error('Unexpected status from search index request: ' +
                            response.status)
                );
              }
            });
          })).then(function() {
            return fuse;
          });
        });

      } else {
        return Promise.reject(
          new Error('Unexpected status from search index request: ' +
                      response.status)
        );
      }
    });
}

window.document.addEventListener("DOMContentLoaded", function (event) {

  // get search element (bail if we don't have one)
  var searchEl = window.document.getElementById('distill-search');
  if (!searchEl)
    return;

  createFuseIndex()
    .then(function(fuse) {

      // make search box visible
      searchEl.classList.remove('hidden');

      // initialize autocomplete
      var options = {
        autoselect: true,
        hint: false,
        minLength: 2,
      };
      window.autocomplete(searchEl, options, [{
        source: function(query, callback) {
          const searchOptions = {
            isCaseSensitive: false,
            shouldSort: true,
            minMatchCharLength: 2,
            limit: 10,
          };
          var results = fuse.search(query, searchOptions);
          callback(results
            .map(function(result) { return result.item; })
          );
        },
        templates: {
          suggestion: function(suggestion) {
            var img = suggestion.preview && Object.keys(suggestion.preview).length > 0
              ? `<img src="${offsetURL(suggestion.preview)}"</img>`
              : '';
            var html = `
              <div class="search-item">
                <h3>${suggestion.title}</h3>
                <div class="search-item-description">
                  ${suggestion.description || ''}
                </div>
                <div class="search-item-preview">
                  ${img}
                </div>
              </div>
            `;
            return html;
          }
        }
      }]).on('autocomplete:selected', function(event, suggestion) {
        window.location.href = offsetURL(suggestion.path);
      });
      // remove inline display style on autocompleter (we want to
      // manage responsive display via css)
      $('.algolia-autocomplete').css("display", "");
    })
    .catch(function(error) {
      console.log(error);
    });

});

</script>

<style type="text/css">

.nav-search {
  font-size: x-small;
}

/* Algolioa Autocomplete */

.algolia-autocomplete {
  display: inline-block;
  margin-left: 10px;
  vertical-align: sub;
  background-color: white;
  color: black;
  padding: 6px;
  padding-top: 8px;
  padding-bottom: 0;
  border-radius: 6px;
  border: 1px #0F2E3D solid;
  width: 180px;
}


@media screen and (max-width: 768px) {
  .distill-site-nav .algolia-autocomplete {
    display: none;
    visibility: hidden;
  }
  .distill-site-nav.responsive .algolia-autocomplete {
    display: inline-block;
    visibility: visible;
  }
  .distill-site-nav.responsive .algolia-autocomplete .aa-dropdown-menu {
    margin-left: 0;
    width: 400px;
    max-height: 400px;
  }
}

.algolia-autocomplete .aa-input, .algolia-autocomplete .aa-hint {
  width: 90%;
  outline: none;
  border: none;
}

.algolia-autocomplete .aa-hint {
  color: #999;
}
.algolia-autocomplete .aa-dropdown-menu {
  width: 550px;
  max-height: 70vh;
  overflow-x: visible;
  overflow-y: scroll;
  padding: 5px;
  margin-top: 3px;
  margin-left: -150px;
  background-color: #fff;
  border-radius: 5px;
  border: 1px solid #999;
  border-top: none;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion {
  cursor: pointer;
  padding: 5px 4px;
  border-bottom: 1px solid #eee;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion:last-of-type {
  border-bottom: none;
  margin-bottom: 2px;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item {
  overflow: hidden;
  font-size: 0.8em;
  line-height: 1.4em;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item h3 {
  font-size: 1rem;
  margin-block-start: 0;
  margin-block-end: 5px;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-description {
  display: inline-block;
  overflow: hidden;
  height: 2.8em;
  width: 80%;
  margin-right: 4%;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview {
  display: inline-block;
  width: 15%;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img {
  height: 3em;
  width: auto;
  display: none;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img[src] {
  display: initial;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion.aa-cursor {
  background-color: #eee;
}
.algolia-autocomplete .aa-dropdown-menu .aa-suggestion em {
  font-weight: bold;
  font-style: normal;
}

</style>


<!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

<style type="text/css">

body {
  background-color: white;
}

.pandoc-table {
  width: 100%;
}

.pandoc-table>caption {
  margin-bottom: 10px;
}

.pandoc-table th:not([align]) {
  text-align: left;
}

.pagedtable-footer {
  font-size: 15px;
}

d-byline .byline {
  grid-template-columns: 2fr 2fr;
}

d-byline .byline h3 {
  margin-block-start: 1.5em;
}

d-byline .byline .authors-affiliations h3 {
  margin-block-start: 0.5em;
}

.authors-affiliations .orcid-id {
  width: 16px;
  height:16px;
  margin-left: 4px;
  margin-right: 4px;
  vertical-align: middle;
  padding-bottom: 2px;
}

d-title .dt-tags {
  margin-top: 1em;
  grid-column: text;
}

.dt-tags .dt-tag {
  text-decoration: none;
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0em 0.4em;
  margin-right: 0.5em;
  margin-bottom: 0.4em;
  font-size: 70%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

d-article table.gt_table td,
d-article table.gt_table th {
  border-bottom: none;
  font-size: 100%;
}

.html-widget {
  margin-bottom: 2.0em;
}

.l-screen-inset {
  padding-right: 16px;
}

.l-screen .caption {
  margin-left: 10px;
}

.shaded {
  background: rgb(247, 247, 247);
  padding-top: 20px;
  padding-bottom: 20px;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .html-widget {
  margin-bottom: 0;
  border: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .shaded-content {
  background: white;
}

.text-output {
  margin-top: 0;
  line-height: 1.5em;
}

.hidden {
  display: none !important;
}

hr.section-separator {
  border: none;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  margin: 0px;
}


d-byline {
  border-top: none;
}

d-article {
  padding-top: 2.5rem;
  padding-bottom: 30px;
  border-top: none;
}

d-appendix {
  padding-top: 30px;
}

d-article>p>img {
  width: 100%;
}

d-article h2 {
  margin: 1rem 0 1.5rem 0;
}

d-article h3 {
  margin-top: 1.5rem;
}

d-article iframe {
  border: 1px solid rgba(0, 0, 0, 0.1);
  margin-bottom: 2.0em;
  width: 100%;
}

/* Tweak code blocks */

d-article div.sourceCode code,
d-article pre code {
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
}

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: auto;
}

d-article div.sourceCode {
  background-color: white;
}

d-article div.sourceCode pre {
  padding-left: 10px;
  font-size: 12px;
  border-left: 2px solid rgba(0,0,0,0.1);
}

d-article pre {
  font-size: 12px;
  color: black;
  background: none;
  margin-top: 0;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

d-article pre a {
  border-bottom: none;
}

d-article pre a:hover {
  border-bottom: none;
  text-decoration: underline;
}

d-article details {
  grid-column: text;
  margin-bottom: 0.8em;
}

@media(min-width: 768px) {

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: visible !important;
}

d-article div.sourceCode pre {
  padding-left: 18px;
  font-size: 14px;
}

/* tweak for Pandoc numbered line within distill */
d-article pre.numberSource code > span {
    left: -2em;
}

d-article pre {
  font-size: 14px;
}

}

figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

/* CSS for d-contents */

.d-contents {
  grid-column: text;
  color: rgba(0,0,0,0.8);
  font-size: 0.9em;
  padding-bottom: 1em;
  margin-bottom: 1em;
  padding-bottom: 0.5em;
  margin-bottom: 1em;
  padding-left: 0.25em;
  justify-self: start;
}

@media(min-width: 1000px) {
  .d-contents.d-contents-float {
    height: 0;
    grid-column-start: 1;
    grid-column-end: 4;
    justify-self: center;
    padding-right: 3em;
    padding-left: 2em;
  }
}

.d-contents nav h3 {
  font-size: 18px;
  margin-top: 0;
  margin-bottom: 1em;
}

.d-contents li {
  list-style-type: none
}

.d-contents nav > ul {
  padding-left: 0;
}

.d-contents ul {
  padding-left: 1em
}

.d-contents nav ul li {
  margin-top: 0.6em;
  margin-bottom: 0.2em;
}

.d-contents nav a {
  font-size: 13px;
  border-bottom: none;
  text-decoration: none
  color: rgba(0, 0, 0, 0.8);
}

.d-contents nav a:hover {
  text-decoration: underline solid rgba(0, 0, 0, 0.6)
}

.d-contents nav > ul > li > a {
  font-weight: 600;
}

.d-contents nav > ul > li > ul {
  font-weight: inherit;
}

.d-contents nav > ul > li > ul > li {
  margin-top: 0.2em;
}


.d-contents nav ul {
  margin-top: 0;
  margin-bottom: 0.25em;
}

.d-article-with-toc h2:nth-child(2) {
  margin-top: 0;
}


/* Figure */

.figure {
  position: relative;
  margin-bottom: 2.5em;
  margin-top: 1.5em;
}

.figure .caption {
  color: rgba(0, 0, 0, 0.6);
  font-size: 12px;
  line-height: 1.5em;
}

.figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

.figure .caption a {
  color: rgba(0, 0, 0, 0.6);
}

.figure .caption b,
.figure .caption strong, {
  font-weight: 600;
  color: rgba(0, 0, 0, 1.0);
}

/* Citations */

d-article .citation {
  color: inherit;
  cursor: inherit;
}

div.hanging-indent{
  margin-left: 1em; text-indent: -1em;
}

/* Citation hover box */

.tippy-box[data-theme~=light-border] {
  background-color: rgba(250, 250, 250, 0.95);
}

.tippy-content > p {
  margin-bottom: 0;
  padding: 2px;
}


/* Tweak 1000px media break to show more text */

@media(min-width: 1000px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 16px;
  }

  .grid {
    grid-column-gap: 16px;
  }

  d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
  }
  figure .caption, .figure .caption, figure figcaption {
    font-size: 13px;
  }
}

@media(min-width: 1180px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 32px;
  }

  .grid {
    grid-column-gap: 32px;
  }
}


/* Get the citation styles for the appendix (not auto-injected on render since
   we do our own rendering of the citation appendix) */

d-appendix .citation-appendix,
.d-appendix .citation-appendix {
  font-size: 11px;
  line-height: 15px;
  border-left: 1px solid rgba(0, 0, 0, 0.1);
  padding-left: 18px;
  border: 1px solid rgba(0,0,0,0.1);
  background: rgba(0, 0, 0, 0.02);
  padding: 10px 18px;
  border-radius: 3px;
  color: rgba(150, 150, 150, 1);
  overflow: hidden;
  margin-top: -12px;
  white-space: pre-wrap;
  word-wrap: break-word;
}

/* Include appendix styles here so they can be overridden */

d-appendix {
  contain: layout style;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-top: 60px;
  margin-bottom: 0;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  color: rgba(0,0,0,0.5);
  padding-top: 60px;
  padding-bottom: 48px;
}

d-appendix h3 {
  grid-column: page-start / text-start;
  font-size: 15px;
  font-weight: 500;
  margin-top: 1em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.65);
}

d-appendix h3 + * {
  margin-top: 1em;
}

d-appendix ol {
  padding: 0 0 0 15px;
}

@media (min-width: 768px) {
  d-appendix ol {
    padding: 0 0 0 30px;
    margin-left: -30px;
  }
}

d-appendix li {
  margin-bottom: 1em;
}

d-appendix a {
  color: rgba(0, 0, 0, 0.6);
}

d-appendix > * {
  grid-column: text;
}

d-appendix > d-footnote-list,
d-appendix > d-citation-list,
d-appendix > distill-appendix {
  grid-column: screen;
}

/* Include footnote styles here so they can be overridden */

d-footnote-list {
  contain: layout style;
}

d-footnote-list > * {
  grid-column: text;
}

d-footnote-list a.footnote-backlink {
  color: rgba(0,0,0,0.3);
  padding-left: 0.5em;
}



/* Anchor.js */

.anchorjs-link {
  /*transition: all .25s linear; */
  text-decoration: none;
  border-bottom: none;
}
*:hover > .anchorjs-link {
  margin-left: -1.125em !important;
  text-decoration: none;
  border-bottom: none;
}

/* Social footer */

.social_footer {
  margin-top: 30px;
  margin-bottom: 0;
  color: rgba(0,0,0,0.67);
}

.disqus-comments {
  margin-right: 30px;
}

.disqus-comment-count {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  cursor: pointer;
}

#disqus_thread {
  margin-top: 30px;
}

.article-sharing a {
  border-bottom: none;
  margin-right: 8px;
}

.article-sharing a:hover {
  border-bottom: none;
}

.sidebar-section.subscribe {
  font-size: 12px;
  line-height: 1.6em;
}

.subscribe p {
  margin-bottom: 0.5em;
}


.article-footer .subscribe {
  font-size: 15px;
  margin-top: 45px;
}


.sidebar-section.custom {
  font-size: 12px;
  line-height: 1.6em;
}

.custom p {
  margin-bottom: 0.5em;
}

/* Styles for listing layout (hide title) */
.layout-listing d-title, .layout-listing .d-title {
  display: none;
}

/* Styles for posts lists (not auto-injected) */


.posts-with-sidebar {
  padding-left: 45px;
  padding-right: 45px;
}

.posts-list .description h2,
.posts-list .description p {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
}

.posts-list .description h2 {
  font-weight: 700;
  border-bottom: none;
  padding-bottom: 0;
}

.posts-list h2.post-tag {
  border-bottom: 1px solid rgba(0, 0, 0, 0.2);
  padding-bottom: 12px;
}
.posts-list {
  margin-top: 60px;
  margin-bottom: 24px;
}

.posts-list .post-preview {
  text-decoration: none;
  overflow: hidden;
  display: block;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  padding: 24px 0;
}

.post-preview-last {
  border-bottom: none !important;
}

.posts-list .posts-list-caption {
  grid-column: screen;
  font-weight: 400;
}

.posts-list .post-preview h2 {
  margin: 0 0 6px 0;
  line-height: 1.2em;
  font-style: normal;
  font-size: 24px;
}

.posts-list .post-preview p {
  margin: 0 0 12px 0;
  line-height: 1.4em;
  font-size: 16px;
}

.posts-list .post-preview .thumbnail {
  box-sizing: border-box;
  margin-bottom: 24px;
  position: relative;
  max-width: 500px;
}
.posts-list .post-preview img {
  width: 100%;
  display: block;
}

.posts-list .metadata {
  font-size: 12px;
  line-height: 1.4em;
  margin-bottom: 18px;
}

.posts-list .metadata > * {
  display: inline-block;
}

.posts-list .metadata .publishedDate {
  margin-right: 2em;
}

.posts-list .metadata .dt-authors {
  display: block;
  margin-top: 0.3em;
  margin-right: 2em;
}

.posts-list .dt-tags {
  display: block;
  line-height: 1em;
}

.posts-list .dt-tags .dt-tag {
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0.3em 0.4em;
  margin-right: 0.2em;
  margin-bottom: 0.4em;
  font-size: 60%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

.posts-list img {
  opacity: 1;
}

.posts-list img[data-src] {
  opacity: 0;
}

.posts-more {
  clear: both;
}


.posts-sidebar {
  font-size: 16px;
}

.posts-sidebar h3 {
  font-size: 16px;
  margin-top: 0;
  margin-bottom: 0.5em;
  font-weight: 400;
  text-transform: uppercase;
}

.sidebar-section {
  margin-bottom: 30px;
}

.categories ul {
  list-style-type: none;
  margin: 0;
  padding: 0;
}

.categories li {
  color: rgba(0, 0, 0, 0.8);
  margin-bottom: 0;
}

.categories li>a {
  border-bottom: none;
}

.categories li>a:hover {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
}

.categories .active {
  font-weight: 600;
}

.categories .category-count {
  color: rgba(0, 0, 0, 0.4);
}


@media(min-width: 768px) {
  .posts-list .post-preview h2 {
    font-size: 26px;
  }
  .posts-list .post-preview .thumbnail {
    float: right;
    width: 30%;
    margin-bottom: 0;
  }
  .posts-list .post-preview .description {
    float: left;
    width: 45%;
  }
  .posts-list .post-preview .metadata {
    float: left;
    width: 20%;
    margin-top: 8px;
  }
  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.5em;
    font-size: 16px;
  }
  .posts-with-sidebar .posts-list {
    float: left;
    width: 75%;
  }
  .posts-with-sidebar .posts-sidebar {
    float: right;
    width: 20%;
    margin-top: 60px;
    padding-top: 24px;
    padding-bottom: 24px;
  }
}


/* Improve display for browsers without grid (IE/Edge <= 15) */

.downlevel {
  line-height: 1.6em;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  margin: 0;
}

.downlevel .d-title {
  padding-top: 6rem;
  padding-bottom: 1.5rem;
}

.downlevel .d-title h1 {
  font-size: 50px;
  font-weight: 700;
  line-height: 1.1em;
  margin: 0 0 0.5rem;
}

.downlevel .d-title p {
  font-weight: 300;
  font-size: 1.2rem;
  line-height: 1.55em;
  margin-top: 0;
}

.downlevel .d-byline {
  padding-top: 0.8em;
  padding-bottom: 0.8em;
  font-size: 0.8rem;
  line-height: 1.8em;
}

.downlevel .section-separator {
  border: none;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
}

.downlevel .d-article {
  font-size: 1.06rem;
  line-height: 1.7em;
  padding-top: 1rem;
  padding-bottom: 2rem;
}


.downlevel .d-appendix {
  padding-left: 0;
  padding-right: 0;
  max-width: none;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.5);
  padding-top: 40px;
  padding-bottom: 48px;
}

.downlevel .footnotes ol {
  padding-left: 13px;
}

.downlevel .base-grid,
.downlevel .distill-header,
.downlevel .d-title,
.downlevel .d-abstract,
.downlevel .d-article,
.downlevel .d-appendix,
.downlevel .distill-appendix,
.downlevel .d-byline,
.downlevel .d-footnote-list,
.downlevel .d-citation-list,
.downlevel .distill-footer,
.downlevel .appendix-bottom,
.downlevel .posts-container {
  padding-left: 40px;
  padding-right: 40px;
}

@media(min-width: 768px) {
  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
  padding-left: 150px;
  padding-right: 150px;
  max-width: 900px;
}
}

.downlevel pre code {
  display: block;
  border-left: 2px solid rgba(0, 0, 0, .1);
  padding: 0 0 0 20px;
  font-size: 14px;
}

.downlevel code, .downlevel pre {
  color: black;
  background: none;
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

.downlevel .posts-list .post-preview {
  color: inherit;
}



</style>

<script type="application/javascript">

function is_downlevel_browser() {
  if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                 window.navigator.userAgent)) {
    return true;
  } else {
    return window.load_distill_framework === undefined;
  }
}

// show body when load is complete
function on_load_complete() {

  // add anchors
  if (window.anchors) {
    window.anchors.options.placement = 'left';
    window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
  }


  // set body to visible
  document.body.style.visibility = 'visible';

  // force redraw for leaflet widgets
  if (window.HTMLWidgets) {
    var maps = window.HTMLWidgets.findAll(".leaflet");
    $.each(maps, function(i, el) {
      var map = this.getMap();
      map.invalidateSize();
      map.eachLayer(function(layer) {
        if (layer instanceof L.TileLayer)
          layer.redraw();
      });
    });
  }

  // trigger 'shown' so htmlwidgets resize
  $('d-article').trigger('shown');
}

function init_distill() {

  init_common();

  // create front matter
  var front_matter = $('<d-front-matter></d-front-matter>');
  $('#distill-front-matter').wrap(front_matter);

  // create d-title
  $('.d-title').changeElementType('d-title');

  // separator
  var separator = '<hr class="section-separator" style="clear: both"/>';
  // prepend separator above appendix
  $('.d-byline').before(separator);
  $('.d-article').before(separator);

  // create d-byline
  var byline = $('<d-byline></d-byline>');
  $('.d-byline').replaceWith(byline);

  // create d-article
  var article = $('<d-article></d-article>');
  $('.d-article').wrap(article).children().unwrap();

  // move posts container into article
  $('.posts-container').appendTo($('d-article'));

  // create d-appendix
  $('.d-appendix').changeElementType('d-appendix');

  // flag indicating that we have appendix items
  var appendix = $('.appendix-bottom').children('h3').length > 0;

  // replace footnotes with <d-footnote>
  $('.footnote-ref').each(function(i, val) {
    appendix = true;
    var href = $(this).attr('href');
    var id = href.replace('#', '');
    var fn = $('#' + id);
    var fn_p = $('#' + id + '>p');
    fn_p.find('.footnote-back').remove();
    var text = fn_p.html();
    var dtfn = $('<d-footnote></d-footnote>');
    dtfn.html(text);
    $(this).replaceWith(dtfn);
  });
  // remove footnotes
  $('.footnotes').remove();

  // move refs into #references-listing
  $('#references-listing').replaceWith($('#refs'));

  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    var id = $(this).attr('id');
    $('.d-contents a[href="#' + id + '"]').parent().remove();
    appendix = true;
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
  });

  // show d-appendix if we have appendix content
  $("d-appendix").css('display', appendix ? 'grid' : 'none');

  // localize layout chunks to just output
  $('.layout-chunk').each(function(i, val) {

    // capture layout
    var layout = $(this).attr('data-layout');

    // apply layout to markdown level block elements
    var elements = $(this).children().not('details, div.sourceCode, pre, script');
    elements.each(function(i, el) {
      var layout_div = $('<div class="' + layout + '"></div>');
      if (layout_div.hasClass('shaded')) {
        var shaded_content = $('<div class="shaded-content"></div>');
        $(this).wrap(shaded_content);
        $(this).parent().wrap(layout_div);
      } else {
        $(this).wrap(layout_div);
      }
    });


    // unwrap the layout-chunk div
    $(this).children().unwrap();
  });

  // remove code block used to force  highlighting css
  $('.distill-force-highlighting-css').parent().remove();

  // remove empty line numbers inserted by pandoc when using a
  // custom syntax highlighting theme, except when numbering line
  // in code chunk
  $('pre:not(.numberLines) code.sourceCode a:empty').remove();

  // load distill framework
  load_distill_framework();

  // wait for window.distillRunlevel == 4 to do post processing
  function distill_post_process() {

    if (!window.distillRunlevel || window.distillRunlevel < 4)
      return;

    // hide author/affiliations entirely if we have no authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;
    if (!have_authors)
      $('d-byline').addClass('hidden');

    // article with toc class
    $('.d-contents').parent().addClass('d-article-with-toc');

    // strip links that point to #
    $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

    // add orcid ids
    $('.authors-affiliations').find('.author').each(function(i, el) {
      var orcid_id = front_matter.authors[i].orcidID;
      var author_name = front_matter.authors[i].author
      if (orcid_id) {
        var a = $('<a></a>');
        a.attr('href', 'https://orcid.org/' + orcid_id);
        var img = $('<img></img>');
        img.addClass('orcid-id');
        img.attr('alt', author_name ? 'ORCID ID for ' + author_name : 'ORCID ID');
        img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
        a.append(img);
        $(this).append(a);
      }
    });

    // hide elements of author/affiliations grid that have no value
    function hide_byline_column(caption) {
      $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
    }

    // affiliations
    var have_affiliations = false;
    for (var i = 0; i<front_matter.authors.length; ++i) {
      var author = front_matter.authors[i];
      if (author.affiliation !== "&nbsp;") {
        have_affiliations = true;
        break;
      }
    }
    if (!have_affiliations)
      $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

    // published date
    if (!front_matter.publishedDate)
      hide_byline_column("Published");

    // document object identifier
    var doi = $('d-byline').find('h3:contains("DOI")');
    var doi_p = doi.next().empty();
    if (!front_matter.doi) {
      // if we have a citation and valid citationText then link to that
      if ($('#citation').length > 0 && front_matter.citationText) {
        doi.html('Citation');
        $('<a href="#citation"></a>')
          .text(front_matter.citationText)
          .appendTo(doi_p);
      } else {
        hide_byline_column("DOI");
      }
    } else {
      $('<a></a>')
         .attr('href', "https://doi.org/" + front_matter.doi)
         .html(front_matter.doi)
         .appendTo(doi_p);
    }

     // change plural form of authors/affiliations
    if (front_matter.authors.length === 1) {
      var grid = $('.authors-affiliations');
      grid.children('h3:contains("Authors")').text('Author');
      grid.children('h3:contains("Affiliations")').text('Affiliation');
    }

    // remove d-appendix and d-footnote-list local styles
    $('d-appendix > style:first-child').remove();
    $('d-footnote-list > style:first-child').remove();

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // hoverable references
    $('span.citation[data-cites]').each(function() {
      const citeChild = $(this).children()[0]
      // Do not process if @xyz has been used without escaping and without bibliography activated
      // https://github.com/rstudio/distill/issues/466
      if (citeChild === undefined) return true

      if (citeChild.nodeName == "D-FOOTNOTE") {
        var fn = citeChild
        $(this).html(fn.shadowRoot.querySelector("sup"))
        $(this).id = fn.id
        fn.remove()
      }
      var refs = $(this).attr('data-cites').split(" ");
      var refHtml = refs.map(function(ref) {
        // Could use CSS.escape too here, we insure backward compatibility in navigator
        return "<p>" + $('div[id="ref-' + ref + '"]').html() + "</p>";
      }).join("\n");
      window.tippy(this, {
        allowHTML: true,
        content: refHtml,
        maxWidth: 500,
        interactive: true,
        interactiveBorder: 10,
        theme: 'light-border',
        placement: 'bottom-start'
      });
    });

    // fix footnotes in tables (#411)
    // replacing broken distill.pub feature
    $('table d-footnote').each(function() {
      // we replace internal showAtNode methode which is triggered when hovering a footnote
      this.hoverBox.showAtNode = function(node) {
        // ported from https://github.com/distillpub/template/pull/105/files
        calcOffset = function(elem) {
            let x = elem.offsetLeft;
            let y = elem.offsetTop;
            // Traverse upwards until an `absolute` element is found or `elem`
            // becomes null.
            while (elem = elem.offsetParent && elem.style.position != 'absolute') {
                x += elem.offsetLeft;
                y += elem.offsetTop;
            }

            return { left: x, top: y };
        }
        // https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/offsetTop
        const bbox = node.getBoundingClientRect();
        const offset = calcOffset(node);
        this.show([offset.left + bbox.width, offset.top + bbox.height]);
      }
    })

    // clear polling timer
    clearInterval(tid);

    // show body now that everything is ready
    on_load_complete();
  }

  var tid = setInterval(distill_post_process, 50);
  distill_post_process();

}

function init_downlevel() {

  init_common();

   // insert hr after d-title
  $('.d-title').after($('<hr class="section-separator"/>'));

  // check if we have authors
  var front_matter = JSON.parse($("#distill-front-matter").html());
  var have_authors = front_matter.authors && front_matter.authors.length > 0;

  // manage byline/border
  if (!have_authors)
    $('.d-byline').remove();
  $('.d-byline').after($('<hr class="section-separator"/>'));
  $('.d-byline a').remove();

  // remove toc
  $('.d-contents').remove();

  // move appendix elements
  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
  });


  // inject headers into references and footnotes
  var refs_header = $('<h3></h3>');
  refs_header.text('References');
  $('#refs').prepend(refs_header);

  var footnotes_header = $('<h3></h3');
  footnotes_header.text('Footnotes');
  $('.footnotes').children('hr').first().replaceWith(footnotes_header);

  // move appendix-bottom entries to the bottom
  $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
  $('.appendix-bottom').remove();

  // remove appendix if it's empty
  if ($('.d-appendix').children().length === 0)
    $('.d-appendix').remove();

  // prepend separator above appendix
  $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

  // trim code
  $('pre>code').each(function(i, val) {
    $(this).html($.trim($(this).html()));
  });

  // move posts-container right before article
  $('.posts-container').insertBefore($('.d-article'));

  $('body').addClass('downlevel');

  on_load_complete();
}


function init_common() {

  // jquery plugin to change element types
  (function($) {
    $.fn.changeElementType = function(newType) {
      var attrs = {};

      $.each(this[0].attributes, function(idx, attr) {
        attrs[attr.nodeName] = attr.nodeValue;
      });

      this.replaceWith(function() {
        return $("<" + newType + "/>", attrs).append($(this).contents());
      });
    };
  })(jQuery);

  // prevent underline for linked images
  $('a > img').parent().css({'border-bottom' : 'none'});

  // mark non-body figures created by knitr chunks as 100% width
  $('.layout-chunk').each(function(i, val) {
    var figures = $(this).find('img, .html-widget');
    // ignore leaflet img layers (#106)
    figures = figures.filter(':not(img[class*="leaflet"])')
    if ($(this).attr('data-layout') !== "l-body") {
      figures.css('width', '100%');
    } else {
      figures.css('max-width', '100%');
      figures.filter("[width]").each(function(i, val) {
        var fig = $(this);
        fig.css('width', fig.attr('width') + 'px');
      });

    }
  });

  // auto-append index.html to post-preview links in file: protocol
  // and in rstudio ide preview
  $('.post-preview').each(function(i, val) {
    if (window.location.protocol === "file:")
      $(this).attr('href', $(this).attr('href') + "index.html");
  });

  // get rid of index.html references in header
  if (window.location.protocol !== "file:") {
    $('.distill-site-header a[href]').each(function(i,val) {
      $(this).attr('href', $(this).attr('href').replace(/^index[.]html/, "./"));
    });
  }

  // add class to pandoc style tables
  $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
  $('.kable-table').children('table').addClass('pandoc-table');

  // add figcaption style to table captions
  $('caption').parent('table').addClass("figcaption");

  // initialize posts list
  if (window.init_posts_list)
    window.init_posts_list();

  // implmement disqus comment link
  $('.disqus-comment-count').click(function() {
    window.headroom_prevent_pin = true;
    $('#disqus_thread').toggleClass('hidden');
    if (!$('#disqus_thread').hasClass('hidden')) {
      var offset = $(this).offset();
      $(window).resize();
      $('html, body').animate({
        scrollTop: offset.top - 35
      });
    }
  });
}

document.addEventListener('DOMContentLoaded', function() {
  if (is_downlevel_browser())
    init_downlevel();
  else
    window.addEventListener('WebComponentsReady', init_distill);
});

</script>

<style type="text/css">
/* base variables */

/* Edit the CSS properties in this file to create a custom
   Distill theme. Only edit values in the right column
   for each row; values shown are the CSS defaults.
   To return any property to the default,
   you may set its value to: unset
   All rows must end with a semi-colon.                      */

/* Optional: embed custom fonts here with `@import`          */
/* This must remain at the top of this file.                 */



html {
  /*-- Main font sizes --*/
  --title-size:      50px;
  --body-size:       1.06rem;
  --code-size:       14px;
  --aside-size:      12px;
  --fig-cap-size:    13px;
  /*-- Main font colors --*/
  --title-color:     #000000;
  --header-color:    rgba(0, 0, 0, 0.8);
  --body-color:      rgba(0, 0, 0, 0.8);
  --aside-color:     rgba(0, 0, 0, 0.6);
  --fig-cap-color:   rgba(0, 0, 0, 0.6);
  /*-- Specify custom fonts ~~~ must be imported above   --*/
  --heading-font:    sans-serif;
  --mono-font:       monospace;
  --body-font:       sans-serif;
  --navbar-font:     sans-serif;  /* websites + blogs only */
}

/*-- ARTICLE METADATA --*/
d-byline {
  --heading-size:    0.6rem;
  --heading-color:   rgba(0, 0, 0, 0.5);
  --body-size:       0.8rem;
  --body-color:      rgba(0, 0, 0, 0.8);
}

/*-- ARTICLE TABLE OF CONTENTS --*/
.d-contents {
  --heading-size:    18px;
  --contents-size:   13px;
}

/*-- ARTICLE APPENDIX --*/
d-appendix {
  --heading-size:    15px;
  --heading-color:   rgba(0, 0, 0, 0.65);
  --text-size:       0.8em;
  --text-color:      rgba(0, 0, 0, 0.5);
}

/*-- WEBSITE HEADER + FOOTER --*/
/* These properties only apply to Distill sites and blogs  */

.distill-site-header {
  --title-size:       18px;
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #0F2E3D;
}

.distill-site-footer {
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #0F2E3D;
}

/*-- Additional custom styles --*/
/* Add any additional CSS rules below                      */
</style>
<style type="text/css">
/* base variables */

/* Edit the CSS properties in this file to create a custom
   Distill theme. Only edit values in the right column
   for each row; values shown are the CSS defaults.
   To return any property to the default,
   you may set its value to: unset
   All rows must end with a semi-colon.                      */

/* Optional: embed custom fonts here with `@import`          */
/* This must remain at the top of this file.                 */



html {
  /*-- Main font sizes --*/
  --title-size:      50px;
  --body-size:       1.06rem;
  --code-size:       14px;
  --aside-size:      12px;
  --fig-cap-size:    13px;
  /*-- Main font colors --*/
  --title-color:     #000000;
  --header-color:    rgba(0, 0, 0, 0.8);
  --body-color:      rgba(0, 0, 0, 0.8);
  --aside-color:     rgba(0, 0, 0, 0.6);
  --fig-cap-color:   rgba(0, 0, 0, 0.6);
  /*-- Specify custom fonts ~~~ must be imported above   --*/
  --heading-font:    sans-serif;
  --mono-font:       monospace;
  --body-font:       sans-serif;
  --navbar-font:     sans-serif;  /* websites + blogs only */
}

/*-- ARTICLE METADATA --*/
d-byline {
  --heading-size:    0.6rem;
  --heading-color:   rgba(0, 0, 0, 0.5);
  --body-size:       0.8rem;
  --body-color:      rgba(0, 0, 0, 0.8);
}

/*-- ARTICLE TABLE OF CONTENTS --*/
.d-contents {
  --heading-size:    18px;
  --contents-size:   13px;
}

/*-- ARTICLE APPENDIX --*/
d-appendix {
  --heading-size:    15px;
  --heading-color:   rgba(0, 0, 0, 0.65);
  --text-size:       0.8em;
  --text-color:      rgba(0, 0, 0, 0.5);
}

/*-- WEBSITE HEADER + FOOTER --*/
/* These properties only apply to Distill sites and blogs  */

.distill-site-header {
  --title-size:       18px;
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #0F2E3D;
}

.distill-site-footer {
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #0F2E3D;
}

/*-- Additional custom styles --*/
/* Add any additional CSS rules below                      */
</style>
<style type="text/css">
/* base style */

/* FONT FAMILIES */

:root {
  --heading-default: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  --mono-default: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  --body-default: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
}

body,
.posts-list .post-preview p,
.posts-list .description p {
  font-family: var(--body-font), var(--body-default);
}

h1, h2, h3, h4, h5, h6,
.posts-list .post-preview h2,
.posts-list .description h2 {
  font-family: var(--heading-font), var(--heading-default);
}

d-article div.sourceCode code,
d-article pre code {
  font-family: var(--mono-font), var(--mono-default);
}


/*-- TITLE --*/
d-title h1,
.posts-list > h1 {
  color: var(--title-color, black);
}

d-title h1 {
  font-size: var(--title-size, 50px);
}

/*-- HEADERS --*/
d-article h1,
d-article h2,
d-article h3,
d-article h4,
d-article h5,
d-article h6 {
  color: var(--header-color, rgba(0, 0, 0, 0.8));
}

/*-- BODY --*/
d-article > p,  /* only text inside of <p> tags */
d-article > ul, /* lists */
d-article > ol {
  color: var(--body-color, rgba(0, 0, 0, 0.8));
  font-size: var(--body-size, 1.06rem);
}


/*-- CODE --*/
d-article div.sourceCode code,
d-article pre code {
  font-size: var(--code-size, 14px);
}

/*-- ASIDE --*/
d-article aside {
  font-size: var(--aside-size, 12px);
  color: var(--aside-color, rgba(0, 0, 0, 0.6));
}

/*-- FIGURE CAPTIONS --*/
figure .caption,
figure figcaption,
.figure .caption {
  font-size: var(--fig-cap-size, 13px);
  color: var(--fig-cap-color, rgba(0, 0, 0, 0.6));
}

/*-- METADATA --*/
d-byline h3 {
  font-size: var(--heading-size, 0.6rem);
  color: var(--heading-color, rgba(0, 0, 0, 0.5));
}

d-byline {
  font-size: var(--body-size, 0.8rem);
  color: var(--body-color, rgba(0, 0, 0, 0.8));
}

d-byline a,
d-article d-byline a {
  color: var(--body-color, rgba(0, 0, 0, 0.8));
}

/*-- TABLE OF CONTENTS --*/
.d-contents nav h3 {
  font-size: var(--heading-size, 18px);
}

.d-contents nav a {
  font-size: var(--contents-size, 13px);
}

/*-- APPENDIX --*/
d-appendix h3 {
  font-size: var(--heading-size, 15px);
  color: var(--heading-color, rgba(0, 0, 0, 0.65));
}

d-appendix {
  font-size: var(--text-size, 0.8em);
  color: var(--text-color, rgba(0, 0, 0, 0.5));
}

d-appendix d-footnote-list a.footnote-backlink {
  color: var(--text-color, rgba(0, 0, 0, 0.5));
}

/*-- WEBSITE HEADER + FOOTER --*/
.distill-site-header .title {
  font-size: var(--title-size, 18px);
  font-family: var(--navbar-font), var(--heading-default);
}

.distill-site-header a,
.nav-dropdown .nav-dropbtn {
  font-family: var(--navbar-font), var(--heading-default);
}

.nav-dropdown .nav-dropbtn {
  color: var(--text-color, rgba(255, 255, 255, 0.8));
  font-size: var(--text-size, 15px);
}

.distill-site-header a:hover,
.nav-dropdown:hover .nav-dropbtn {
  color: var(--hover-color, white);
}

.distill-site-header {
  font-size: var(--text-size, 15px);
  color: var(--text-color, rgba(255, 255, 255, 0.8));
  background-color: var(--bkgd-color, #0F2E3D);
}

.distill-site-footer {
  font-size: var(--text-size, 15px);
  color: var(--text-color, rgba(255, 255, 255, 0.8));
  background-color: var(--bkgd-color, #0F2E3D);
}

.distill-site-footer a:hover {
  color: var(--hover-color, white);
}</style>
<!--/radix_placeholder_distill-->
  <script src="../../site_libs/header-attrs-2.29/header-attrs.js"></script>
  <script src="../../site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
  <script src="../../site_libs/popper-2.6.0/popper.min.js"></script>
  <link href="../../site_libs/tippy-6.2.7/tippy.css" rel="stylesheet" />
  <link href="../../site_libs/tippy-6.2.7/tippy-light-border.css" rel="stylesheet" />
  <script src="../../site_libs/tippy-6.2.7/tippy.umd.min.js"></script>
  <script src="../../site_libs/anchor-4.2.2/anchor.min.js"></script>
  <script src="../../site_libs/bowser-1.9.3/bowser.min.js"></script>
  <script src="../../site_libs/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="../../site_libs/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
<!--/radix_placeholder_site_in_header-->


</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"Wonderful Wednesdays February 2025 (59)","description":"It is a real challenge to display adverse event data. There are a lot of different aspects to concentrate on. How this can be approached?","authors":[{"author":"PSI VIS SIG","authorURL":"https://www.psiweb.org/sigs-special-interest-groups/visualisation","affiliation":"&nbsp;","affiliationURL":"#","orcidID":""}],"publishedDate":"2025-02-12T00:00:00.000+01:00","citationText":"SIG, 2025"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<header class="header header--fixed" role="banner">
<nav class="distill-site-nav distill-site-header">
<div class="nav-left">
<span class="logo">
<img src="../../WWW_logo_cut.png"/>
</span>
<a href="../../index.html" class="title">VIS-SIG Blog</a>
<input id="distill-search" class="nav-search hidden" type="text" placeholder="Search..."/>
</div>
<div class="nav-right">
<a href="../../index.html">Home</a>
<a href="https://www.psiweb.org/sigs-special-interest-groups/visualisation/welcome-to-wonderful-wednesdays">Wonderful Wednesdays</a>
<a href="https://www.psiweb.org/sigs-special-interest-groups/visualisation">PSI SIG page</a>
<a href="https://lp.constantcontactpages.com/su/Ea7OsL8">Sign up</a>
<a href="../../about.html">About</a>
<a href="https://github.com/VIS-SIG">
<i class="fab fa-github" aria-hidden="true"></i>
</a>
<a href="javascript:void(0);" class="nav-toggle">&#9776;</a>
</div>
</nav>
</header>
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>Wonderful Wednesdays February 2025 (59)</h1>

<!--radix_placeholder_categories-->
<div class="dt-tags">
  <a href="../../index.html#category:Adverse_events" class="dt-tag">Adverse events</a>
  <a href="../../index.html#category:Biomarker" class="dt-tag">Biomarker</a>
  <a href="../../index.html#category:Wonderful_Wednesdays" class="dt-tag">Wonderful Wednesdays</a>
</div>
<!--/radix_placeholder_categories-->
<p><p>It is a real challenge to display adverse event data. There are a lot of different aspects to concentrate on. How this can be approached?</p></p>
</div>

<div class="d-byline">
  PSI VIS SIG <a href="https://www.psiweb.org/sigs-special-interest-groups/visualisation" class="uri">https://www.psiweb.org/sigs-special-interest-groups/visualisation</a> 
  
<br/>02-12-2025
</div>

<div class="d-article">
<h1 id="adverse-event-display">Adverse Event display</h1>
<p>The time course of adverse events can be shown with violin plots. To explore the co-occurrence of events a visually enhanced correlation matrix is helpful. Various ways are presented to effectively combine (stacked) bar charts with indivial patient data display and violin plots to explore subgroup differences.</p>
<p>Data set:</p>
<p>Sample ADAE data set generated using teal.data package in R. Data limited to two treatments (Drug X, Placebo), although subjects may switch between the two.</p>
<p>The Challenge:</p>
<p>Produce a visualization using this sample ADAE data set The challenge is open-ended, and you can choose a feature of the data to focus on. Possible ideas:</p>
<ul>
<li>Investigate the co-occurrence of adverse events (the October 2020 webinar might provide some inspiration!) or ‘clusters’ of adverse events – do certain groups of adverse events tend to occur alongside one another or at certain times</li>
<li>Investigate the time to a given event or adverse event profiles over time</li>
<li>Explore the hierarchical nature of adverse events (MedDRA terms)</li>
</ul>
<p>A description of the challenge can also be found <a href="https://github.com/VIS-SIG/Wonderful-Wednesdays/tree/master/data/2025/2025-01-08">here</a>.<br />
A recording of the session can be found <a href="https://psiweb.org/vod/item/psi-vissig-wonderful-wednesday-59-adverse-event-display">here</a>.</p>
<h2 id="visualisations">Visualisations</h2>
<p><a id="example1"></a></p>
<h3 id="example-1-violin-plot-on-onset-and-resolution">Example 1: Violin plot on onset and resolution</h3>
<p><img src="images/1_adae_tte_Wei_Quan.jpg" /></p>
<p><a href="#example1%20code">link to code</a></p>
<p><a id="example2"></a></p>
<h3 id="example-2-co-occurence">Example 2: Co-occurence</h3>
<p><img src="images/2_adae_cor_Wei_Quan.jpg" /></p>
<p><a href="#example2%20code">link to code</a></p>
<p><a id="example3"></a></p>
<h3 id="example-3-frequency-and-severity-of-drug-related-and-unrelated-adverse-events-in-different-primary-organ-systems-and-treatment-groups">Example 3: Frequency and severity of drug-related and unrelated adverse events, in different primary organ systems and treatment groups</h3>
<p><img src="images/Fig1_sevAE_organSys_drugRel-ThomasWeissensteiner.png" /></p>
<p><a href="#example3%20code">link to code</a></p>
<p><a id="example4"></a></p>
<h3 id="example-4-frequency-and-seriousness-of-drug-related-and-unrelated-adverse-events-in-different-primary-organ-systems-and-treatment-groups">Example 4: Frequency and seriousness of drug-related and unrelated adverse events, in different primary organ systems and treatment groups</h3>
<p>The “seriousness” of an adverse event is determined by several other categories, including whether the event was related to cancer or congential disease, hospitalisation, disability or death.
<img src="https://www.cdisc.org/sites/default/files/kb/Concept_Maps_AE_6.png" alt="Assessment of seriousness" /></p>
<p>“Seriousness” and “severity” form overlapping but non-identical sets.
<br></p>
<p><img src="images/Fig2_srsAE_organSys_drugRel-ThomasWeissensteiner.png" /></p>
<p><a href="#example4%20code">link to code</a></p>
<p><a id="example5"></a></p>
<h3 id="example-5-frequency-of-drug-related-and-unrelated-adverse-events-stratified-by-primary-organ-system-treatment-groups-and-patient-sex">Example 5: Frequency of drug-related and unrelated adverse events, stratified by primary organ system, treatment groups, and patient sex</h3>
<p><img src="images/Fig2b_srsAE_organSys_sex-ThomasWeissensteiner.png" /></p>
<p><a href="#example5%20code">link to code</a></p>
<p>A Practical and Efficient Approach in Generating AE (Adverse Events) Tables within a Clinical Study Environment. Jiannan Hu Vertex Pharmaceuticals, Inc., NESUG 2011
<a href="https://www.lexjansen.com/nesug/nesug11/cc/cc13.pdf" class="uri">https://www.lexjansen.com/nesug/nesug11/cc/cc13.pdf</a>
“Adverse event analysis is a pivotal piece in the safety analysis, and it is common in almost every trial, and every clinical study report. The adverse events related to study drug will be summarized, as well as by severity, by relationship. They are tabulated by MedDRA system organ class (SOC) and preferred term (PT), and <em>each subject is counted only once</em>, and the sorting is by descending frequency of SOC and PT”</p>
<p><a id="example6"></a></p>
<h3 id="example-6-toxicity-grade-affected-primary-organ-system-of-the-most-severe-adverse-event-stratified-by-treatment-adverse-event-relation-to-drug-and-patient-sex">Example 6: Toxicity grade, affected primary organ system of the most severe adverse event, stratified by treatment, adverse event relation to drug, and patient sex</h3>
<p><img src="images/Fig3_patientMax_orgSys_drugRel_sex-ThomasWeissensteiner.png" /></p>
<p><a href="#example6%20code">link to code</a></p>
<p><a id="example7"></a></p>
<h3 id="example-7-toxicity-grade-affected-primary-organ-system-of-the-most-severe-adverse-event-stratified-by-treatment-adverse-event-relation-to-drug-and-patient-race">Example 7: Toxicity grade, affected primary organ system of the most severe adverse event, stratified by treatment, adverse event relation to drug, and patient race</h3>
<p><img src="images/Fig4_patientMax_orgSys_drugRel_race-ThomasWeissensteiner.png" /></p>
<p><a href="#example7%20code">link to code</a></p>
<p><a id="example8"></a></p>
<h3 id="example-8-discretisation-of-biomarker-1-measurements">Example 8: Discretisation of biomarker 1 measurements</h3>
<p>Biomarker 1 data were measurements were a continuous variable, whereas biomarker 2 were recorded as “low”, “medium”, or “high”. This plot shows how I discretised biomarker 1 measurements, and compares the numbers of patients in each treatment group and biomarker level category.
Discretising biomarker 1 allows using it as the colour-coded variable in the same kind of plot as the two above.</p>
<p><img src="images/Fig5_bmkrs-ThomasWeissensteiner.png" /></p>
<p><a href="#example8%20code">link to code</a></p>
<p><a id="example9"></a></p>
<h3 id="example-9-toxicity-grade-and-affected-primary-organ-system-of-the-most-severe-adverse-event-in-each-patient-stratified-by-treatment-adverse-event-relation-to-drug-and-biomarker-1-categorical-level">Example 9: Toxicity grade and affected primary organ system of the most severe adverse event in each patient, stratified by treatment, adverse event relation to drug, and biomarker 1 categorical level</h3>
<p><img src="images/Fig6_patientMax_orgSys_drugRel_bmrkr1-ThomasWeissensteiner.png" /></p>
<p><a href="#example9%20code">link to code</a></p>
<p><a id="example10"></a></p>
<h3 id="example-10-fatal-aes-and-cause-of-death-visualising-membership-in-multiple-sets-and-their-intersections">Example 10: Fatal AEs and cause of death: Visualising membership in multiple sets and their intersections</h3>
<p>The ASDL categories AEOUT = FATAL and DTHCAUS = ADVERSE EVENT are related but serve different purposes in the context of clinical trial data.
When AEOUT (Outcome of Adverse Event) is set to “FATAL,” it means that the adverse event resulted in the death of the subject.
When DTHCAUS (Cause of Death) is set to “ADVERSE EVENT,” it indicates that the cause of death was an adverse event.
AEOUT = FATAL indicates that the adverse event led to death, while DTHCAUS = ADVERSE EVENT specifies that the cause of death was the adverse event itself <sup>2</sup>.
Use AEOUT = FATAL to indicate the outcome of the adverse event and DTHCAUS = ADVERSE EVENT to specify the cause of death when reporting deaths from treatment-related adverse events.
If an adverse event is determined to be related to the treatment (AEREL), and the outcome of the adverse event is fatal (AEOUT = FATAL), then the cause of death (DTHCAUS) would likely be reported as an adverse event.</p>
<p>What is the difference between AEs recorded in AEOUT and DTHCAUS?
If “fatal adverse events”, represent actual deaths, than their frequency appears extremely high. On the other hand, if “cause of death” represents real fatal events, why is there so little overlap with “fatal” or “serious” adverse events?</p>
<p><img src="images/Fig8_fatalAE_dthCaus-ThomasWeissensteiner.png" /></p>
<p><a href="#example10%20code">link to code</a></p>
<p>You may find an updated version of a document containing examples 3 to 10 on: <a href="https://rpubs.com/thomas-weissensteiner">Rpubs/thomas-weissensteiner</a>.</p>
<h2 id="code">Code</h2>
<p><a id="example1 code"></a></p>
<h3 id="example-1.-violin-plot-on-onset-and-resolution">Example 1. Violin plot on onset and resolution</h3>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'>##############################################</span></span>
<span><span class='co'># Author: Wei Quan</span></span>
<span><span class='co'># Latest Update: 04 Feb 2025</span></span>
<span><span class='co'># PSI Visualization SIG Wonderful Wednesday: Adverse events</span></span>
<span><span class='co'># Sample ADAE dataset generated using teal.data package in R.</span></span>
<span><span class='co'># Data limited to two treatments (Drug X, Placebo),although subjects may switch between the two</span></span>
<span><span class='co'># Challenge: produce a visualization using this sample ADAE dataset The challenge is open-ended,</span></span>
<span><span class='co'># and you can choose a feature of the data to focus on.</span></span>
<span><span class='co'># Possible ideas:</span></span>
<span><span class='co'># Investigate the co-occurrence of adverse events (the October 2020 webinar might provide some inspiration!)</span></span>
<span><span class='co'># or ‘clusters’ of adverse events – do certain groups of adverse events tend to occur alongside one another or at certain times</span></span>
<span><span class='co'># Investigate the time to a given event or adverse event profiles over time</span></span>
<span><span class='co'># Explore the hierarchical nature of adverse events (MedDRA terms)</span></span>
<span><span class='co'>###############################################</span></span>
<span></span>
<span><span class='co'>## Load the packages -----------------</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://tidyverse.tidyverse.org'>tidyverse</a></span><span class='op'>)</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/therneau/survival'>survival</a></span><span class='op'>)</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='http://www.sthda.com/english/wiki/ggcorrplot-visualization-of-a-correlation-matrix-using-ggplot2'>ggcorrplot</a></span><span class='op'>)</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://patchwork.data-imaginist.com'>patchwork</a></span><span class='op'>)</span></span>
<span></span>
<span><span class='co'>## Set up environment----------------</span></span>
<span><span class='fu'><a href='https://rdrr.io/r/base/rm.html'>rm</a></span><span class='op'>(</span>list <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/ls.html'>ls</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='co'># setwd(dirname(rstudioapi::getActiveDocumentContext()$path))</span></span>
<span><span class='fu'><a href='https://rdrr.io/r/base/options.html'>options</a></span><span class='op'>(</span>warn <span class='op'>=</span> <span class='fl'>0</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>mytheme</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>{</span></span>
<span>  <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_minimal</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span></span>
<span>      plot.title <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>size <span class='op'>=</span> <span class='fl'>16</span><span class='op'>)</span>,</span>
<span>      axis.title <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>size <span class='op'>=</span> <span class='fl'>12</span><span class='op'>)</span>,</span>
<span>      axis.text <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>size <span class='op'>=</span> <span class='fl'>10</span><span class='op'>)</span>,</span>
<span>      legend.text <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>size <span class='op'>=</span> <span class='fl'>10</span><span class='op'>)</span>,</span>
<span>      legend.title <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>size <span class='op'>=</span> <span class='fl'>12</span><span class='op'>)</span></span>
<span>    <span class='op'>)</span></span>
<span>  <span class='op'>)</span></span>
<span><span class='op'>}</span></span>
<span></span>
<span><span class='co'>## Read data---------</span></span>
<span></span>
<span><span class='va'>adae</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/utils/read.table.html'>read.csv</a></span><span class='op'>(</span><span class='st'>"https://raw.githubusercontent.com/VIS-SIG/Wonderful-Wednesdays/refs/heads/master/data/2025/2025-01-08/DummyAEData.csv"</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='op'>-</span><span class='va'>X</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>SAFFL</span> <span class='op'>==</span> <span class='st'>"Y"</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># total</span></span>
<span><span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/unique.html'>unique</a></span><span class='op'>(</span><span class='va'>adae</span><span class='op'>$</span><span class='va'>USUBJID</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='va'>adae</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='va'>adae</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'>## Summary table------------</span></span>
<span></span>
<span><span class='va'>adae_n_arm</span> <span class='op'>&lt;-</span> <span class='va'>adae</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>ARMCD</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise</a></span><span class='op'>(</span>n_arm <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/n_distinct.html'>n_distinct</a></span><span class='op'>(</span><span class='va'>USUBJID</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>adae_n_soc</span> <span class='op'>&lt;-</span> <span class='va'>adae</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>AESOC</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise</a></span><span class='op'>(</span>n_soc <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/n_distinct.html'>n_distinct</a></span><span class='op'>(</span><span class='va'>USUBJID</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>adae_n_pt</span> <span class='op'>&lt;-</span> <span class='va'>adae</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>AETERM</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise</a></span><span class='op'>(</span>n_pt <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/n_distinct.html'>n_distinct</a></span><span class='op'>(</span><span class='va'>USUBJID</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'>## Visual-----------</span></span>
<span></span>
<span><span class='co'>### SOC by PT-------------------</span></span>
<span><span class='op'>(</span><span class='va'>adae_soc_pt</span> <span class='op'>&lt;-</span> <span class='va'>adae</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>ARMCD</span>, <span class='va'>AESOC</span>, <span class='va'>AETERM</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise</a></span><span class='op'>(</span>n_pt <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/n_distinct.html'>n_distinct</a></span><span class='op'>(</span><span class='va'>USUBJID</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate-joins.html'>right_join</a></span><span class='op'>(</span><span class='va'>adae_n_arm</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>AETERM</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>n_all <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>n_pt</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>ungroup</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>n_pt <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='va'>ARMCD</span> <span class='op'>==</span> <span class='st'>"ARM B"</span>, <span class='op'>-</span><span class='va'>n_pt</span>, <span class='va'>n_pt</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span></span>
<span><span class='co'>### tte--------------</span></span>
<span></span>
<span><span class='op'>(</span><span class='va'>adae_tte</span> <span class='op'>&lt;-</span> <span class='va'>adae</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>USUBJID</span>, <span class='va'>ARMCD</span>, <span class='va'>AESOC</span>, <span class='va'>AETERM</span>, <span class='va'>AETOXGR</span>, <span class='va'>ASTDY</span>, <span class='va'>AENDY</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/arrange.html'>arrange</a></span><span class='op'>(</span><span class='va'>USUBJID</span>, <span class='va'>ARMCD</span>, <span class='va'>AESOC</span>, <span class='va'>AETERM</span>, <span class='va'>AETOXGR</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>event <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>adae_tte_counts</span> <span class='op'>&lt;-</span> <span class='va'>adae_tte</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>AESOC</span>, <span class='va'>ARMCD</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise</a></span><span class='op'>(</span>n <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/context.html'>n</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>ungroup</a></span><span class='op'>(</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>adae_tte_g3_counts</span> <span class='op'>&lt;-</span> <span class='va'>adae_tte</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>AETOXGR</span> <span class='op'>&gt;=</span> <span class='fl'>3</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>AESOC</span>, <span class='va'>ARMCD</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise</a></span><span class='op'>(</span>n <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/context.html'>n</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>ungroup</a></span><span class='op'>(</span><span class='op'>)</span></span>
<span></span>
<span><span class='op'>(</span><span class='va'>adae_tte_subject</span> <span class='op'>&lt;-</span></span>
<span>  <span class='va'>adae_tte</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>ARMCD</span>, <span class='va'>USUBJID</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span></span>
<span>    any_AE <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/context.html'>n</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>&gt;</span> <span class='fl'>0</span>, <span class='fl'>1</span>, <span class='fl'>0</span><span class='op'>)</span>,</span>
<span>    time_to_onset_any_AE <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/context.html'>n</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>&gt;</span> <span class='fl'>0</span>, <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>min</a></span><span class='op'>(</span><span class='va'>ASTDY</span><span class='op'>)</span>, <span class='cn'>Inf</span><span class='op'>)</span>,</span>
<span>    time_to_stop_any_AE <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/context.html'>n</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>&gt;</span> <span class='fl'>0</span>, <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>max</a></span><span class='op'>(</span><span class='va'>ASTDY</span><span class='op'>)</span>, <span class='cn'>Inf</span><span class='op'>)</span></span>
<span>  <span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>AESOC</span>, <span class='va'>ARMCD</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>n <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/n_distinct.html'>n_distinct</a></span><span class='op'>(</span><span class='va'>USUBJID</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>ungroup</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span><span class='op'>(</span><span class='va'>p1</span> <span class='op'>&lt;-</span> <span class='va'>adae_tte</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_violin.html'>geom_violin</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>AESOC</span>, y <span class='op'>=</span> <span class='va'>ASTDY</span>, fill <span class='op'>=</span> <span class='va'>ARMCD</span><span class='op'>)</span>,</span>
<span>    scale <span class='op'>=</span> <span class='st'>"count"</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span></span>
<span>    title <span class='op'>=</span> <span class='st'>"AE onset by SOC"</span>,</span>
<span>    x <span class='op'>=</span> <span class='st'>"SOC"</span>,</span>
<span>    y <span class='op'>=</span> <span class='st'>"Time from first dose (days)"</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_text.html'>geom_text</a></span><span class='op'>(</span></span>
<span>    data <span class='op'>=</span> <span class='va'>adae_tte_counts</span>,</span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span></span>
<span>      x <span class='op'>=</span> <span class='va'>AESOC</span>, y <span class='op'>=</span> <span class='op'>-</span><span class='fl'>40</span>, label <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"N="</span>, <span class='va'>n</span><span class='op'>)</span>,</span>
<span>      group <span class='op'>=</span> <span class='va'>ARMCD</span></span>
<span>    <span class='op'>)</span>,</span>
<span>    position <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/position_dodge.html'>position_dodge</a></span><span class='op'>(</span>width <span class='op'>=</span> <span class='fl'>0.75</span><span class='op'>)</span>,</span>
<span>    size <span class='op'>=</span> <span class='fl'>3</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_y_continuous</a></span><span class='op'>(</span>limits <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>50</span>, <span class='fl'>1200</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>mytheme</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/coord_flip.html'>coord_flip</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span><span class='op'>(</span><span class='va'>p2</span> <span class='op'>&lt;-</span> <span class='va'>adae_tte</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_violin.html'>geom_violin</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>AESOC</span>, y <span class='op'>=</span> <span class='va'>AENDY</span> <span class='op'>-</span> <span class='va'>ASTDY</span> <span class='op'>+</span> <span class='fl'>1</span>, fill <span class='op'>=</span> <span class='va'>ARMCD</span><span class='op'>)</span>,</span>
<span>    scale <span class='op'>=</span> <span class='st'>"count"</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span></span>
<span>    title <span class='op'>=</span> <span class='st'>"AE resolution by SOC"</span>,</span>
<span>    x <span class='op'>=</span> <span class='st'>"SOC"</span>,</span>
<span>    y <span class='op'>=</span> <span class='st'>"Time since AE onset (days)"</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_text.html'>geom_text</a></span><span class='op'>(</span></span>
<span>    data <span class='op'>=</span> <span class='va'>adae_tte_counts</span>,</span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span></span>
<span>      x <span class='op'>=</span> <span class='va'>AESOC</span>, y <span class='op'>=</span> <span class='op'>-</span><span class='fl'>40</span>, label <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"N="</span>, <span class='va'>n</span><span class='op'>)</span>,</span>
<span>      group <span class='op'>=</span> <span class='va'>ARMCD</span></span>
<span>    <span class='op'>)</span>,</span>
<span>    position <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/position_dodge.html'>position_dodge</a></span><span class='op'>(</span>width <span class='op'>=</span> <span class='fl'>0.75</span><span class='op'>)</span>,</span>
<span>    size <span class='op'>=</span> <span class='fl'>3</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_y_continuous</a></span><span class='op'>(</span>limits <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>50</span>, <span class='fl'>1200</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>mytheme</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/coord_flip.html'>coord_flip</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span><span class='op'>(</span><span class='va'>p3</span> <span class='op'>&lt;-</span> <span class='va'>adae_tte</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>AETOXGR</span> <span class='op'>&gt;=</span> <span class='fl'>3</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_violin.html'>geom_violin</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>AESOC</span>, y <span class='op'>=</span> <span class='va'>ASTDY</span>, fill <span class='op'>=</span> <span class='va'>ARMCD</span><span class='op'>)</span>,</span>
<span>    scale <span class='op'>=</span> <span class='st'>"count"</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span></span>
<span>    title <span class='op'>=</span> <span class='st'>"AE onset by SOC (Grade &gt;=3)"</span>,</span>
<span>    x <span class='op'>=</span> <span class='st'>"SOC"</span>,</span>
<span>    y <span class='op'>=</span> <span class='st'>"Time from first dose (days)"</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_text.html'>geom_text</a></span><span class='op'>(</span></span>
<span>    data <span class='op'>=</span> <span class='va'>adae_tte_g3_counts</span>,</span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span></span>
<span>      x <span class='op'>=</span> <span class='va'>AESOC</span>, y <span class='op'>=</span> <span class='op'>-</span><span class='fl'>40</span>, label <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"N="</span>, <span class='va'>n</span><span class='op'>)</span>,</span>
<span>      group <span class='op'>=</span> <span class='va'>ARMCD</span></span>
<span>    <span class='op'>)</span>,</span>
<span>    position <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/position_dodge.html'>position_dodge</a></span><span class='op'>(</span>width <span class='op'>=</span> <span class='fl'>0.75</span><span class='op'>)</span>,</span>
<span>    size <span class='op'>=</span> <span class='fl'>3</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_y_continuous</a></span><span class='op'>(</span>limits <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>50</span>, <span class='fl'>1200</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>mytheme</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/coord_flip.html'>coord_flip</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span><span class='op'>(</span><span class='va'>p4</span> <span class='op'>&lt;-</span> <span class='va'>adae_tte</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>AETOXGR</span> <span class='op'>&gt;=</span> <span class='fl'>3</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_violin.html'>geom_violin</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>AESOC</span>, y <span class='op'>=</span> <span class='va'>AENDY</span> <span class='op'>-</span> <span class='va'>ASTDY</span> <span class='op'>+</span> <span class='fl'>1</span>, fill <span class='op'>=</span> <span class='va'>ARMCD</span><span class='op'>)</span>,</span>
<span>    scale <span class='op'>=</span> <span class='st'>"count"</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span></span>
<span>    title <span class='op'>=</span> <span class='st'>"AE resolution by SOC (Grade &gt;=3)"</span>,</span>
<span>    x <span class='op'>=</span> <span class='st'>"SOC"</span>,</span>
<span>    y <span class='op'>=</span> <span class='st'>"Time since AE onset (days)"</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_text.html'>geom_text</a></span><span class='op'>(</span></span>
<span>    data <span class='op'>=</span> <span class='va'>adae_tte_g3_counts</span>,</span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span></span>
<span>      x <span class='op'>=</span> <span class='va'>AESOC</span>, y <span class='op'>=</span> <span class='op'>-</span><span class='fl'>40</span>, label <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"N="</span>, <span class='va'>n</span><span class='op'>)</span>,</span>
<span>      group <span class='op'>=</span> <span class='va'>ARMCD</span></span>
<span>    <span class='op'>)</span>,</span>
<span>    position <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/position_dodge.html'>position_dodge</a></span><span class='op'>(</span>width <span class='op'>=</span> <span class='fl'>0.75</span><span class='op'>)</span>,</span>
<span>    size <span class='op'>=</span> <span class='fl'>3</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_y_continuous</a></span><span class='op'>(</span>limits <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>50</span>, <span class='fl'>1200</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>mytheme</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/coord_flip.html'>coord_flip</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span><span class='op'>(</span><span class='va'>combined_p</span> <span class='op'>&lt;-</span> <span class='op'>(</span><span class='va'>p1</span> <span class='op'>|</span> <span class='va'>p2</span><span class='op'>)</span> <span class='op'>/</span> <span class='op'>(</span><span class='va'>p3</span> <span class='op'>|</span> <span class='va'>p4</span><span class='op'>)</span> <span class='op'>+</span> <span class='fu'><a href='https://patchwork.data-imaginist.com/reference/plot_layout.html'>plot_layout</a></span><span class='op'>(</span>guides <span class='op'>=</span> <span class='st'>"collect"</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span><span class='fu'><a href='https://rdrr.io/r/grDevices/png.html'>tiff</a></span><span class='op'>(</span><span class='st'>"adae_tte.tiff"</span>, units <span class='op'>=</span> <span class='st'>"in"</span>, width <span class='op'>=</span> <span class='fl'>13</span>, height <span class='op'>=</span> <span class='fl'>7</span>, res <span class='op'>=</span> <span class='fl'>300</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='va'>combined_p</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://rdrr.io/r/grDevices/dev.html'>dev.off</a></span><span class='op'>(</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<p><a href="#example1">Back to blog</a></p>
<p><a id="example2 code"></a></p>
<h3 id="example-2.-co-occurence">Example 2. Co-occurence</h3>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'>##############################################</span></span>
<span><span class='co'># Author: Wei Quan</span></span>
<span><span class='co'># Latest Update: 04 Feb 2025</span></span>
<span><span class='co'># PSI Visualization SIG Wonderful Wednesday: Adverse events</span></span>
<span><span class='co'># Sample ADAE dataset generated using teal.data package in R.</span></span>
<span><span class='co'># Data limited to two treatments (Drug X, Placebo),although subjects may switch between the two</span></span>
<span><span class='co'># Challenge: produce a visualization using this sample ADAE dataset The challenge is open-ended,</span></span>
<span><span class='co'># and you can choose a feature of the data to focus on.</span></span>
<span><span class='co'># Possible ideas:</span></span>
<span><span class='co'># Investigate the co-occurrence of adverse events (the October 2020 webinar might provide some inspiration!)</span></span>
<span><span class='co'># or ‘clusters’ of adverse events – do certain groups of adverse events tend to occur alongside one another or at certain times</span></span>
<span><span class='co'># Investigate the time to a given event or adverse event profiles over time</span></span>
<span><span class='co'># Explore the hierarchical nature of adverse events (MedDRA terms)</span></span>
<span><span class='co'>###############################################</span></span>
<span></span>
<span><span class='co'>## Load the packages -----------------</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://tidyverse.tidyverse.org'>tidyverse</a></span><span class='op'>)</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/therneau/survival'>survival</a></span><span class='op'>)</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='http://www.sthda.com/english/wiki/ggcorrplot-visualization-of-a-correlation-matrix-using-ggplot2'>ggcorrplot</a></span><span class='op'>)</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://patchwork.data-imaginist.com'>patchwork</a></span><span class='op'>)</span></span>
<span></span>
<span><span class='co'>## Set up environment----------------</span></span>
<span><span class='fu'><a href='https://rdrr.io/r/base/rm.html'>rm</a></span><span class='op'>(</span>list <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/ls.html'>ls</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='co'># setwd(dirname(rstudioapi::getActiveDocumentContext()$path))</span></span>
<span><span class='fu'><a href='https://rdrr.io/r/base/options.html'>options</a></span><span class='op'>(</span>warn <span class='op'>=</span> <span class='fl'>0</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>mytheme</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>{</span></span>
<span>  <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_minimal</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span></span>
<span>      plot.title <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>size <span class='op'>=</span> <span class='fl'>16</span><span class='op'>)</span>,</span>
<span>      axis.title <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>size <span class='op'>=</span> <span class='fl'>12</span><span class='op'>)</span>,</span>
<span>      axis.text <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>size <span class='op'>=</span> <span class='fl'>10</span><span class='op'>)</span>,</span>
<span>      legend.text <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>size <span class='op'>=</span> <span class='fl'>10</span><span class='op'>)</span>,</span>
<span>      legend.title <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>size <span class='op'>=</span> <span class='fl'>12</span><span class='op'>)</span></span>
<span>    <span class='op'>)</span></span>
<span>  <span class='op'>)</span></span>
<span><span class='op'>}</span></span>
<span></span>
<span><span class='co'>## Read data---------</span></span>
<span></span>
<span><span class='va'>adae</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/utils/read.table.html'>read.csv</a></span><span class='op'>(</span><span class='st'>"https://raw.githubusercontent.com/VIS-SIG/Wonderful-Wednesdays/refs/heads/master/data/2025/2025-01-08/DummyAEData.csv"</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='op'>-</span><span class='va'>X</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>SAFFL</span> <span class='op'>==</span> <span class='st'>"Y"</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># total</span></span>
<span><span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/unique.html'>unique</a></span><span class='op'>(</span><span class='va'>adae</span><span class='op'>$</span><span class='va'>USUBJID</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='va'>adae</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='va'>adae</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'>## Summary table------------</span></span>
<span></span>
<span><span class='va'>adae_n_arm</span> <span class='op'>&lt;-</span> <span class='va'>adae</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>ARMCD</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise</a></span><span class='op'>(</span>n_arm <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/n_distinct.html'>n_distinct</a></span><span class='op'>(</span><span class='va'>USUBJID</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>adae_n_soc</span> <span class='op'>&lt;-</span> <span class='va'>adae</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>AESOC</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise</a></span><span class='op'>(</span>n_soc <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/n_distinct.html'>n_distinct</a></span><span class='op'>(</span><span class='va'>USUBJID</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>adae_n_pt</span> <span class='op'>&lt;-</span> <span class='va'>adae</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>AETERM</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise</a></span><span class='op'>(</span>n_pt <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/n_distinct.html'>n_distinct</a></span><span class='op'>(</span><span class='va'>USUBJID</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'>## Visual-----------</span></span>
<span></span>
<span><span class='co'>### SOC by PT-------------------</span></span>
<span><span class='op'>(</span><span class='va'>adae_soc_pt</span> <span class='op'>&lt;-</span> <span class='va'>adae</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>ARMCD</span>, <span class='va'>AESOC</span>, <span class='va'>AETERM</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise</a></span><span class='op'>(</span>n_pt <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/n_distinct.html'>n_distinct</a></span><span class='op'>(</span><span class='va'>USUBJID</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate-joins.html'>right_join</a></span><span class='op'>(</span><span class='va'>adae_n_arm</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>AETERM</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>n_all <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>n_pt</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>ungroup</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>n_pt <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='va'>ARMCD</span> <span class='op'>==</span> <span class='st'>"ARM B"</span>, <span class='op'>-</span><span class='va'>n_pt</span>, <span class='va'>n_pt</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'>## visual</span></span>
<span></span>
<span><span class='op'>(</span><span class='va'>p_pt</span> <span class='op'>&lt;-</span> <span class='va'>adae_soc_pt</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/reorder.factor.html'>reorder</a></span><span class='op'>(</span><span class='va'>AETERM</span>, <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>abs</a></span><span class='op'>(</span><span class='va'>n_pt</span><span class='op'>)</span>, decreasing <span class='op'>=</span> <span class='cn'>T</span><span class='op'>)</span>, y <span class='op'>=</span> <span class='va'>n_pt</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_bar.html'>geom_bar</a></span><span class='op'>(</span></span>
<span>    stat <span class='op'>=</span> <span class='st'>"identity"</span>, width <span class='op'>=</span> <span class='fl'>0.5</span>,</span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>fill <span class='op'>=</span> <span class='va'>AESOC</span>, group <span class='op'>=</span> <span class='va'>ARMCD</span>, color <span class='op'>=</span> <span class='va'>ARMCD</span><span class='op'>)</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_brewer.html'>scale_fill_brewer</a></span><span class='op'>(</span>palette <span class='op'>=</span> <span class='st'>"Greens"</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_brewer.html'>scale_color_brewer</a></span><span class='op'>(</span>palette <span class='op'>=</span> <span class='st'>"Paired"</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span></span>
<span>    title <span class='op'>=</span> <span class='st'>"Number of patients with PT"</span>,</span>
<span>    x <span class='op'>=</span> <span class='st'>""</span>,</span>
<span>    y <span class='op'>=</span> <span class='st'>""</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_y_continuous</a></span><span class='op'>(</span>labels <span class='op'>=</span> <span class='va'>abs</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_abline.html'>geom_hline</a></span><span class='op'>(</span>yintercept <span class='op'>=</span> <span class='fl'>0</span>, color <span class='op'>=</span> <span class='st'>"grey20"</span>, size <span class='op'>=</span> <span class='fl'>0.8</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>mytheme</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>axis.text.x <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>angle <span class='op'>=</span> <span class='fl'>60</span>, vjust <span class='op'>=</span> <span class='fl'>0.5</span>, hjust <span class='op'>=</span> <span class='fl'>0.5</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span><span class='fu'><a href='https://rdrr.io/r/grDevices/png.html'>tiff</a></span><span class='op'>(</span><span class='st'>"adae_pt.tiff"</span>, units <span class='op'>=</span> <span class='st'>"in"</span>, width <span class='op'>=</span> <span class='fl'>8</span>, height <span class='op'>=</span> <span class='fl'>5</span>, res <span class='op'>=</span> <span class='fl'>150</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='va'>p_pt</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://rdrr.io/r/grDevices/dev.html'>dev.off</a></span><span class='op'>(</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'>### Co-occurrence --------------------------</span></span>
<span></span>
<span><span class='va'>adae_dummy</span> <span class='op'>&lt;-</span> <span class='fu'>fastDummies</span><span class='fu'>::</span><span class='fu'><a href='https://jacobkap.github.io/fastDummies/reference/dummy_cols.html'>dummy_cols</a></span><span class='op'>(</span><span class='va'>adae</span>, select_columns <span class='op'>=</span> <span class='st'>"AETERM"</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>ARMCD</span>, <span class='va'>USUBJID</span>, <span class='fu'><a href='https://tidyselect.r-lib.org/reference/starts_with.html'>starts_with</a></span><span class='op'>(</span><span class='st'>"AETERM_trm"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>ARMCD</span>, <span class='va'>USUBJID</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise</a></span><span class='op'>(</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/across.html'>across</a></span><span class='op'>(</span><span class='fu'><a href='https://tidyselect.r-lib.org/reference/everything.html'>everything</a></span><span class='op'>(</span><span class='op'>)</span>, <span class='va'>sum</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>ungroup</a></span><span class='op'>(</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>cor</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/cor.html'>cor</a></span><span class='op'>(</span><span class='va'>adae_dummy</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='fu'><a href='https://tidyselect.r-lib.org/reference/starts_with.html'>starts_with</a></span><span class='op'>(</span><span class='st'>"AETERM_trm"</span><span class='op'>)</span><span class='op'>)</span>,</span>
<span>  method <span class='op'>=</span> <span class='st'>"spearman"</span></span>
<span><span class='op'>)</span>, <span class='fl'>2</span><span class='op'>)</span></span>
<span></span>
<span><span class='op'>(</span><span class='va'>p_cor</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/ggcorrplot/man/ggcorrplot.html'>ggcorrplot</a></span><span class='op'>(</span><span class='va'>cor</span>,</span>
<span>  method <span class='op'>=</span> <span class='st'>"circle"</span>,</span>
<span>  type <span class='op'>=</span> <span class='st'>"full"</span>,</span>
<span>  lab <span class='op'>=</span> <span class='st'>"TRUE"</span>,</span>
<span>  outline.color <span class='op'>=</span> <span class='st'>"white"</span>,</span>
<span>  colors <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"black"</span>, <span class='st'>"white"</span>, <span class='st'>"red"</span><span class='op'>)</span>,</span>
<span>  lab_size <span class='op'>=</span> <span class='fl'>3</span>,</span>
<span>  show.legend <span class='op'>=</span> <span class='cn'>F</span></span>
<span><span class='op'>)</span> <span class='op'>+</span> <span class='fu'>mytheme</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>axis.text.x <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>angle <span class='op'>=</span> <span class='fl'>60</span>, vjust <span class='op'>=</span> <span class='fl'>1</span>, hjust <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span></span>
<span>    title <span class='op'>=</span> <span class='st'>"AE Co-occurence at Patient Level"</span>,</span>
<span>    x <span class='op'>=</span> <span class='st'>""</span>,</span>
<span>    y <span class='op'>=</span> <span class='st'>""</span>,</span>
<span>    caption <span class='op'>=</span> <span class='st'>"Correlation is calculated at patient level based on number of events, using Spearman's correlation matrix."</span></span>
<span>  <span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span><span class='op'>(</span><span class='va'>p_pt_2</span> <span class='op'>&lt;-</span> <span class='va'>adae_soc_pt</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>AETERM</span>, y <span class='op'>=</span> <span class='va'>n_pt</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_bar.html'>geom_bar</a></span><span class='op'>(</span></span>
<span>    stat <span class='op'>=</span> <span class='st'>"identity"</span>, width <span class='op'>=</span> <span class='fl'>0.5</span>,</span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>fill <span class='op'>=</span> <span class='va'>AESOC</span>, group <span class='op'>=</span> <span class='va'>ARMCD</span><span class='op'>)</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_brewer.html'>scale_fill_brewer</a></span><span class='op'>(</span>palette <span class='op'>=</span> <span class='st'>"Set2"</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span></span>
<span>    title <span class='op'>=</span> <span class='st'>"Number of patients with PT"</span>,</span>
<span>    x <span class='op'>=</span> <span class='st'>""</span>,</span>
<span>    y <span class='op'>=</span> <span class='st'>"Arm B - Arm A"</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_y_continuous</a></span><span class='op'>(</span>labels <span class='op'>=</span> <span class='va'>abs</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_abline.html'>geom_hline</a></span><span class='op'>(</span>yintercept <span class='op'>=</span> <span class='fl'>0</span>, color <span class='op'>=</span> <span class='st'>"grey20"</span>, size <span class='op'>=</span> <span class='fl'>0.8</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>mytheme</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span></span>
<span>    axis.text.x <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>    axis.ticks.x <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span></span>
<span>  <span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span><span class='op'>(</span><span class='va'>combined_p_cor</span> <span class='op'>&lt;-</span> <span class='op'>(</span><span class='va'>p_pt_2</span> <span class='op'>/</span> <span class='va'>p_cor</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span><span class='fu'><a href='https://rdrr.io/r/grDevices/png.html'>tiff</a></span><span class='op'>(</span><span class='st'>"adae_cor.tiff"</span>, units <span class='op'>=</span> <span class='st'>"in"</span>, width <span class='op'>=</span> <span class='fl'>10</span>, height <span class='op'>=</span> <span class='fl'>10</span>, res <span class='op'>=</span> <span class='fl'>300</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='va'>combined_p_cor</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://rdrr.io/r/grDevices/dev.html'>dev.off</a></span><span class='op'>(</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<p><a href="#example2">Back to blog</a></p>
<h3 id="preparation-for-example-3-to-10">Preparation for example 3 to 10</h3>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'>#################################</span></span>
<span><span class='co'># Author: Thomas Weissensteiner #</span></span>
<span><span class='co'>#################################</span></span>
<span></span>
<span><span class='co'># - chunk libraries_and_data</span></span>
<span></span>
<span><span class='co'>## Load R libraries and the data file                             - #</span></span>
<span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://dplyr.tidyverse.org'>dplyr</a></span><span class='op'>)</span>        <span class='co'># version 1.1.4  # general grammar</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://purrr.tidyverse.org/'>purrr</a></span><span class='op'>)</span>        <span class='co'># version 1.0.2  # set_names, list_rbind, reduce</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://tidyr.tidyverse.org'>tidyr</a></span><span class='op'>)</span>        <span class='co'># version 1.3.1  # pivot_longer, pivot_wider</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://tibble.tidyverse.org/'>tibble</a></span><span class='op'>)</span>       <span class='co'># version 3.2.1  # deframe</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://purrr.tidyverse.org/'>purrr</a></span><span class='op'>)</span>        <span class='co'># version 1.0.2  # list_rbind</span></span>
<span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://ggplot2.tidyverse.org'>ggplot2</a></span><span class='op'>)</span>      <span class='co'># version 3.4.0  # graphs</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/eclarke/ggbeeswarm'>ggbeeswarm</a></span><span class='op'>)</span>   <span class='co'># version 0.7.2  # geom_beeswarm</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/teunbrand/ggh4x'>ggh4x</a></span><span class='op'>)</span>        <span class='co'># version 0.3.0  # facet_grid2</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/gaospecial/ggVennDiagram'>ggVennDiagram</a></span><span class='op'>)</span><span class='co'># version 1.5.2  # ggVennDiagram</span></span>
<span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://patchwork.data-imaginist.com'>patchwork</a></span><span class='op'>)</span>    <span class='co'># version 1.3.0  # assembly of interactive plots, synchronous response</span></span>
<span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='http://haozhu233.github.io/kableExtra/'>kableExtra</a></span><span class='op'>)</span>   <span class='co'># rendering tables in HTML format</span></span>
<span></span>
<span><span class='va'>dummyAEData</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/utils/read.table.html'>read.csv</a></span><span class='op'>(</span><span class='st'>"https://raw.githubusercontent.com/VIS-SIG/Wonderful-Wednesdays/refs/heads/master/data/2025/2025-01-08/DummyAEData.csv"</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># - chunk data_check</span></span>
<span><span class='co'># - Required: R libraries, dummyAEData (chunk libraries_and_data)</span></span>
<span></span>
<span><span class='co'># - This chunk reproduces my initial checks for non-informative and redundant data columns, and the following cleaning and transformation steps</span></span>
<span><span class='co'># - The results is a new data frame dummyAEData_ed (edited) which is required for the generation of the figures below</span></span>
<span><span class='co'># - Instead of this chunk, you can run chunk_dataEd below which generates dummyAEData_ed in a more concise way, without checks on intermediate results </span></span>
<span></span>
<span><span class='va'>dummyAEData</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> <span class='fu'><a href='https://rdrr.io/r/base/dim.html'>dim</a></span><span class='op'>(</span><span class='op'>)</span></span>
<span><span class='co'># [1] 599  93            Original data set has 599 rows and 93 columns</span></span>
<span></span>
<span><span class='co'>## Remove columns that do not differentiate any patient groups</span></span>
<span></span>
<span><span class='co'># Identify columns containing duplicated information (the same values in same rows)</span></span>
<span><span class='va'>singleValCols</span> <span class='op'>&lt;-</span> </span>
<span>  <span class='va'>dummyAEData</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>    <span class='fu'><a href='https://rdrr.io/r/base/apply.html'>apply</a></span><span class='op'>(</span><span class='va'>.</span>, <span class='fl'>2</span>, <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='fu'><a href='https://rdrr.io/r/base/unique.html'>unique</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>    <span class='va'>length</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> <span class='va'>.</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span><span class='op'>(</span><span class='va'>.</span><span class='op'>)</span><span class='op'>==</span><span class='fl'>1</span><span class='op'>]</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> <span class='va'>names</span></span>
<span><span class='co'># singleValCols</span></span>
<span><span class='co'># [1] "STUDYID"  "AGEU"     "ITTFL"    "SAFFL"    "TRTEMFL"  "SMQ02NAM" "SMQ02SC" </span></span>
<span></span>
<span><span class='co'># Identify columns comprised of NAs </span></span>
<span><span class='va'>naCols</span> <span class='op'>&lt;-</span> </span>
<span>  <span class='va'>dummyAEData</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>    <span class='fu'><a href='https://rdrr.io/r/base/apply.html'>apply</a></span><span class='op'>(</span><span class='va'>.</span>, <span class='fl'>2</span>, <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='fu'><a href='https://rdrr.io/r/base/unlist.html'>unlist</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> <span class='op'>{</span><span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>.</span><span class='op'>)</span><span class='op'>}</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>    <span class='va'>sum</span> <span class='op'>==</span> <span class='fl'>0</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> <span class='va'>.</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span><span class='op'>(</span><span class='va'>.</span><span class='op'>)</span><span class='op'>==</span><span class='fl'>1</span><span class='op'>]</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> <span class='va'>names</span></span>
<span><span class='co'># naCols</span></span>
<span><span class='co'>#[1] "SMQ02NAM" "SMQ02SC" </span></span>
<span></span>
<span><span class='co'># Start generating a data subset with "interesting" columns only</span></span>
<span><span class='va'>dummyAEData_ed</span> <span class='op'>&lt;-</span> </span>
<span>  <span class='va'>dummyAEData</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span></span>
<span>      <span class='op'>!</span><span class='fu'><a href='https://tidyselect.r-lib.org/reference/all_of.html'>all_of</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>singleValCols</span>, <span class='va'>naCols</span><span class='op'>)</span> <span class='op'>)</span> </span>
<span>      <span class='op'>)</span></span>
<span></span>
<span><span class='co'># Remove other columns with no patient-specific information</span></span>
<span><span class='va'>dummyAEData_ed</span> <span class='op'>&lt;-</span></span>
<span>  <span class='va'>dummyAEData_ed</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='op'>!</span><span class='va'>X</span><span class='op'>)</span></span>
<span></span>
<span></span>
<span><span class='co'>## Remove columns with redundant information</span></span>
<span></span>
<span><span class='co'># Function for flagging redundant columns</span></span>
<span><span class='va'>check_redundant_columns</span> <span class='op'>&lt;-</span> </span>
<span>  <span class='kw'>function</span><span class='op'>(</span><span class='va'>data</span><span class='op'>)</span> <span class='op'>{</span></span>
<span>    <span class='va'>pairs</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/utils/combn.html'>combn</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>data</span><span class='op'>)</span>, <span class='fl'>2</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> <span class='va'>t</span></span>
<span>    <span class='va'>redundant</span> <span class='op'>&lt;-</span> </span>
<span>      <span class='fu'><a href='https://rdrr.io/r/utils/combn.html'>combn</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>data</span><span class='op'>)</span>, <span class='fl'>2</span>, <span class='kw'>function</span><span class='op'>(</span><span class='va'>cols</span><span class='op'>)</span> <span class='op'>{</span></span>
<span>        <span class='va'>col1</span> <span class='op'>&lt;-</span> <span class='va'>data</span><span class='op'>[[</span><span class='va'>cols</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>]</span><span class='op'>]</span></span>
<span>        <span class='va'>col2</span> <span class='op'>&lt;-</span> <span class='va'>data</span><span class='op'>[[</span><span class='va'>cols</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span><span class='op'>]</span><span class='op'>]</span></span>
<span>        <span class='kw'>if</span> <span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/factor.html'>is.factor</a></span><span class='op'>(</span><span class='va'>col1</span><span class='op'>)</span><span class='op'>)</span> <span class='va'>col1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/character.html'>as.character</a></span><span class='op'>(</span><span class='va'>col1</span><span class='op'>)</span>        <span class='co'># converts variables that are factors to character</span></span>
<span>        <span class='kw'>if</span> <span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/factor.html'>is.factor</a></span><span class='op'>(</span><span class='va'>col2</span><span class='op'>)</span><span class='op'>)</span> <span class='va'>col2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/character.html'>as.character</a></span><span class='op'>(</span><span class='va'>col2</span><span class='op'>)</span></span>
<span>        <span class='kw'>if</span> <span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>is.numeric</a></span><span class='op'>(</span><span class='va'>col1</span><span class='op'>)</span> <span class='op'>&amp;&amp;</span> <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>is.numeric</a></span><span class='op'>(</span><span class='va'>col2</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span></span>
<span>          <span class='fu'><a href='https://rdrr.io/r/base/all.html'>all</a></span><span class='op'>(</span></span>
<span>            <span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>col1</span><span class='op'>)</span> <span class='op'>&amp;</span> <span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>col2</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>|</span>                      <span class='co'># both NA or floating point near equality for numeric columns</span></span>
<span>            <span class='op'>(</span><span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>col1</span><span class='op'>)</span> <span class='op'>&amp;</span> <span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>col2</span><span class='op'>)</span> <span class='op'>&amp;</span> <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/near.html'>near</a></span><span class='op'>(</span><span class='va'>col1</span>, <span class='va'>col2</span><span class='op'>)</span><span class='op'>)</span> </span>
<span>            <span class='op'>)</span></span>
<span>          <span class='op'>}</span> <span class='kw'>else</span> <span class='op'>{</span></span>
<span>          <span class='fu'><a href='https://rdrr.io/r/base/all.html'>all</a></span><span class='op'>(</span></span>
<span>            <span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>col1</span><span class='op'>)</span> <span class='op'>&amp;</span> <span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>col2</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>|</span>                      <span class='co'># both NA or exact equality for non-numeric columns</span></span>
<span>            <span class='op'>(</span><span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>col1</span><span class='op'>)</span> <span class='op'>&amp;</span> <span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>col2</span><span class='op'>)</span> <span class='op'>&amp;</span> <span class='va'>col1</span> <span class='op'>==</span> <span class='va'>col2</span><span class='op'>)</span></span>
<span>          <span class='op'>)</span></span>
<span>        <span class='op'>}</span></span>
<span>      <span class='op'>}</span></span>
<span>    <span class='op'>)</span></span>
<span>    <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span>Pairs <span class='op'>=</span> <span class='va'>pairs</span>, Redundant <span class='op'>=</span> <span class='va'>redundant</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>Redundant</span><span class='op'>==</span> <span class='cn'>TRUE</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>Pairs.1</span> <span class='op'><a href='https://rdrr.io/r/base/match.html'>%in%</a></span> <span class='fu'><a href='https://generics.r-lib.org/reference/setops.html'>setdiff</a></span><span class='op'>(</span><span class='va'>.</span><span class='op'>$</span><span class='va'>Pairs.1</span>, <span class='va'>.</span><span class='op'>$</span><span class='va'>Pairs.2</span><span class='op'>)</span><span class='op'>)</span>  <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>  </span>
<span>    <span class='fu'><a href='https://rdrr.io/r/base/with.html'>with</a></span><span class='op'>(</span><span class='va'>.</span>, <span class='fu'><a href='https://rdrr.io/r/base/table.html'>table</a></span><span class='op'>(</span><span class='va'>Pairs.1</span>, <span class='va'>Pairs.2</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>    <span class='op'>{</span> <span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>lapply</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span><span class='op'>(</span><span class='va'>.</span><span class='op'>)</span>, <span class='kw'>function</span><span class='op'>(</span><span class='va'>i</span><span class='op'>)</span> </span>
<span>      <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>.</span><span class='op'>)</span><span class='op'>[</span><span class='va'>i</span><span class='op'>]</span>,</span>
<span>      <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span><span class='op'>(</span><span class='va'>.</span><span class='op'>)</span><span class='op'>[</span><span class='va'>.</span><span class='op'>[</span><span class='va'>i</span>,<span class='op'>]</span> <span class='op'>==</span> <span class='fl'>1</span><span class='op'>]</span></span>
<span>      <span class='op'>)</span></span>
<span>    <span class='op'>)</span></span>
<span>    <span class='op'>}</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> <span class='fu'><a href='https://rdrr.io/r/base/unname.html'>unname</a></span><span class='op'>(</span><span class='op'>)</span></span>
<span>  <span class='op'>}</span></span>
<span><span class='co'># Note: if no redundant columns are found this function will generate: </span></span>
<span><span class='co'># Error in `[.default`(., i, ) : subscript out of bounds</span></span>
<span><span class='co'># Called from: NextMethod()</span></span>
<span></span>
<span><span class='co'># Check for identical columns (will not identify redundant columns if values are coded differently)</span></span>
<span><span class='va'>redundant_columns</span> <span class='op'>&lt;-</span> <span class='va'>dummyAEData_ed</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> <span class='fu'>check_redundant_columns</span><span class='op'>(</span><span class='op'>)</span> </span>
<span><span class='co'>#redundant_columns</span></span>
<span><span class='co'>#[[1]][1] "ARM"    "ACTARM" "TRT01A" "TRT01P"</span></span>
<span><span class='co'>#[[2]][1] "ARMCD"    "ACTARMCD"</span></span>
<span><span class='co'>#[[3]][1] "ASEQ"  "AESEQ"</span></span>
<span><span class='co'>#[[4]][1] "EOSSTT" "EOTSTT"</span></span>
<span><span class='co'>#[[5]][1] "TRT01EDTM" "AP01EDTM"  "AP02SDTM"  "TRT02SDTM"</span></span>
<span><span class='co'>#[[6]][1] "TRTEDTM"   "AP02EDTM"  "TRT02EDTM"</span></span>
<span><span class='co'>#[[7]][1] "TRTSDTM"   "AP01SDTM"  "TRT01SDTM"</span></span>
<span></span>
<span></span>
<span><span class='co'># Selection of non-redundant variables</span></span>
<span><span class='co'># TRT01A: actual initial treatment (other variables refer to planned treatment)</span></span>
<span><span class='co'># ACTARMCD: "a value for an Actual Arm Code (ACTARMCD) variable is expected to be equal to a value of an Arm Code (ARMCD) variable"(FDAC197 / SD2236)</span></span>
<span><span class='co'># AESEQ: name indicates relation to AEs, which we are specifically interested in</span></span>
<span><span class='co'># EOTSTT: end of treatment and end of study status seem identical in this data set, kept name referring to treatment</span></span>
<span><span class='co'># TRTSDTM: datetime of First Exposure to Treatment</span></span>
<span><span class='co'># TRT01EDTM: datetime of Last Exposure in Period 01 (identical to TRT02SDTM: Datetime of First Exposure to Treatment in Period 02)</span></span>
<span><span class='co'># TRT02EDTM: datetime of Last Exposure in Period 02</span></span>
<span><span class='va'>selected_columns</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"TRT01A"</span>, <span class='st'>"ACTARMCD"</span>, <span class='st'>"AESEQ"</span>, <span class='st'>"EOTSTT"</span>, <span class='st'>"TRTSDTM"</span>, <span class='st'>"TRT01EDTM"</span>, <span class='st'>"TRT02EDTM"</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>dummyAEData_ed</span> <span class='op'>&lt;-</span> </span>
<span>  <span class='va'>dummyAEData_ed</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span></span>
<span>    <span class='op'>!</span><span class='fu'><a href='https://generics.r-lib.org/reference/setops.html'>setdiff</a></span><span class='op'>(</span></span>
<span>      <span class='fu'><a href='https://rdrr.io/r/base/unlist.html'>unlist</a></span><span class='op'>(</span><span class='va'>redundant_columns</span><span class='op'>)</span>, </span>
<span>      <span class='va'>selected_columns</span></span>
<span>      <span class='op'>)</span> </span>
<span>    <span class='op'>)</span></span>
<span></span>
<span></span>
<span><span class='co'>## Remove columns with redundant information masked by different codings</span></span>
<span></span>
<span><span class='co'># Inspect adverse event variables</span></span>
<span><span class='co'># dummyAEData_ed %&gt;% .[ ,grep("AE", names(.))] %&gt;% head()</span></span>
<span></span>
<span><span class='co'># Unify coding of potentially redundant variables</span></span>
<span><span class='va'>dummyAEData_ed</span> <span class='op'>&lt;-</span> </span>
<span>  <span class='va'>dummyAEData_ed</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span></span>
<span>    AETERM <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/grep.html'>gsub</a></span><span class='op'>(</span><span class='st'>"trm "</span>, <span class='st'>""</span>, <span class='va'>AETERM</span><span class='op'>)</span>,                 <span class='co'># adverse event variables</span></span>
<span>    AELLT <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/grep.html'>gsub</a></span><span class='op'>(</span><span class='st'>"llt "</span>, <span class='st'>""</span>, <span class='va'>AELLT</span><span class='op'>)</span>,</span>
<span>    AEDECOD <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/grep.html'>gsub</a></span><span class='op'>(</span><span class='st'>"dcd "</span>, <span class='st'>""</span>, <span class='va'>AEDECOD</span><span class='op'>)</span>,</span>
<span>    AEHLT <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/grep.html'>gsub</a></span><span class='op'>(</span><span class='st'>"hlt "</span>, <span class='st'>""</span>, <span class='va'>AEHLT</span><span class='op'>)</span>,</span>
<span>    AEHLGT <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/grep.html'>gsub</a></span><span class='op'>(</span><span class='st'>"hlgt "</span>, <span class='st'>""</span>, <span class='va'>AEHLGT</span><span class='op'>)</span>,</span>
<span>    AEBODSYS <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/grep.html'>gsub</a></span><span class='op'>(</span><span class='st'>"cl "</span>, <span class='st'>""</span>, <span class='va'>AEBODSYS</span><span class='op'>)</span>,</span>
<span>    AESOC <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/grep.html'>gsub</a></span><span class='op'>(</span><span class='st'>"cl "</span>, <span class='st'>""</span>, <span class='va'>AESOC</span><span class='op'>)</span>,</span>
<span>    ACTARMCD <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/case_when.html'>case_when</a></span><span class='op'>(</span>                              <span class='co'># treatment group</span></span>
<span>      <span class='va'>ACTARMCD</span> <span class='op'>==</span> <span class='st'>"ARM A"</span> <span class='op'>~</span> <span class='st'>"Drug X"</span>,</span>
<span>      <span class='va'>ACTARMCD</span> <span class='op'>==</span> <span class='st'>"ARM B"</span> <span class='op'>~</span> <span class='st'>"Placebo"</span></span>
<span>      <span class='op'>)</span>,</span>
<span>    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/across.html'>across</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>TRT01A</span>, <span class='va'>TRT02P</span>, <span class='va'>TRT02A</span><span class='op'>)</span>, </span>
<span>      <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='fu'><a href='https://rdrr.io/r/base/grep.html'>gsub</a></span><span class='op'>(</span><span class='st'>"^[AB]: "</span>, <span class='st'>""</span>, <span class='va'>x</span><span class='op'>)</span></span>
<span>      <span class='op'>)</span>,</span>
<span>    SMQ01SC <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/case_when.html'>case_when</a></span><span class='op'>(</span></span>
<span>      <span class='va'>SMQ01NAM</span> <span class='op'>==</span> <span class='st'>"C.1.1.1.3/B.2.2.3.1 AESI"</span> <span class='op'>~</span> <span class='st'>"C.1.1.1.3/B.2.2.3.1 AESI"</span>,</span>
<span>      <span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>SMQ01NAM</span><span class='op'>)</span> <span class='op'>~</span> <span class='cn'>NA</span></span>
<span>      <span class='op'>)</span></span>
<span>    <span class='op'>)</span></span>
<span></span>
<span><span class='co'># dummyAEData_ed %&gt;% check_redundant_columns()</span></span>
<span><span class='co'>#[1]][1] "ACTARMCD" "TRT01A"  </span></span>
<span><span class='co'>#[[2]][1] "AETERM"  "AEDECOD" "AELLT"</span></span>
<span><span class='co'>#[[3]][1] "SMQ01NAM" "SMQ01SC"</span></span>
<span></span>
<span><span class='co'># Selection of non-redundant variables, merging of 1st and 2nd treatment variables into a single cross-over group variable</span></span>
<span><span class='co'># TRT01A: Actual initial treatment </span></span>
<span><span class='co'># AEDECOD: also called preferred term, restricted to a single medical concept</span></span>
<span><span class='va'>dummyAEData_ed</span> <span class='op'>&lt;-</span> </span>
<span>  <span class='va'>dummyAEData_ed</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>ACTARMCD</span>, <span class='va'>AETERM</span>, <span class='va'>AELLT</span>, <span class='va'>SMQ01SC</span><span class='op'>)</span> <span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/rowwise.html'>rowwise</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span></span>
<span>    Group <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste</a></span><span class='op'>(</span><span class='va'>TRT01A</span>, <span class='st'>"-"</span>, <span class='va'>TRT02A</span><span class='op'>)</span>,</span>
<span>    .keep <span class='op'>=</span> <span class='st'>"unused"</span></span>
<span>    <span class='op'>)</span></span>
<span></span>
<span><span class='co'># Remove additional columns with information included in other columns</span></span>
<span><span class='va'>dummyAEData_ed</span> <span class='op'>&lt;-</span> </span>
<span>  <span class='va'>dummyAEData_ed</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>USUBJID</span>, <span class='va'>INVID</span>, <span class='va'>INVNAM</span><span class='op'>)</span> <span class='op'>)</span>    <span class='co'># covered by SITEID and SUBJID </span></span>
<span></span>
<span></span>
<span><span class='co'>## Generate some categorical variables and ordered factors</span></span>
<span></span>
<span><span class='va'>dummyAEData_ed</span> <span class='op'>&lt;-</span> </span>
<span>  <span class='va'>dummyAEData_ed</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span></span>
<span>    AESEV <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span>                                    </span>
<span>      <span class='va'>AESEV</span>, levels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"MILD"</span>, <span class='st'>"MODERATE"</span>, <span class='st'>"SEVERE"</span><span class='op'>)</span></span>
<span>      <span class='op'>)</span>,</span>
<span>    BMRKR2 <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span></span>
<span>      <span class='va'>BMRKR2</span>, levels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"HIGH"</span>, <span class='st'>"MEDIUM"</span>, <span class='st'>"LOW"</span><span class='op'>)</span></span>
<span>      <span class='op'>)</span>,</span>
<span>    Group <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span></span>
<span>      <span class='va'>Group</span>, </span>
<span>      levels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span></span>
<span>        <span class='st'>"Placebo - Placebo"</span>, </span>
<span>        <span class='st'>"Drug X - Placebo"</span>, </span>
<span>        <span class='st'>"Placebo - Drug X"</span>, </span>
<span>        <span class='st'>"Drug X - Drug X"</span></span>
<span>        <span class='op'>)</span></span>
<span>      <span class='op'>)</span>,</span>
<span>    AEREL <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/case_when.html'>case_when</a></span> <span class='op'>(</span></span>
<span>      <span class='va'>AEREL</span> <span class='op'>==</span> <span class='st'>"Y"</span> <span class='op'>~</span> <span class='st'>"Drug-related"</span>, </span>
<span>      <span class='va'>AEREL</span> <span class='op'>==</span> <span class='st'>"N"</span> <span class='op'>~</span> <span class='st'>"Not drug-related"</span></span>
<span>      <span class='op'>)</span>,</span>
<span>    AEREL <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span></span>
<span>      <span class='va'>AEREL</span>, </span>
<span>      levels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Drug-related"</span>, <span class='st'>"Not drug-related"</span><span class='op'>)</span></span>
<span>      <span class='op'>)</span>,</span>
<span>    AESER <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span></span>
<span>      <span class='va'>AESER</span>, </span>
<span>      levels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Y"</span>, <span class='st'>"N"</span><span class='op'>)</span></span>
<span>      <span class='op'>)</span>,</span>
<span>    AESEV_2 <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/case_when.html'>case_when</a></span><span class='op'>(</span></span>
<span>      <span class='va'>AESEV</span> <span class='op'>==</span> <span class='st'>"SEVERE"</span> <span class='op'>~</span> <span class='st'>"Severe"</span>,</span>
<span>      <span class='va'>AESEV</span> <span class='op'><a href='https://rdrr.io/r/base/match.html'>%in%</a></span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"MILD"</span>, <span class='st'>"MODERATE"</span><span class='op'>)</span> <span class='op'>~</span> <span class='st'>"Mild-moderate"</span></span>
<span>      <span class='op'>)</span>,</span>
<span>      .keep <span class='op'>=</span> <span class='st'>"unused"</span>,</span>
<span>    AESEV_2 <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>AESEV_2</span>, </span>
<span>      levels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Severe"</span>, <span class='st'>"Mild-moderate"</span><span class='op'>)</span></span>
<span>      <span class='op'>)</span>,</span>
<span>    SEX <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span></span>
<span>      <span class='va'>SEX</span>, </span>
<span>      levels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"F"</span>, <span class='st'>"M"</span><span class='op'>)</span><span class='op'>)</span>,</span>
<span>    RACE <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/case_when.html'>case_when</a></span><span class='op'>(</span></span>
<span>      <span class='va'>RACE</span> <span class='op'>==</span> <span class='st'>"NATIVE HAWAIIAN OR OTHER PACIFIC ISLANDER"</span> <span class='op'>~</span> <span class='st'>"Pacific Ilander"</span>,</span>
<span>      <span class='va'>RACE</span> <span class='op'>==</span> <span class='st'>"AMERICAN INDIAN OR ALASKA NATIVE"</span> <span class='op'>~</span> <span class='st'>"American Indian"</span>,</span>
<span>      <span class='va'>RACE</span> <span class='op'>==</span> <span class='st'>"BLACK OR AFRICAN AMERICAN"</span> <span class='op'>~</span> <span class='st'>"Black"</span>,</span>
<span>      <span class='va'>RACE</span> <span class='op'>==</span> <span class='st'>"WHITE"</span> <span class='op'>~</span> <span class='st'>"White"</span>,</span>
<span>      <span class='va'>RACE</span> <span class='op'>==</span> <span class='st'>"ASIAN"</span> <span class='op'>~</span> <span class='st'>"Asian"</span></span>
<span>      <span class='op'>)</span>,</span>
<span>    RACE <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span></span>
<span>      <span class='va'>RACE</span>, </span>
<span>      levels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>                                                  <span class='co'># ordered by number of patients</span></span>
<span>        <span class='st'>"Pacific Ilander"</span>,</span>
<span>        <span class='st'>"American Indian"</span>,</span>
<span>        <span class='st'>"Black"</span>,</span>
<span>        <span class='st'>"White"</span>,</span>
<span>        <span class='st'>"Asian"</span><span class='op'>)</span></span>
<span>      <span class='op'>)</span></span>
<span>    <span class='op'>)</span></span>
<span></span>
<span></span>
<span><span class='co'>## Some initial summaries and observations</span></span>
<span></span>
<span><span class='co'># Observations (rows) by treatment groups</span></span>
<span><span class='va'>dummyAEData_ed</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>Group</span>,  <span class='va'>TRT02P</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise</a></span><span class='op'>(</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/context.html'>n</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='co'># A tibble: 8 × 4</span></span>
<span><span class='co'>## Groups:   TRT01A, TRT02P [4]</span></span>
<span><span class='co'>#  TRT01A  TRT02P  TRT02A  `n()`</span></span>
<span><span class='co'>#  &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;int&gt;</span></span>
<span><span class='co'>#1 Drug X  Drug X  Drug X     53</span></span>
<span><span class='co'>#2 Drug X  Drug X  Placebo    93</span></span>
<span><span class='co'>#3 Drug X  Placebo Drug X     99</span></span>
<span><span class='co'>#4 Drug X  Placebo Placebo    66</span></span>
<span><span class='co'>#5 Placebo Drug X  Drug X     76</span></span>
<span><span class='co'>#6 Placebo Drug X  Placebo    65</span></span>
<span><span class='co'>#7 Placebo Placebo Drug X     79</span></span>
<span><span class='co'>#8 Placebo Placebo Placebo    68</span></span>
<span><span class='co'># Possible scenario:</span></span>
<span><span class='co'># - TRT01A: actual treatment for the blinded placebo-controlled period</span></span>
<span><span class='co'># - TRT02P: planned treatment of the subsequent open label period</span></span>
<span><span class='co'># - TRT02A: actual subsequent treatment</span></span>
<span></span>
<span><span class='co'># Numbers of unique types of adverse events for each level of the term hierarchy (increasing order)</span></span>
<span><span class='va'>dummyAEData_ed</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>  <span class='va'>data.frame</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarize</a></span> <span class='op'>(</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/across.html'>across</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>AEDECOD</span>, <span class='va'>AEHLT</span>, <span class='va'>AEHLGT</span>, <span class='va'>AEBODSYS</span>, <span class='va'>AESOC</span><span class='op'>)</span>, <span class='kw'>function</span> <span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='fu'><a href='https://rdrr.io/r/base/unique.html'>unique</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> <span class='va'>length</span> <span class='op'>)</span><span class='op'>)</span></span>
<span><span class='co'>#  AEDECOD AEHLT AEHLGT AEBODSYS AESOC</span></span>
<span><span class='co'>#       10     9      8        7     4</span></span>
<span></span>
<span><span class='va'>dummyAEData_ed</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>AEDECOD</span>, <span class='va'>AEHLT</span>, <span class='va'>AEHLGT</span>, <span class='va'>AEBODSYS</span>, <span class='va'>AESOC</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarize</a></span> <span class='op'>(</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/context.html'>n</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='co'># A tibble: 10 × 6</span></span>
<span><span class='co'># Groups:   AEDECOD, AEHLT, AEHLGT, AEBODSYS [10]</span></span>
<span><span class='co'>#   AEDECOD   AEHLT   AEHLGT AEBODSYS AESOC `n()`</span></span>
<span><span class='co'>#   &lt;chr&gt;     &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;    &lt;chr&gt; &lt;int&gt;</span></span>
<span><span class='co'># 1 A.1.1.1.1 A.1.1.1 A.1.1  A.1      A        65</span></span>
<span><span class='co'># 2 A.1.1.1.2 A.1.1.1 A.1.1  A.1      A        65</span></span>
<span><span class='co'># 3 B.1.1.1.1 B.1.1.1 B.1.1  B.1      B        48</span></span>
<span><span class='co'># 4 B.2.1.2.1 B.2.1.2 B.2.1  B.2      B        62</span></span>
<span><span class='co'># 5 B.2.2.3.1 B.2.2.3 B.2.2  B.2      B        68</span></span>
<span><span class='co'># 6 C.1.1.1.3 C.1.1.1 C.1.1  C.1      C        63</span></span>
<span><span class='co'># 7 C.2.1.2.1 C.2.1.2 C.2.1  C.2      C        43</span></span>
<span><span class='co'># 8 D.1.1.1.1 D.1.1.1 D.1.1  D.1      D        53</span></span>
<span><span class='co'># 9 D.1.1.4.2 D.1.1.4 D.1.1  D.1      D        66</span></span>
<span><span class='co'>#10 D.2.1.5.3 D.2.1.5 D.2.1  D.2      D        66</span></span>
<span></span>
<span><span class='co'># Severe vs. serious AEs</span></span>
<span><span class='va'>dummyAEData_ed</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>AESEV</span>, <span class='va'>AESER</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise</a></span> <span class='op'>(</span>N<span class='op'>=</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/context.html'>n</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='co'># Groups:   AESEV [3]</span></span>
<span><span class='co'>#  AESEV    AESER     N</span></span>
<span><span class='co'>#  &lt;fct&gt;    &lt;chr&gt; &lt;int&gt;</span></span>
<span><span class='co'>#1 MILD     N       131</span></span>
<span><span class='co'>#2 MILD     Y        68</span></span>
<span><span class='co'>#3 MODERATE N       171</span></span>
<span><span class='co'>#4 MODERATE Y        65</span></span>
<span><span class='co'>#5 SEVERE   N        63</span></span>
<span><span class='co'>#6 SEVERE   Y       101</span></span>
<span></span>
<span><span class='co'># Deaths</span></span>
<span></span>
<span><span class='co'># DTHADY: relative time of death</span></span>
<span></span>
<span><span class='co'># Look up columns with with information on patient death</span></span>
<span></span>
<span><span class='va'>dummyAEData_ed</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> <span class='va'>.</span><span class='op'>[</span> ,<span class='fu'><a href='https://rdrr.io/r/base/grep.html'>grep</a></span><span class='op'>(</span><span class='st'>"DTH"</span>, <span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>.</span><span class='op'>)</span><span class='op'>)</span><span class='op'>]</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> <span class='va'>head</span></span>
<span></span>
<span><span class='co'># DTHFL, ADTHAUT, DTHCAUS, DTHCAT are redundant when filtered for DTHCAT = NA or DTHFL == "N"</span></span>
<span><span class='va'>dummyAEData_ed</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>DTHFL</span>, <span class='va'>ADTHAUT</span>, <span class='va'>DTHCAUS</span>, <span class='va'>DTHCAT</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>DTHCAT</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>DTHFL <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/case_when.html'>case_when</a></span><span class='op'>(</span><span class='va'>DTHFL</span> <span class='op'>==</span> <span class='st'>"N"</span> <span class='op'>~</span> <span class='cn'>NA</span><span class='op'>)</span> <span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>    <span class='fu'>check_redundant_columns</span><span class='op'>(</span><span class='op'>)</span> </span>
<span><span class='co'>#[[1]][1] "DTHFL"   "ADTHAUT" "DTHCAT"  "DTHCAUS"</span></span>
<span></span>
<span><span class='va'>dummyAEData_ed</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>DTHFL</span>, <span class='va'>ADTHAUT</span>, <span class='va'>DTHCAUS</span>, <span class='va'>DTHCAT</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>DTHFL</span> <span class='op'>==</span> <span class='st'>"N"</span> <span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>DTHFL <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/case_when.html'>case_when</a></span><span class='op'>(</span><span class='va'>DTHFL</span> <span class='op'>==</span> <span class='st'>"N"</span> <span class='op'>~</span> <span class='cn'>NA</span><span class='op'>)</span> <span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>  <span class='fu'>check_redundant_columns</span><span class='op'>(</span><span class='op'>)</span></span>
<span><span class='co'>#[[1]][1] "DTHFL"   "ADTHAUT" "DTHCAT"  "DTHCAUS"</span></span>
<span></span>
<span><span class='co'># AETOXGR 5 is *not* defined by patient death: maximum toxicity of patients' AEs in DTHCAUS = ADVERSE EVENT can be as low as 1:</span></span>
<span><span class='va'>dummyAEData_ed</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>SUBJID</span>, <span class='va'>AETOXGR</span>, <span class='va'>DTHFL</span>, <span class='va'>ADTHAUT</span>, <span class='va'>DTHCAUS</span>, <span class='va'>DTHCAT</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span> <span class='op'>(</span><span class='va'>DTHCAUS</span> <span class='op'>==</span> <span class='st'>"ADVERSE EVENT"</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>SUBJID</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/slice.html'>slice</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/which.min.html'>which.max</a></span><span class='op'>(</span><span class='va'>AETOXGR</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/arrange.html'>arrange</a></span><span class='op'>(</span><span class='va'>AETOXGR</span><span class='op'>)</span> </span>
<span><span class='co'># A tibble: 9 × 6</span></span>
<span><span class='co'># Groups:   SUBJID [9]</span></span>
<span><span class='co'>#  SUBJID AETOXGR DTHFL ADTHAUT DTHCAUS       DTHCAT       </span></span>
<span><span class='co'>#  &lt;chr&gt;    &lt;int&gt; &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;         &lt;chr&gt;        </span></span>
<span><span class='co'>#1 id-386       1 Y     Yes     ADVERSE EVENT ADVERSE EVENT</span></span>
<span><span class='co'>#2 id-134       3 Y     Yes     ADVERSE EVENT ADVERSE EVENT</span></span>
<span><span class='co'>#3 id-128       4 Y     Yes     ADVERSE EVENT ADVERSE EVENT</span></span>
<span><span class='co'>#4 id-62        4 Y     Yes     ADVERSE EVENT ADVERSE EVENT</span></span>
<span><span class='co'>#5 id-126       5 Y     Yes     ADVERSE EVENT ADVERSE EVENT</span></span>
<span><span class='co'>#6 id-139       5 Y     Yes     ADVERSE EVENT ADVERSE EVENT</span></span>
<span><span class='co'>#7 id-235       5 Y     Yes     ADVERSE EVENT ADVERSE EVENT</span></span>
<span><span class='co'>#8 id-319       5 Y     Yes     ADVERSE EVENT ADVERSE EVENT</span></span>
<span><span class='co'>#9 id-346       5 Y     Yes     ADVERSE EVENT ADVERSE EVENT</span></span>
<span><span class='co'># Same result with filter (DTHCAT == "ADVERSE EVENT" )</span></span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># - chunk dataEd</span></span>
<span><span class='co'># - Required: R libraries, dummyAEData (chunk libraries_and_data)</span></span>
<span></span>
<span><span class='co'># - This chunk generates dummyAEData_ed (edited) in a more concise way than data_check</span></span>
<span><span class='co'># - dummyAEData_ed is required for the generation of all of the following figures</span></span>
<span></span>
<span></span>
<span><span class='co'>## Remove columns without patient-specific information, comprised of NA values, or containing duplicated information (the same values in same rows)</span></span>
<span></span>
<span><span class='va'>naCols</span> <span class='op'>&lt;-</span> </span>
<span>  <span class='va'>dummyAEData</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>    <span class='fu'><a href='https://rdrr.io/r/base/apply.html'>apply</a></span><span class='op'>(</span><span class='va'>.</span>, <span class='fl'>2</span>, <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='fu'><a href='https://rdrr.io/r/base/unlist.html'>unlist</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> <span class='op'>{</span><span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>.</span><span class='op'>)</span><span class='op'>}</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>    <span class='va'>sum</span> <span class='op'>==</span> <span class='fl'>0</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> <span class='va'>.</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span><span class='op'>(</span><span class='va'>.</span><span class='op'>)</span><span class='op'>==</span><span class='fl'>1</span><span class='op'>]</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> <span class='va'>names</span></span>
<span></span>
<span><span class='va'>singleValCols</span> <span class='op'>&lt;-</span> </span>
<span>  <span class='va'>dummyAEData</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>    <span class='fu'><a href='https://rdrr.io/r/base/apply.html'>apply</a></span><span class='op'>(</span><span class='va'>.</span>, <span class='fl'>2</span>, <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='fu'><a href='https://rdrr.io/r/base/unique.html'>unique</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>    <span class='va'>length</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> <span class='va'>.</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span><span class='op'>(</span><span class='va'>.</span><span class='op'>)</span><span class='op'>==</span><span class='fl'>1</span><span class='op'>]</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> <span class='va'>names</span></span>
<span></span>
<span><span class='va'>dummyAEData_ed</span> <span class='op'>&lt;-</span> </span>
<span>  <span class='va'>dummyAEData</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span></span>
<span>      <span class='op'>!</span><span class='va'>X</span> <span class='op'>&amp;</span></span>
<span>      <span class='op'>!</span><span class='fu'><a href='https://tidyselect.r-lib.org/reference/all_of.html'>all_of</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>singleValCols</span>, <span class='va'>naCols</span><span class='op'>)</span> <span class='op'>)</span></span>
<span>      <span class='op'>)</span></span>
<span></span>
<span></span>
<span><span class='co'>## Remove columns with redundant information</span></span>
<span></span>
<span><span class='va'>dummyAEData_ed</span> <span class='op'>&lt;-</span> </span>
<span>  <span class='va'>dummyAEData_ed</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span></span>
<span>    <span class='va'>ARM</span>, <span class='va'>ACTARM</span>, <span class='va'>ARMCD</span>, <span class='va'>ACTARMCD</span>, </span>
<span>    <span class='va'>AETERM</span>, <span class='va'>AELLT</span>, <span class='va'>SMQ01SC</span>,</span>
<span>    <span class='va'>TRT01P</span>, <span class='va'>ASEQ</span>, <span class='va'>EOSSTT</span>, </span>
<span>    <span class='va'>AP01EDTM</span>, <span class='va'>AP02SDTM</span>, </span>
<span>    <span class='va'>TRT02SDTM</span>, <span class='va'>TRTEDTM</span>, </span>
<span>    <span class='va'>AP02EDTM</span>, <span class='va'>AP01SDTM</span>, <span class='va'>TRT01SDTM</span>, </span>
<span>    <span class='va'>USUBJID</span>, <span class='va'>INVID</span>, <span class='va'>INVNAM</span><span class='op'>)</span> </span>
<span>    <span class='op'>)</span></span>
<span></span>
<span></span>
<span><span class='co'># Unify coding</span></span>
<span><span class='va'>dummyAEData_ed</span> <span class='op'>&lt;-</span> </span>
<span>  <span class='va'>dummyAEData_ed</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span></span>
<span>    AEDECOD <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/grep.html'>gsub</a></span><span class='op'>(</span><span class='st'>"dcd "</span>, <span class='st'>""</span>, <span class='va'>AEDECOD</span><span class='op'>)</span>,</span>
<span>    AEHLT <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/grep.html'>gsub</a></span><span class='op'>(</span><span class='st'>"hlt "</span>, <span class='st'>""</span>, <span class='va'>AEHLT</span><span class='op'>)</span>,</span>
<span>    AEHLGT <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/grep.html'>gsub</a></span><span class='op'>(</span><span class='st'>"hlgt "</span>, <span class='st'>""</span>, <span class='va'>AEHLGT</span><span class='op'>)</span>,</span>
<span>    AEBODSYS <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/grep.html'>gsub</a></span><span class='op'>(</span><span class='st'>"cl "</span>, <span class='st'>""</span>, <span class='va'>AEBODSYS</span><span class='op'>)</span>,</span>
<span>    AESOC <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/grep.html'>gsub</a></span><span class='op'>(</span><span class='st'>"cl "</span>, <span class='st'>""</span>, <span class='va'>AESOC</span><span class='op'>)</span>,</span>
<span>    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/across.html'>across</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>TRT01A</span>, <span class='va'>TRT02P</span>, <span class='va'>TRT02A</span><span class='op'>)</span>, </span>
<span>      <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='fu'><a href='https://rdrr.io/r/base/grep.html'>gsub</a></span><span class='op'>(</span><span class='st'>"^[AB]: "</span>, <span class='st'>""</span>, <span class='va'>x</span><span class='op'>)</span></span>
<span>      <span class='op'>)</span>,</span>
<span>    SMQ01SC <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/case_when.html'>case_when</a></span><span class='op'>(</span></span>
<span>      <span class='va'>SMQ01NAM</span> <span class='op'>==</span> <span class='st'>"C.1.1.1.3/B.2.2.3.1 AESI"</span> <span class='op'>~</span> <span class='st'>"C.1.1.1.3/B.2.2.3.1 AESI"</span>,</span>
<span>      <span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>SMQ01NAM</span><span class='op'>)</span> <span class='op'>~</span> <span class='cn'>NA</span></span>
<span>      <span class='op'>)</span></span>
<span>    <span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/rowwise.html'>rowwise</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span></span>
<span>    Group <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste</a></span><span class='op'>(</span><span class='va'>TRT01A</span>, <span class='st'>"-"</span>, <span class='va'>TRT02A</span><span class='op'>)</span>,</span>
<span>    .keep <span class='op'>=</span> <span class='st'>"unused"</span></span>
<span>    <span class='op'>)</span></span>
<span></span>
<span></span>
<span><span class='co'>## Generate some categorical variables and ordered factors</span></span>
<span></span>
<span><span class='va'>dummyAEData_ed</span> <span class='op'>&lt;-</span> </span>
<span>  <span class='va'>dummyAEData_ed</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span></span>
<span>    AESEV <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span>                                    </span>
<span>      <span class='va'>AESEV</span>, levels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"MILD"</span>, <span class='st'>"MODERATE"</span>, <span class='st'>"SEVERE"</span><span class='op'>)</span></span>
<span>      <span class='op'>)</span>,</span>
<span>    BMRKR2 <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span></span>
<span>      <span class='va'>BMRKR2</span>, levels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"HIGH"</span>, <span class='st'>"MEDIUM"</span>, <span class='st'>"LOW"</span><span class='op'>)</span></span>
<span>      <span class='op'>)</span>,</span>
<span>    Group <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span></span>
<span>      <span class='va'>Group</span>, </span>
<span>      levels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span></span>
<span>        <span class='st'>"Placebo - Placebo"</span>, <span class='st'>"Placebo - Drug X"</span>, </span>
<span>        <span class='st'>"Drug X - Placebo"</span>, <span class='st'>"Drug X - Drug X"</span></span>
<span>        <span class='op'>)</span></span>
<span>      <span class='op'>)</span>,</span>
<span>    AEREL <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/case_when.html'>case_when</a></span> <span class='op'>(</span></span>
<span>      <span class='va'>AEREL</span> <span class='op'>==</span> <span class='st'>"Y"</span> <span class='op'>~</span> <span class='st'>"Drug-related"</span>, </span>
<span>      <span class='va'>AEREL</span> <span class='op'>==</span> <span class='st'>"N"</span> <span class='op'>~</span> <span class='st'>"Not drug-related"</span></span>
<span>      <span class='op'>)</span>,</span>
<span>    AEREL <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span></span>
<span>      <span class='va'>AEREL</span>, </span>
<span>      levels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Drug-related"</span>, <span class='st'>"Not drug-related"</span><span class='op'>)</span></span>
<span>      <span class='op'>)</span>,</span>
<span>    AESER <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span></span>
<span>      <span class='va'>AESER</span>, </span>
<span>      levels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Y"</span>, <span class='st'>"N"</span><span class='op'>)</span></span>
<span>      <span class='op'>)</span>,</span>
<span>    AESEV_2 <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/case_when.html'>case_when</a></span><span class='op'>(</span></span>
<span>      <span class='va'>AESEV</span> <span class='op'>==</span> <span class='st'>"SEVERE"</span> <span class='op'>~</span> <span class='st'>"Severe"</span>,</span>
<span>      <span class='va'>AESEV</span> <span class='op'><a href='https://rdrr.io/r/base/match.html'>%in%</a></span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"MILD"</span>, <span class='st'>"MODERATE"</span><span class='op'>)</span> <span class='op'>~</span> <span class='st'>"Mild-moderate"</span></span>
<span>      <span class='op'>)</span>,</span>
<span>      .keep <span class='op'>=</span> <span class='st'>"unused"</span>,</span>
<span>    AESEV_2 <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>AESEV_2</span>, </span>
<span>      levels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Severe"</span>, <span class='st'>"Mild-moderate"</span><span class='op'>)</span></span>
<span>      <span class='op'>)</span>,</span>
<span>    SEX <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span></span>
<span>      <span class='va'>SEX</span>, </span>
<span>      levels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"F"</span>, <span class='st'>"M"</span><span class='op'>)</span><span class='op'>)</span>,</span>
<span>    RACE <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/case_when.html'>case_when</a></span><span class='op'>(</span></span>
<span>      <span class='va'>RACE</span> <span class='op'>==</span> <span class='st'>"NATIVE HAWAIIAN OR OTHER PACIFIC ISLANDER"</span> <span class='op'>~</span> <span class='st'>"Pacific Ilander"</span>,</span>
<span>      <span class='va'>RACE</span> <span class='op'>==</span> <span class='st'>"AMERICAN INDIAN OR ALASKA NATIVE"</span> <span class='op'>~</span> <span class='st'>"American Indian"</span>,</span>
<span>      <span class='va'>RACE</span> <span class='op'>==</span> <span class='st'>"BLACK OR AFRICAN AMERICAN"</span> <span class='op'>~</span> <span class='st'>"Black"</span>,</span>
<span>      <span class='va'>RACE</span> <span class='op'>==</span> <span class='st'>"WHITE"</span> <span class='op'>~</span> <span class='st'>"White"</span>,</span>
<span>      <span class='va'>RACE</span> <span class='op'>==</span> <span class='st'>"ASIAN"</span> <span class='op'>~</span> <span class='st'>"Asian"</span></span>
<span>      <span class='op'>)</span>,</span>
<span>    RACE <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span></span>
<span>      <span class='va'>RACE</span>, </span>
<span>      levels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>                                                  <span class='co'># ordered by number of patients</span></span>
<span>        <span class='st'>"Pacific Ilander"</span>,</span>
<span>        <span class='st'>"American Indian"</span>,</span>
<span>        <span class='st'>"Black"</span>,</span>
<span>        <span class='st'>"White"</span>,</span>
<span>        <span class='st'>"Asian"</span><span class='op'>)</span></span>
<span>      <span class='op'>)</span></span>
<span>    <span class='op'>)</span></span></code></pre>
</div>
</div>
<p><a id="example3 code"></a></p>
<h3 id="example-3.-frequency-and-severity-of-drug-related-and-unrelated-adverse-events-in-different-primary-organ-systems-and-treatment-groups">Example 3. Frequency and severity of drug-related and unrelated adverse events, in different primary organ systems and treatment groups</h3>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># - Chunk 1</span></span>
<span><span class='co'># - Required: * R libraries (chunk libraries_and_data)</span></span>
<span><span class='co'># -           * dummyAEData_ed (chunk dataEd)</span></span>
<span></span>
<span><span class='co'>## Function for barplots of frequency of drug-related and unrelated adverse events, in different primary organ systems and treatment groups, stacked columns colored by a 4th variable (preferably binary, or visually comparing subgroups might become difficult)</span></span>
<span></span>
<span><span class='va'>drawFacet_allAEs</span> <span class='op'>&lt;-</span> </span>
<span>  <span class='kw'>function</span><span class='op'>(</span><span class='va'>data</span>, <span class='va'>AEtype</span><span class='op'>)</span> <span class='op'>{</span> </span>
<span>    <span class='va'>data</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>   </span>
<span>      <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span></span>
<span>        <span class='va'>SUBJID</span>, <span class='va'>Group</span>, <span class='va'>AEREL</span>, <span class='va'>AETOXGR</span>, <span class='va'>AESOC</span>, </span>
<span>        <span class='op'>{</span><span class='op'>{</span><span class='va'>AEtype</span><span class='op'>}</span><span class='op'>}</span>                                <span class='co'># {{}} ensures that the argument AEtype is treated as a column name</span></span>
<span>        <span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>    </span>
<span>        <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>Group</span>, <span class='va'>AEREL</span>, <span class='va'>AESOC</span>, <span class='op'>{</span><span class='op'>{</span><span class='va'>AEtype</span><span class='op'>}</span><span class='op'>}</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>  </span>
<span>        <span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise</a></span><span class='op'>(</span>N <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/context.html'>n</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>        <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>Group</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>        <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span> <span class='va'>.</span>, </span>
<span>          <span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise</a></span><span class='op'>(</span><span class='va'>.</span>, N_group <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>N</span><span class='op'>)</span> <span class='op'>)</span></span>
<span>          <span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>        <span class='fu'><a href='https://purrr.tidyverse.org/reference/reduce.html'>reduce</a></span><span class='op'>(</span></span>
<span>          <span class='va'>left_join</span>, </span>
<span>          by <span class='op'>=</span> <span class='st'>"Group"</span></span>
<span>          <span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>        <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span></span>
<span>          Freq <span class='op'>=</span> <span class='va'>N</span> <span class='op'>/</span> <span class='va'>N_group</span>, </span>
<span>          Group <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='va'>Group</span>, <span class='st'>" (N = "</span>, <span class='va'>N_group</span>, <span class='st'>")"</span><span class='op'>)</span></span>
<span>          <span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>  </span>
<span>        <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span></span>
<span>          <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span></span>
<span>            x <span class='op'>=</span> <span class='va'>AESOC</span>,</span>
<span>            y <span class='op'>=</span> <span class='va'>Freq</span>,</span>
<span>            fill <span class='op'>=</span> <span class='op'>{</span><span class='op'>{</span><span class='va'>AEtype</span><span class='op'>}</span><span class='op'>}</span></span>
<span>            <span class='op'>)</span>    </span>
<span>          <span class='op'>)</span> <span class='op'>+</span> </span>
<span>        <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_bar.html'>geom_col</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>        <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_text.html'>geom_text</a></span><span class='op'>(</span></span>
<span>          <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span></span>
<span>            label <span class='op'>=</span> <span class='va'>Freq</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>            <span class='op'>{</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste</a></span><span class='op'>(</span></span>
<span>              <span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='va'>.</span>, digits <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span> <span class='op'>*</span> <span class='fl'>100</span>, <span class='st'>"%"</span></span>
<span>              <span class='op'>)</span> <span class='op'>}</span></span>
<span>            <span class='op'>)</span>,</span>
<span>          size <span class='op'>=</span> <span class='fl'>3.5</span>,</span>
<span>          position <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/position_stack.html'>position_stack</a></span><span class='op'>(</span>vjust <span class='op'>=</span> <span class='fl'>0.5</span><span class='op'>)</span></span>
<span>          <span class='op'>)</span> <span class='op'>+</span></span>
<span>        <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/facet_grid.html'>facet_grid</a></span><span class='op'>(</span></span>
<span>          <span class='va'>AEREL</span> <span class='op'>~</span> <span class='va'>Group</span></span>
<span>          <span class='op'>)</span> <span class='op'>+</span></span>
<span>        <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_y_continuous</a></span><span class='op'>(</span></span>
<span>          labels <span class='op'>=</span> <span class='fu'>scales</span><span class='fu'>::</span><span class='fu'><a href='https://scales.r-lib.org/reference/percent_format.html'>percent_format</a></span><span class='op'>(</span></span>
<span>            accuracy <span class='op'>=</span> <span class='fl'>1</span></span>
<span>            <span class='op'>)</span></span>
<span>          <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_light</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span></span>
<span>    plot.margin <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/grid/unit.html'>unit</a></span><span class='op'>(</span></span>
<span>      <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.5</span>, <span class='fl'>0.5</span>, <span class='fl'>0.5</span> ,<span class='fl'>1.5</span><span class='op'>)</span>, <span class='st'>"cm"</span></span>
<span>      <span class='op'>)</span>,</span>
<span>    plot.title <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span></span>
<span>      size <span class='op'>=</span> <span class='fl'>13</span>,</span>
<span>      hjust <span class='op'>=</span> <span class='fl'>0.5</span>,</span>
<span>      vjust <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span>,</span>
<span>    plot.caption <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span></span>
<span>      size <span class='op'>=</span> <span class='fl'>9</span>,</span>
<span>      hjust <span class='op'>=</span> <span class='fl'>0</span>,</span>
<span>      vjust <span class='op'>=</span> <span class='fl'>5</span><span class='op'>)</span>,</span>
<span>    strip.background <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_rect</a></span><span class='op'>(</span></span>
<span>      fill <span class='op'>=</span> <span class='st'>"white"</span>, </span>
<span>      color <span class='op'>=</span> <span class='st'>"darkgrey"</span></span>
<span>      <span class='op'>)</span>, </span>
<span>    strip.text <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span></span>
<span>      colour<span class='op'>=</span><span class='st'>"black"</span>,</span>
<span>      size <span class='op'>=</span> <span class='fl'>10</span></span>
<span>      <span class='op'>)</span>,</span>
<span>    axis.title.y <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span></span>
<span>      size <span class='op'>=</span> <span class='fl'>12</span>,</span>
<span>      vjust <span class='op'>=</span> <span class='fl'>4</span></span>
<span>      <span class='op'>)</span>,</span>
<span>    axis.title.x <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span></span>
<span>      size <span class='op'>=</span> <span class='fl'>12</span>,</span>
<span>      vjust <span class='op'>=</span> <span class='op'>-</span><span class='fl'>2</span></span>
<span>      <span class='op'>)</span>,</span>
<span>    axis.text <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span></span>
<span>      size <span class='op'>=</span> <span class='fl'>11</span></span>
<span>      <span class='op'>)</span></span>
<span>    <span class='op'>)</span> </span>
<span>  <span class='op'>}</span></span>
<span></span>
<span><span class='co'>## Frequency and severity of drug-related and unrelated adverse events, in different primary organ systems and treatment groups</span></span>
<span></span>
<span><span class='va'>palette_1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"#f0b27a"</span>, <span class='st'>"#aed6f1"</span><span class='op'>)</span></span>
<span></span>
<span><span class='fu'>drawFacet_allAEs</span><span class='op'>(</span><span class='va'>dummyAEData_ed</span>, <span class='va'>AESEV_2</span><span class='op'>)</span> <span class='op'>+</span> </span>
<span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_manual.html'>scale_fill_manual</a></span><span class='op'>(</span>values <span class='op'>=</span> <span class='va'>palette_1</span><span class='op'>)</span>  <span class='op'>+</span></span>
<span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span></span>
<span>  title <span class='op'>=</span> <span class='st'>"Frequency and severity of drug-related and unrelated adverse events in different primary organ systems and treatment groups"</span>,</span>
<span>  caption <span class='op'>=</span> </span>
<span>    <span class='st'>"Non-drug related adverse events were never severe\n</span></span>
<span><span class='st'>    Organ system D:\n</span></span>
<span><span class='st'>    - more often drug-related than non-related adverse events, all severe events were drug-related\n</span></span>
<span><span class='st'>  Organ system C: - drug-related events only\n</span></span>
<span><span class='st'>  Ogan systems A and B: - only(A) or predominantly (B) non-drug related events, but all drug-related events in B were severe"</span>,</span>
<span>  x <span class='op'>=</span> <span class='st'>"Primary organ system class"</span>,</span>
<span>  y <span class='op'>=</span> <span class='st'>"Proportion of events in treatment group"</span>,</span>
<span>  fill <span class='op'>=</span> <span class='st'>"Adverse event \nseverity"</span>    </span>
<span>  <span class='op'>)</span> </span></code></pre>
</div>
</div>
<p><a href="#example3">Back to blog</a></p>
<p><a id="example4 code"></a></p>
<h3 id="examples-4-frequency-and-seriousness-of-drug-related-and-unrelated-adverse-events-in-different-primary-organ-systems-and-treatment-groups">Examples 4: Frequency and seriousness of drug-related and unrelated adverse events, in different primary organ systems and treatment groups</h3>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># - Chunk 2</span></span>
<span><span class='co'># - Required: * R libraries (chunk libraries_and_data)</span></span>
<span><span class='co'># -           * dummyAEData_ed (chunk dataEd)</span></span>
<span><span class='co'># -           * drawFacet_allAEs (chunk_1)</span></span>
<span></span>
<span><span class='co'>## Frequency and seriousness of drug-related and unrelated adverse events, in different primary organ systems and treatment groups</span></span>
<span></span>
<span><span class='co'>## Frequency and seriousness of drug-related and unrelated adverse events, in different primary organ systems and treatment groups</span></span>
<span></span>
<span><span class='va'>palette_2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"#e6b0aa"</span>, <span class='st'>"#aab7b8"</span><span class='op'>)</span></span>
<span></span>
<span><span class='fu'>drawFacet_allAEs</span><span class='op'>(</span><span class='va'>dummyAEData_ed</span>, <span class='va'>AESER</span><span class='op'>)</span> <span class='op'>+</span> </span>
<span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_manual.html'>scale_fill_manual</a></span><span class='op'>(</span>values <span class='op'>=</span> <span class='va'>palette_2</span><span class='op'>)</span>  <span class='op'>+</span></span>
<span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span></span>
<span>  title <span class='op'>=</span> <span class='st'>"Frequency and seriousness of drug-related and unrelated adverse events in different primary organ systems and treatment groups"</span>,</span>
<span>  caption <span class='op'>=</span> </span>
<span>    <span class='st'>"Organ system D:\n</span></span>
<span><span class='st'>    - drug-related events were more frequent among patients receiving placebo, or switched between drug and placebo compared to patients treated with drug only\n</span></span>
<span><span class='st'>    - more often drug-related than non-related, all serious adverse events were drug-related\n</span></span>
<span><span class='st'>  Organ system C: - non-serious events drug-related events only\n</span></span>
<span><span class='st'>  Ogan systems A and B: - only(A) or predominantly (B) non-drug related events, but all drug-related events in B were serious"</span>,</span>
<span>  y <span class='op'>=</span> <span class='st'>"Proportion of events in treatment group"</span>,</span>
<span>  x <span class='op'>=</span> <span class='st'>"Primary organ system class"</span>,</span>
<span>  fill <span class='op'>=</span> <span class='st'>"Serious \nadverse event"</span> </span>
<span>  <span class='op'>)</span></span></code></pre>
</div>
</div>
<p><a href="#example4">Back to blog</a></p>
<p><a id="example5 code"></a></p>
<h3 id="examples-5-frequency-of-drug-related-and-unrelated-adverse-events-stratified-by-primary-organ-system-treatment-groups-and-patient-sex">Examples 5: Frequency of drug-related and unrelated adverse events, stratified by primary organ system, treatment groups, and patient sex</h3>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># - Chunk 3</span></span>
<span><span class='co'># - Required: * R libraries (chunk libraries_and_data)</span></span>
<span><span class='co'># -           * dummyAEData_ed (chunk dataEd)</span></span>
<span><span class='co'># -           * drawFacet_allAEs (chunk_1)</span></span>
<span></span>
<span><span class='co'>## Frequency and seriousness of drug-related and unrelated adverse events, in different primary organ systems and treatment groups</span></span>
<span></span>
<span><span class='co'>## Frequency and seriousness of drug-related and unrelated adverse events, in different primary organ systems and treatment groups</span></span>
<span></span>
<span><span class='va'>palette_3</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"#C52A2A"</span>, <span class='st'>"#4682B4"</span><span class='op'>)</span></span>
<span></span>
<span><span class='fu'>drawFacet_allAEs</span><span class='op'>(</span><span class='va'>dummyAEData_ed</span>, <span class='va'>SEX</span><span class='op'>)</span> <span class='op'>+</span> </span>
<span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_manual.html'>scale_fill_manual</a></span><span class='op'>(</span></span>
<span>  values <span class='op'>=</span> <span class='va'>palette_3</span><span class='op'>)</span>  <span class='op'>+</span></span>
<span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span></span>
<span>  title <span class='op'>=</span> <span class='st'>"Frequency of drug-related and unrelated adverse events, stratified by primary organ system, treatment groups, and patient sex"</span>,</span>
<span>  y <span class='op'>=</span> <span class='st'>"Proportion of events in treatment group"</span>,</span>
<span>  x <span class='op'>=</span> <span class='st'>"Primary organ system class"</span>,</span>
<span>  fill <span class='op'>=</span> <span class='st'>"SEX"</span> </span>
<span>  <span class='op'>)</span> </span></code></pre>
</div>
</div>
<p><a href="#example5">Back to blog</a></p>
<p><a id="example6 code"></a></p>
<h3 id="examples-6-toxicity-grade-affected-primary-organ-system-of-the-most-severe-adverse-event-stratified-by-treatment-adverse-event-relation-to-drug-and-patient-sex">Examples 6: Toxicity grade, affected primary organ system of the most severe adverse event, stratified by treatment, adverse event relation to drug, and patient sex</h3>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># - Chunk 4</span></span>
<span><span class='co'># - Required: * R libraries (chunk libraries_and_data)</span></span>
<span><span class='co'># -           * dummyAEData_ed (chunk dataEd)</span></span>
<span><span class='co'># -           * palette_3 (chunk 3)</span></span>
<span></span>
<span><span class='co'>## Toxicity grade and affected primary organ system of the most severe adverse event in each patient, stratified by treatment, adverse event relation to drug,</span></span>
<span><span class='co'>## and patient sex</span></span>
<span></span>
<span><span class='va'>theme_facets_1</span> <span class='op'>&lt;-</span> </span>
<span>  <span class='kw'>function</span><span class='op'>(</span><span class='va'>base_size</span> <span class='op'>=</span> <span class='fl'>12</span>, <span class='va'>base_family</span> <span class='op'>=</span> <span class='st'>""</span><span class='op'>)</span><span class='op'>{</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_light</a></span><span class='op'>(</span>base_size <span class='op'>=</span> <span class='va'>base_size</span> <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span></span>
<span>    strip.background <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_rect</a></span><span class='op'>(</span></span>
<span>      fill <span class='op'>=</span> <span class='st'>"white"</span>, </span>
<span>      color <span class='op'>=</span> <span class='st'>"darkgrey"</span></span>
<span>      <span class='op'>)</span>, </span>
<span>    strip.text <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span></span>
<span>      colour<span class='op'>=</span><span class='st'>"black"</span>,</span>
<span>      size <span class='op'>=</span> <span class='fl'>10</span></span>
<span>      <span class='op'>)</span>,</span>
<span>    axis.title.y <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span></span>
<span>      <span class='co'>#size = 12,</span></span>
<span>      vjust <span class='op'>=</span> <span class='fl'>4</span></span>
<span>      <span class='op'>)</span>,</span>
<span>    axis.title.x <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span></span>
<span>      <span class='co'>#size = 12,</span></span>
<span>      vjust <span class='op'>=</span> <span class='op'>-</span><span class='fl'>2</span></span>
<span>      <span class='op'>)</span>,</span>
<span>    axis.title <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span></span>
<span>      <span class='co'>#size = 12,</span></span>
<span>      vjust <span class='op'>=</span> <span class='op'>-</span><span class='fl'>2</span></span>
<span>      <span class='op'>)</span>,</span>
<span>    axis.text <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span></span>
<span>      size <span class='op'>=</span> <span class='fl'>11</span></span>
<span>      <span class='op'>)</span>,</span>
<span>    plot.title <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span></span>
<span>      size <span class='op'>=</span> <span class='fl'>14</span>,</span>
<span>      hjust <span class='op'>=</span> <span class='fl'>0.5</span>,</span>
<span>      vjust <span class='op'>=</span> <span class='fl'>5</span><span class='op'>)</span>,</span>
<span>    panel.grid.major.y <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span></span>
<span>    <span class='op'>)</span></span>
<span>  <span class='op'>}</span>    </span>
<span></span>
<span><span class='va'>p1A</span> <span class='op'>&lt;-</span> </span>
<span>  <span class='va'>dummyAEData_ed</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>                                        </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>SUBJID</span>, <span class='va'>Group</span>, <span class='va'>AEREL</span>, <span class='va'>AETOXGR</span>, <span class='va'>AESEV</span>, <span class='va'>AESOC</span>, <span class='va'>SEX</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>SUBJID</span>, <span class='va'>AEREL</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>                             <span class='co'># select AEs with the highest toxicity grade in both the treatment-related and unrelated category for each patient</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/slice.html'>slice</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/which.min.html'>which.max</a></span><span class='op'>(</span><span class='va'>AETOXGR</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>                            </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>SUBJID</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>                                    <span class='co'># select AEs with the highest toxicity grade for each patient</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/slice.html'>slice</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/which.min.html'>which.max</a></span><span class='op'>(</span><span class='va'>AETOXGR</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>AETOXGR</span>, <span class='va'>AESEV</span>, <span class='va'>AESOC</span>, <span class='va'>SEX</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise</a></span><span class='op'>(</span>N <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/context.html'>n</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>AESOC</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>  <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span> <span class='va'>.</span>, </span>
<span>    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise</a></span><span class='op'>(</span><span class='va'>.</span>, </span>
<span>      N_group <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>N</span><span class='op'>)</span></span>
<span>      <span class='op'>)</span></span>
<span>    <span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>  <span class='fu'><a href='https://purrr.tidyverse.org/reference/reduce.html'>reduce</a></span><span class='op'>(</span></span>
<span>    <span class='va'>left_join</span>, </span>
<span>    by <span class='op'>=</span> <span class='st'>"AESOC"</span></span>
<span>    <span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span></span>
<span>    Freq <span class='op'>=</span> <span class='va'>N</span> <span class='op'>/</span> <span class='va'>N_group</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>   <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span></span>
<span>    AESOC <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='va'>AESOC</span>, <span class='st'>" (N = "</span>, <span class='va'>N_group</span>, <span class='st'>")"</span> <span class='op'>)</span>,</span>
<span>    AESOC <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>AESOC</span><span class='op'>)</span>,</span>
<span>    AETOXGR <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>AETOXGR</span>, levels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>5</span><span class='op'>)</span><span class='op'>)</span>,</span>
<span>    AESEV <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span></span>
<span>      <span class='va'>AESEV</span>, </span>
<span>      levels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/rev.html'>rev</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/levels.html'>levels</a></span><span class='op'>(</span><span class='va'>AESEV</span><span class='op'>)</span> <span class='op'>)</span></span>
<span>      <span class='op'>)</span></span>
<span>    <span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span> </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span></span>
<span>      x <span class='op'>=</span> <span class='va'>AETOXGR</span>,</span>
<span>      y <span class='op'>=</span> <span class='va'>Freq</span>,</span>
<span>      fill <span class='op'>=</span> <span class='va'>SEX</span></span>
<span>      <span class='op'>)</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_bar.html'>geom_col</a></span><span class='op'>(</span>alpha <span class='op'>=</span> <span class='fl'>0.8</span> <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://teunbrand.github.io/ggh4x/reference/facet_grid2.html'>facet_grid2</a></span><span class='op'>(</span></span>
<span>    <span class='va'>AESEV</span> <span class='op'>~</span> <span class='va'>AESOC</span>,</span>
<span>    scales <span class='op'>=</span> <span class='st'>"free_y"</span>,                                                  <span class='co'># makes facet height proportional to range of AETOXGR, and</span></span>
<span>    space <span class='op'>=</span> <span class='st'>"free"</span>                                                      <span class='co'># generates custom limits for the AETOXGR scale for each AESEV category</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_manual.html'>scale_fill_manual</a></span><span class='op'>(</span>values <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"#C52A2A"</span>, <span class='st'>"#4682B4"</span><span class='op'>)</span> <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_discrete.html'>scale_x_discrete</a></span><span class='op'>(</span>breaks <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/levels.html'>levels</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>dummyAEData_ed</span><span class='op'>$</span><span class='va'>AETOXGR</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>)</span> <span class='op'>+</span>   <span class='co'># generates the appropriate custom breaks for each facet</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_y_continuous</a></span><span class='op'>(</span></span>
<span>    labels <span class='op'>=</span> <span class='fu'>scales</span><span class='fu'>::</span><span class='fu'><a href='https://scales.r-lib.org/reference/percent_format.html'>percent_format</a></span><span class='op'>(</span></span>
<span>      accuracy <span class='op'>=</span> <span class='fl'>1</span></span>
<span>      <span class='op'>)</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span></span>
<span>    title <span class='op'>=</span> <span class='st'>"Primary organ system: summary across treatment groups"</span>,</span>
<span>    x <span class='op'>=</span> <span class='st'>"Toxicity grade"</span>,</span>
<span>    y <span class='op'>=</span> <span class='st'>"Frequency in primary organ system"</span>,</span>
<span>    fill <span class='op'>=</span> <span class='st'>"Sex"</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>theme_facets_1</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span></span>
<span>    plot.margin <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/grid/unit.html'>unit</a></span><span class='op'>(</span></span>
<span>      <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.5</span>, <span class='fl'>0.5</span>, <span class='fl'>0.5</span> ,<span class='fl'>0.5</span><span class='op'>)</span>, <span class='st'>"cm"</span></span>
<span>      <span class='op'>)</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/coord_flip.html'>coord_flip</a></span><span class='op'>(</span><span class='op'>)</span> </span>
<span></span>
<span><span class='va'>p1B</span> <span class='op'>&lt;-</span> </span>
<span>  <span class='va'>dummyAEData_ed</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>                                        </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>SUBJID</span>, <span class='va'>Group</span>, <span class='va'>AEREL</span>, <span class='va'>AETOXGR</span>, <span class='va'>AESOC</span>, <span class='va'>SEX</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>SUBJID</span>, <span class='va'>AEREL</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>                             <span class='co'># select AEs with the highest toxicity grade in both the treatment-related and unrelated category for each patient</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/slice.html'>slice</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/which.min.html'>which.max</a></span><span class='op'>(</span><span class='va'>AETOXGR</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>                            </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>SUBJID</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>                                    <span class='co'># select AEs with the highest toxicity grade for each patient</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/slice.html'>slice</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/which.min.html'>which.max</a></span><span class='op'>(</span><span class='va'>AETOXGR</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>Group</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>                                      <span class='co'># add group totals</span></span>
<span>  <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span> <span class='va'>.</span>, <span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise</a></span><span class='op'>(</span><span class='va'>.</span>, N_group <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/context.html'>n</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>  <span class='fu'><a href='https://purrr.tidyverse.org/reference/reduce.html'>reduce</a></span><span class='op'>(</span><span class='va'>left_join</span>, by <span class='op'>=</span> <span class='st'>"Group"</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span></span>
<span>    Group <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='va'>Group</span>, <span class='st'>" (N = "</span>, <span class='va'>N_group</span>, <span class='st'>")"</span> <span class='op'>)</span></span>
<span>    <span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span></span>
<span>      <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span></span>
<span>        x <span class='op'>=</span> <span class='va'>AESOC</span>,</span>
<span>        y <span class='op'>=</span> <span class='va'>AETOXGR</span> <span class='op'>+</span> <span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span><span class='op'>(</span><span class='va'>SEX</span><span class='op'>)</span> <span class='op'>-</span> <span class='fl'>1.5</span><span class='op'>)</span><span class='op'>/</span><span class='fl'>4</span>,</span>
<span>        color <span class='op'>=</span> <span class='va'>SEX</span></span>
<span>        <span class='op'>)</span>     </span>
<span>      <span class='op'>)</span> <span class='op'>+</span></span>
<span>    <span class='fu'><a href='https://rdrr.io/pkg/ggbeeswarm/man/geom_beeswarm.html'>geom_beeswarm</a></span><span class='op'>(</span></span>
<span>      <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>shape <span class='op'>=</span> <span class='va'>SEX</span><span class='op'>)</span>,</span>
<span>      cex <span class='op'>=</span> <span class='fl'>3</span>,</span>
<span>      size <span class='op'>=</span> <span class='fl'>9</span></span>
<span>      <span class='op'>)</span> <span class='op'>+</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_manual.html'>scale_shape_manual</a></span><span class='op'>(</span></span>
<span>      values <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"\u2640"</span>, <span class='st'>"\u2642"</span><span class='op'>)</span>             <span class='co'># unicode for female and male, https://www.compart.com/en/unicode/, accessed 02/02/25</span></span>
<span>      <span class='op'>)</span> <span class='op'>+</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_abline.html'>geom_hline</a></span><span class='op'>(</span></span>
<span>        yintercept <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>3.5</span>, <span class='fl'>1.5</span><span class='op'>)</span>,</span>
<span>        color <span class='op'>=</span>  <span class='st'>"darkgrey"</span>,</span>
<span>        lwd <span class='op'>=</span> <span class='fl'>0.7</span> </span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_abline.html'>geom_vline</a></span><span class='op'>(</span></span>
<span>        xintercept <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1.5</span><span class='op'>:</span><span class='fl'>3.5</span><span class='op'>)</span>,</span>
<span>        color <span class='op'>=</span> <span class='st'>"darkgrey"</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/facet_grid.html'>facet_grid</a></span><span class='op'>(</span></span>
<span>      <span class='va'>AEREL</span> <span class='op'>~</span> <span class='va'>Group</span></span>
<span>      <span class='op'>)</span> <span class='op'>+</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_manual.html'>scale_color_manual</a></span><span class='op'>(</span>values <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"#C52A2A"</span>, <span class='st'>"#4682B4"</span><span class='op'>)</span> <span class='op'>)</span> <span class='op'>+</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_y_continuous</a></span><span class='op'>(</span> expand <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.07</span>, <span class='fl'>0.07</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>                              <span class='co'># adding limits improves alignment of the AESEV categories with p2C</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span></span>
<span>      title <span class='op'>=</span> <span class='st'>"Individual patients and treatment groups"</span>,</span>
<span>      x <span class='op'>=</span> <span class='st'>"Affected primary organ system"</span>,</span>
<span>      y <span class='op'>=</span> <span class='st'>"Toxicitiy grade"</span></span>
<span>      <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>theme_facets_1</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span></span>
<span>    panel.grid.major.x <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>    legend.position <span class='op'>=</span> <span class='st'>"none"</span></span>
<span>    <span class='op'>)</span> </span>
<span></span>
<span><span class='co'># Plot frequency of different toxicity grades of the most severe adverse event among drug-related and unrelated event categories</span></span>
<span></span>
<span><span class='va'>annotations_p2C</span> <span class='op'>&lt;-</span>                                        <span class='co'># figure annotations for severity category</span></span>
<span>  <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span></span>
<span>  x <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>4.5</span>, <span class='fl'>2.5</span>, <span class='fl'>1</span><span class='op'>)</span>,</span>
<span>  y <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.79</span>, <span class='fl'>0.79</span>, <span class='fl'>0.79</span><span class='op'>)</span>,</span>
<span>  label <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Severe"</span>, <span class='st'>"Moderate"</span>, <span class='st'>"Mild"</span><span class='op'>)</span></span>
<span>  <span class='op'>)</span></span>
<span></span>
<span><span class='va'>p1C</span> <span class='op'>&lt;-</span> </span>
<span>  <span class='va'>dummyAEData_ed</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>                                        </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>SUBJID</span>, <span class='va'>Group</span>, <span class='va'>AEREL</span>, <span class='va'>AETOXGR</span>, <span class='va'>AESOC</span>, <span class='va'>SEX</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>SUBJID</span>, <span class='va'>AEREL</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>                             <span class='co'># select AEs with the highest toxicity grade in both the treatment-related and unrelated category for each patient</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/slice.html'>slice</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/which.min.html'>which.max</a></span><span class='op'>(</span><span class='va'>AETOXGR</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>                            </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>SUBJID</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>                                    <span class='co'># select AEs with the highest toxicity grade for each patient</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/slice.html'>slice</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/which.min.html'>which.max</a></span><span class='op'>(</span><span class='va'>AETOXGR</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>AETOXGR</span>, <span class='va'>AEREL</span>, <span class='va'>SEX</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise</a></span><span class='op'>(</span>N <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/context.html'>n</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>AEREL</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>  <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span> <span class='va'>.</span>, </span>
<span>    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise</a></span><span class='op'>(</span><span class='va'>.</span>, </span>
<span>      N_group <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>N</span><span class='op'>)</span></span>
<span>      <span class='op'>)</span></span>
<span>    <span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>  <span class='fu'><a href='https://purrr.tidyverse.org/reference/reduce.html'>reduce</a></span><span class='op'>(</span></span>
<span>    <span class='va'>left_join</span>, </span>
<span>    by <span class='op'>=</span> <span class='st'>"AEREL"</span></span>
<span>    <span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span></span>
<span>    Freq <span class='op'>=</span> <span class='va'>N</span> <span class='op'>/</span> <span class='va'>N_group</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>   <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span></span>
<span>    AEREL <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='va'>AEREL</span>, <span class='st'>" (N = "</span>, <span class='va'>N_group</span>, <span class='st'>")"</span> <span class='op'>)</span></span>
<span>    <span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span> </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span></span>
<span>      x <span class='op'>=</span> <span class='va'>AETOXGR</span>,</span>
<span>      y <span class='op'>=</span> <span class='va'>Freq</span>,</span>
<span>      fill <span class='op'>=</span> <span class='va'>SEX</span></span>
<span>      <span class='op'>)</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_bar.html'>geom_col</a></span><span class='op'>(</span></span>
<span>    alpha <span class='op'>=</span> <span class='fl'>0.8</span>,</span>
<span>    width <span class='op'>=</span> <span class='fl'>0.5</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_abline.html'>geom_vline</a></span><span class='op'>(</span></span>
<span>    xintercept <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>3.5</span>, <span class='fl'>1.5</span><span class='op'>)</span>,</span>
<span>    color <span class='op'>=</span>  <span class='st'>"darkgrey"</span>,</span>
<span>    lwd <span class='op'>=</span> <span class='fl'>0.7</span> </span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/facet_wrap.html'>facet_wrap</a></span><span class='op'>(</span></span>
<span>    <span class='op'>~</span> <span class='va'>AEREL</span>, </span>
<span>    strip.position<span class='op'>=</span><span class='st'>"right"</span>,</span>
<span>    nrow <span class='op'>=</span> <span class='fl'>2</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_text.html'>geom_text</a></span><span class='op'>(</span></span>
<span>    data <span class='op'>=</span> <span class='va'>annotations_p2C</span>, </span>
<span>    inherit.aes <span class='op'>=</span> <span class='cn'>FALSE</span>, </span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span></span>
<span>      x <span class='op'>=</span> <span class='va'>x</span>, </span>
<span>      y <span class='op'>=</span> <span class='va'>y</span>, </span>
<span>      label <span class='op'>=</span> <span class='va'>label</span></span>
<span>      <span class='op'>)</span>, </span>
<span>    size <span class='op'>=</span> <span class='fl'>3.5</span>, </span>
<span>    angle <span class='op'>=</span> <span class='fl'>270</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_manual.html'>scale_fill_manual</a></span><span class='op'>(</span>values <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"#C52A2A"</span>, <span class='st'>"#4682B4"</span><span class='op'>)</span> <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_discrete.html'>scale_x_discrete</a></span><span class='op'>(</span>limits <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>5</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_y_continuous</a></span><span class='op'>(</span></span>
<span>    labels <span class='op'>=</span> <span class='fu'>scales</span><span class='fu'>::</span><span class='fu'><a href='https://scales.r-lib.org/reference/percent_format.html'>percent_format</a></span><span class='op'>(</span></span>
<span>      accuracy <span class='op'>=</span> <span class='fl'>1</span></span>
<span>      <span class='op'>)</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span></span>
<span>    title <span class='op'>=</span> <span class='st'>"Toxicity grade: \nsummary across treatment groups"</span>,</span>
<span>    y <span class='op'>=</span> <span class='st'>'Frequency among "drug-related" \ncategory events'</span>,</span>
<span>    fill <span class='op'>=</span> <span class='st'>"Sex"</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>theme_facets_1</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span></span>
<span>    plot.margin <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/grid/unit.html'>unit</a></span><span class='op'>(</span></span>
<span>      <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.5</span>, <span class='fl'>0.5</span>, <span class='fl'>0.5</span> ,<span class='fl'>0.5</span><span class='op'>)</span>, <span class='st'>"cm"</span></span>
<span>      <span class='op'>)</span>,</span>
<span>    axis.title.y <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>    axis.text.y <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>    axis.ticks.y <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>    panel.grid.major.x <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>    legend.position <span class='op'>=</span> <span class='st'>"none"</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/coord_flip.html'>coord_flip</a></span><span class='op'>(</span><span class='op'>)</span> </span>
<span></span>
<span></span>
<span><span class='va'>p1As</span> <span class='op'>&lt;-</span> </span>
<span>  <span class='va'>p1A</span> <span class='op'>+</span> <span class='fu'><a href='https://patchwork.data-imaginist.com/reference/plot_spacer.html'>plot_spacer</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>       <span class='co'># spacers added to reduce gap between plots B and C, and align A: values adjusted for a 1400 x 1400 png image file output</span></span>
<span>  <span class='fu'><a href='https://patchwork.data-imaginist.com/reference/plot_layout.html'>plot_layout</a></span><span class='op'>(</span></span>
<span>    widths <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>8</span>, <span class='fl'>1.1</span><span class='op'>)</span></span>
<span>    <span class='op'>)</span> </span>
<span></span>
<span><span class='va'>p1BC</span> <span class='op'>&lt;-</span> </span>
<span>  <span class='va'>p1B</span> <span class='op'>+</span> <span class='fu'><a href='https://patchwork.data-imaginist.com/reference/plot_spacer.html'>plot_spacer</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span> <span class='va'>p1C</span> <span class='op'>+</span>                 </span>
<span>  <span class='fu'><a href='https://patchwork.data-imaginist.com/reference/plot_layout.html'>plot_layout</a></span><span class='op'>(</span></span>
<span>    widths <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>8</span>, <span class='op'>-</span><span class='fl'>0.3</span> ,<span class='fl'>2</span><span class='op'>)</span></span>
<span>    <span class='op'>)</span> </span>
<span></span>
<span><span class='va'>p1As</span> <span class='op'>/</span> <span class='va'>p1BC</span> <span class='op'>+</span> </span>
<span>  <span class='fu'><a href='https://patchwork.data-imaginist.com/reference/plot_layout.html'>plot_layout</a></span><span class='op'>(</span></span>
<span>    design <span class='op'>=</span> <span class='st'>"AAAAA</span></span>
<span><span class='st'>              BBBBB</span></span>
<span><span class='st'>              BBBBB</span></span>
<span><span class='st'>              BBBBB</span></span>
<span><span class='st'>              BBBBB"</span>      </span>
<span>    <span class='op'>)</span> <span class='op'>+</span>    </span>
<span>    <span class='fu'><a href='https://patchwork.data-imaginist.com/reference/plot_annotation.html'>plot_annotation</a></span><span class='op'>(</span></span>
<span>        title <span class='op'>=</span> <span class='st'>"Highest toxicity grade events in male and female subjects, by treatment, organ system, and drug-relatedness of the event"</span>,</span>
<span>        theme <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span></span>
<span>            plot.title <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span></span>
<span>                face <span class='op'>=</span> <span class='st'>"bold"</span>,</span>
<span>                size <span class='op'>=</span> <span class='fl'>14</span>, </span>
<span>                hjust <span class='op'>=</span> <span class='fl'>0.5</span></span>
<span>            <span class='op'>)</span>,</span>
<span>            plot.caption <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span></span>
<span>                size <span class='op'>=</span> <span class='fl'>9</span>,</span>
<span>                hjust <span class='op'>=</span> <span class='fl'>0.5</span></span>
<span>            <span class='op'>)</span></span>
<span>        <span class='op'>)</span></span>
<span>    <span class='op'>)</span></span></code></pre>
</div>
</div>
<p><a href="#example6">Back to blog</a></p>
<p><a id="example7 code"></a></p>
<h3 id="examples-7-toxicity-grade-affected-primary-organ-system-of-the-most-severe-adverse-event-stratified-by-treatment-adverse-event-relation-to-drug-and-patient-race">Examples 7: Toxicity grade, affected primary organ system of the most severe adverse event, stratified by treatment, adverse event relation to drug, and patient race</h3>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># - Chunk 5</span></span>
<span><span class='co'># - Required: * R libraries (chunk libraries_and_data)</span></span>
<span><span class='co'># -           * dummyAEData_ed (chunk dataEd)</span></span>
<span><span class='co'># -           * theme_facets_1 (chunk 4)</span></span>
<span></span>
<span><span class='co'>## Toxicity grade and affected primary organ system of the most severe adverse event in each patient, stratified by treatment, adverse event relation to drug,</span></span>
<span><span class='co'>## and patient race</span></span>
<span></span>
<span><span class='va'>p2A</span> <span class='op'>&lt;-</span> </span>
<span>  <span class='va'>dummyAEData_ed</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>                                        </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>SUBJID</span>, <span class='va'>Group</span>, <span class='va'>AEREL</span>, <span class='va'>AETOXGR</span>, <span class='va'>AESEV</span>, <span class='va'>AESOC</span>, <span class='va'>RACE</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>SUBJID</span>, <span class='va'>AEREL</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>                             <span class='co'># select AEs with the highest toxicity grade in both the treatment-related and unrelated category for each patient</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/slice.html'>slice</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/which.min.html'>which.max</a></span><span class='op'>(</span><span class='va'>AETOXGR</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>                            </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>SUBJID</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>                                    <span class='co'># select AEs with the highest toxicity grade for each patient</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/slice.html'>slice</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/which.min.html'>which.max</a></span><span class='op'>(</span><span class='va'>AETOXGR</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>AETOXGR</span>, <span class='va'>AESEV</span>, <span class='va'>AESOC</span>, <span class='va'>RACE</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise</a></span><span class='op'>(</span>N <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/context.html'>n</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>AESOC</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>  <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span> <span class='va'>.</span>, </span>
<span>    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise</a></span><span class='op'>(</span><span class='va'>.</span>, </span>
<span>      N_group <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>N</span><span class='op'>)</span></span>
<span>      <span class='op'>)</span></span>
<span>    <span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>  <span class='fu'><a href='https://purrr.tidyverse.org/reference/reduce.html'>reduce</a></span><span class='op'>(</span></span>
<span>    <span class='va'>left_join</span>, </span>
<span>    by <span class='op'>=</span> <span class='st'>"AESOC"</span></span>
<span>    <span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span></span>
<span>    Freq <span class='op'>=</span> <span class='va'>N</span> <span class='op'>/</span> <span class='va'>N_group</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>   <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span></span>
<span>    AESOC <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='va'>AESOC</span>, <span class='st'>" (N = "</span>, <span class='va'>N_group</span>, <span class='st'>")"</span> <span class='op'>)</span>,</span>
<span>    AESOC <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>AESOC</span><span class='op'>)</span>,</span>
<span>    AETOXGR <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>AETOXGR</span>, levels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>5</span><span class='op'>)</span><span class='op'>)</span>,</span>
<span>    AESEV <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span></span>
<span>      <span class='va'>AESEV</span>, </span>
<span>      levels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/rev.html'>rev</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/levels.html'>levels</a></span><span class='op'>(</span><span class='va'>AESEV</span><span class='op'>)</span> <span class='op'>)</span></span>
<span>      <span class='op'>)</span></span>
<span>    <span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span> </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span></span>
<span>      x <span class='op'>=</span> <span class='va'>AETOXGR</span>,</span>
<span>      y <span class='op'>=</span> <span class='va'>Freq</span>,</span>
<span>      fill <span class='op'>=</span> <span class='va'>RACE</span></span>
<span>      <span class='op'>)</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_bar.html'>geom_col</a></span><span class='op'>(</span>alpha <span class='op'>=</span> <span class='fl'>0.8</span> <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://teunbrand.github.io/ggh4x/reference/facet_grid2.html'>facet_grid2</a></span><span class='op'>(</span></span>
<span>    <span class='va'>AESEV</span> <span class='op'>~</span> <span class='va'>AESOC</span>,</span>
<span>    scales <span class='op'>=</span> <span class='st'>"free_y"</span>,                                                  <span class='co'># makes facet height proportional to range of AETOXGR, and</span></span>
<span>    space <span class='op'>=</span> <span class='st'>"free"</span>                                                      <span class='co'># generates custom limits for the AETOXGR scale for each AESEV category</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_discrete.html'>scale_x_discrete</a></span><span class='op'>(</span>breaks <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/levels.html'>levels</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>dummyAEData_ed</span><span class='op'>$</span><span class='va'>AETOXGR</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>)</span> <span class='op'>+</span>   <span class='co'># generates the appropriate custom breaks for each facet</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_y_continuous</a></span><span class='op'>(</span></span>
<span>    labels <span class='op'>=</span> <span class='fu'>scales</span><span class='fu'>::</span><span class='fu'><a href='https://scales.r-lib.org/reference/percent_format.html'>percent_format</a></span><span class='op'>(</span></span>
<span>      accuracy <span class='op'>=</span> <span class='fl'>1</span></span>
<span>      <span class='op'>)</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span></span>
<span>    title <span class='op'>=</span> <span class='st'>"Primary organ system: summary across treatment groups"</span>,</span>
<span>    x <span class='op'>=</span> <span class='st'>"Toxicity grade"</span>,</span>
<span>    y <span class='op'>=</span> <span class='st'>"Frequency in primary organ system"</span>,</span>
<span>    fill <span class='op'>=</span> <span class='st'>"Race"</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>theme_facets_1</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span></span>
<span>    plot.margin <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/grid/unit.html'>unit</a></span><span class='op'>(</span></span>
<span>      <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.5</span>, <span class='fl'>0.5</span>, <span class='fl'>0.5</span> ,<span class='fl'>0.5</span><span class='op'>)</span>, <span class='st'>"cm"</span></span>
<span>      <span class='op'>)</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/coord_flip.html'>coord_flip</a></span><span class='op'>(</span><span class='op'>)</span> </span>
<span></span>
<span><span class='va'>p2B</span> <span class='op'>&lt;-</span> </span>
<span>  <span class='va'>dummyAEData_ed</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>                                        </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>SUBJID</span>, <span class='va'>Group</span>, <span class='va'>AEREL</span>, <span class='va'>AETOXGR</span>, <span class='va'>AESOC</span>, <span class='va'>RACE</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>SUBJID</span>, <span class='va'>AEREL</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>                             <span class='co'># select AEs with the highest toxicity grade in both the treatment-related and unrelated category for each patient</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/slice.html'>slice</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/which.min.html'>which.max</a></span><span class='op'>(</span><span class='va'>AETOXGR</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>                            </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>SUBJID</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>                                    <span class='co'># select AEs with the highest toxicity grade for each patient</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/slice.html'>slice</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/which.min.html'>which.max</a></span><span class='op'>(</span><span class='va'>AETOXGR</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>Group</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>                                      <span class='co'># add group totals</span></span>
<span>  <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span> <span class='va'>.</span>, <span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise</a></span><span class='op'>(</span><span class='va'>.</span>, N_group <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/context.html'>n</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>  <span class='fu'><a href='https://purrr.tidyverse.org/reference/reduce.html'>reduce</a></span><span class='op'>(</span><span class='va'>left_join</span>, by <span class='op'>=</span> <span class='st'>"Group"</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span></span>
<span>    Group <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='va'>Group</span>, <span class='st'>" (N = "</span>, <span class='va'>N_group</span>, <span class='st'>")"</span> <span class='op'>)</span></span>
<span>    <span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span></span>
<span>      <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span></span>
<span>        x <span class='op'>=</span> <span class='va'>AESOC</span>,</span>
<span>        y <span class='op'>=</span> <span class='va'>AETOXGR</span> <span class='op'>+</span> <span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span><span class='op'>(</span><span class='va'>RACE</span><span class='op'>)</span> <span class='op'>-</span> <span class='fl'>3</span><span class='op'>)</span><span class='op'>/</span><span class='fl'>17</span>,</span>
<span>        color <span class='op'>=</span> <span class='va'>RACE</span></span>
<span>        <span class='op'>)</span>     </span>
<span>      <span class='op'>)</span> <span class='op'>+</span></span>
<span>    <span class='fu'><a href='https://rdrr.io/pkg/ggbeeswarm/man/geom_beeswarm.html'>geom_beeswarm</a></span><span class='op'>(</span></span>
<span>      <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>      cex <span class='op'>=</span> <span class='fl'>3</span>,</span>
<span>      size <span class='op'>=</span> <span class='fl'>4</span></span>
<span>      <span class='op'>)</span> <span class='op'>+</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_abline.html'>geom_hline</a></span><span class='op'>(</span></span>
<span>        yintercept <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>3.5</span>, <span class='fl'>1.5</span><span class='op'>)</span>,</span>
<span>        color <span class='op'>=</span>  <span class='st'>"darkgrey"</span>,</span>
<span>        lwd <span class='op'>=</span> <span class='fl'>0.7</span> </span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_abline.html'>geom_vline</a></span><span class='op'>(</span></span>
<span>        xintercept <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1.5</span><span class='op'>:</span><span class='fl'>3.5</span><span class='op'>)</span>,</span>
<span>        color <span class='op'>=</span> <span class='st'>"darkgrey"</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/facet_grid.html'>facet_grid</a></span><span class='op'>(</span></span>
<span>      <span class='va'>AEREL</span> <span class='op'>~</span> <span class='va'>Group</span></span>
<span>      <span class='op'>)</span> <span class='op'>+</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_y_continuous</a></span><span class='op'>(</span> expand <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>0.06</span>, <span class='fl'>0.8</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>                             <span class='co'># adding limits improves alignment of the AESEV categories with p2C</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span></span>
<span>      title <span class='op'>=</span> <span class='st'>"Individual patients and treatment groups"</span>,</span>
<span>      x <span class='op'>=</span> <span class='st'>"Affected primary organ system"</span>,</span>
<span>      y <span class='op'>=</span> <span class='st'>"Toxicitiy grade"</span></span>
<span>      <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>theme_facets_1</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span></span>
<span>    panel.grid.major.x <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>    legend.position <span class='op'>=</span> <span class='st'>"none"</span></span>
<span>    <span class='op'>)</span> </span>
<span></span>
<span><span class='co'># Plot frequency of different toxicity grades of the most severe adverse event among drug-related and unrelated event categories</span></span>
<span></span>
<span><span class='va'>annotations_p3C</span> <span class='op'>&lt;-</span>                                        <span class='co'># figure annotations for severity category</span></span>
<span>  <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span></span>
<span>  x <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>4.5</span>, <span class='fl'>2.5</span>, <span class='fl'>1</span><span class='op'>)</span>,</span>
<span>  y <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.79</span>, <span class='fl'>0.79</span>, <span class='fl'>0.79</span><span class='op'>)</span>,</span>
<span>  label <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Severe"</span>, <span class='st'>"Moderate"</span>, <span class='st'>"Mild"</span><span class='op'>)</span></span>
<span>  <span class='op'>)</span></span>
<span></span>
<span><span class='va'>p2C</span> <span class='op'>&lt;-</span> </span>
<span>  <span class='va'>dummyAEData_ed</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>                                        </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>SUBJID</span>, <span class='va'>Group</span>, <span class='va'>AEREL</span>, <span class='va'>AETOXGR</span>, <span class='va'>AESOC</span>, <span class='va'>RACE</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>SUBJID</span>, <span class='va'>AEREL</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>                             <span class='co'># select AEs with the highest toxicity grade in both the treatment-related and unrelated category for each patient</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/slice.html'>slice</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/which.min.html'>which.max</a></span><span class='op'>(</span><span class='va'>AETOXGR</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>                            </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>SUBJID</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>                                    <span class='co'># select AEs with the highest toxicity grade for each patient</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/slice.html'>slice</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/which.min.html'>which.max</a></span><span class='op'>(</span><span class='va'>AETOXGR</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>AETOXGR</span>, <span class='va'>AEREL</span>, <span class='va'>RACE</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise</a></span><span class='op'>(</span>N <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/context.html'>n</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>AEREL</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>  <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span> <span class='va'>.</span>, </span>
<span>    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise</a></span><span class='op'>(</span><span class='va'>.</span>, </span>
<span>      N_group <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>N</span><span class='op'>)</span></span>
<span>      <span class='op'>)</span></span>
<span>    <span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>  <span class='fu'><a href='https://purrr.tidyverse.org/reference/reduce.html'>reduce</a></span><span class='op'>(</span></span>
<span>    <span class='va'>left_join</span>, </span>
<span>    by <span class='op'>=</span> <span class='st'>"AEREL"</span></span>
<span>    <span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span></span>
<span>    Freq <span class='op'>=</span> <span class='va'>N</span> <span class='op'>/</span> <span class='va'>N_group</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>   <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span></span>
<span>    AEREL <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='va'>AEREL</span>, <span class='st'>" (N = "</span>, <span class='va'>N_group</span>, <span class='st'>")"</span> <span class='op'>)</span></span>
<span>    <span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span> </span>
<span>  </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span></span>
<span>      x <span class='op'>=</span> <span class='va'>AETOXGR</span>,</span>
<span>      y <span class='op'>=</span> <span class='va'>Freq</span>,</span>
<span>      fill <span class='op'>=</span> <span class='va'>RACE</span></span>
<span>      <span class='op'>)</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_bar.html'>geom_col</a></span><span class='op'>(</span></span>
<span>    alpha <span class='op'>=</span> <span class='fl'>0.8</span>,</span>
<span>    width <span class='op'>=</span> <span class='fl'>0.5</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_abline.html'>geom_vline</a></span><span class='op'>(</span></span>
<span>    xintercept <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>3.5</span>, <span class='fl'>1.5</span><span class='op'>)</span>,</span>
<span>    color <span class='op'>=</span>  <span class='st'>"darkgrey"</span>,</span>
<span>    lwd <span class='op'>=</span> <span class='fl'>0.7</span> </span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/facet_wrap.html'>facet_wrap</a></span><span class='op'>(</span></span>
<span>    <span class='op'>~</span> <span class='va'>AEREL</span>, </span>
<span>    strip.position<span class='op'>=</span><span class='st'>"right"</span>,</span>
<span>    nrow <span class='op'>=</span> <span class='fl'>2</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_text.html'>geom_text</a></span><span class='op'>(</span></span>
<span>    data <span class='op'>=</span> <span class='va'>annotations_p3C</span>, </span>
<span>    inherit.aes <span class='op'>=</span> <span class='cn'>FALSE</span>, </span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span></span>
<span>      x <span class='op'>=</span> <span class='va'>x</span>, </span>
<span>      y <span class='op'>=</span> <span class='va'>y</span>, </span>
<span>      label <span class='op'>=</span> <span class='va'>label</span></span>
<span>      <span class='op'>)</span>, </span>
<span>    size <span class='op'>=</span> <span class='fl'>3.5</span>, </span>
<span>    angle <span class='op'>=</span> <span class='fl'>270</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='co'>#scale_fill_manual(values = c("#C52A2A", "#4682B4") ) +</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_discrete.html'>scale_x_discrete</a></span><span class='op'>(</span>limits <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>5</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_y_continuous</a></span><span class='op'>(</span></span>
<span>    labels <span class='op'>=</span> <span class='fu'>scales</span><span class='fu'>::</span><span class='fu'><a href='https://scales.r-lib.org/reference/percent_format.html'>percent_format</a></span><span class='op'>(</span></span>
<span>      accuracy <span class='op'>=</span> <span class='fl'>1</span></span>
<span>      <span class='op'>)</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span></span>
<span>    title <span class='op'>=</span> <span class='st'>"Toxicity grade: \nsummary across treatment groups"</span>,</span>
<span>    y <span class='op'>=</span> <span class='st'>'Frequency among "drug-related" \ncategory events'</span>,</span>
<span>    fill <span class='op'>=</span> <span class='st'>"RACE"</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>theme_facets_1</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span></span>
<span>    plot.margin <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/grid/unit.html'>unit</a></span><span class='op'>(</span></span>
<span>      <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.5</span>, <span class='fl'>0.5</span>, <span class='fl'>0.5</span> ,<span class='fl'>0.5</span><span class='op'>)</span>, <span class='st'>"cm"</span></span>
<span>      <span class='op'>)</span>,</span>
<span>    axis.title.y <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>    axis.text.y <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>    axis.ticks.y <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>    panel.grid.major.x <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>    legend.position <span class='op'>=</span> <span class='st'>"none"</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/coord_flip.html'>coord_flip</a></span><span class='op'>(</span><span class='op'>)</span> </span>
<span></span>
<span></span>
<span><span class='va'>p2As</span> <span class='op'>&lt;-</span> </span>
<span>  <span class='va'>p2A</span> <span class='op'>+</span> <span class='fu'><a href='https://patchwork.data-imaginist.com/reference/plot_spacer.html'>plot_spacer</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>       <span class='co'># spacers added to reduce gap between plots B and C, and align A: values adjusted for a 1400 x 1400 png image file output</span></span>
<span>  <span class='fu'><a href='https://patchwork.data-imaginist.com/reference/plot_layout.html'>plot_layout</a></span><span class='op'>(</span></span>
<span>    widths <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>8</span>, <span class='fl'>0.5</span><span class='op'>)</span></span>
<span>    <span class='op'>)</span> </span>
<span></span>
<span><span class='va'>p2BC</span> <span class='op'>&lt;-</span> </span>
<span>  <span class='va'>p2B</span> <span class='op'>+</span> <span class='fu'><a href='https://patchwork.data-imaginist.com/reference/plot_spacer.html'>plot_spacer</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span> <span class='va'>p2C</span> <span class='op'>+</span>                 </span>
<span>  <span class='fu'><a href='https://patchwork.data-imaginist.com/reference/plot_layout.html'>plot_layout</a></span><span class='op'>(</span></span>
<span>    widths <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>8</span>, <span class='op'>-</span><span class='fl'>0.3</span> ,<span class='fl'>2</span><span class='op'>)</span></span>
<span>    <span class='op'>)</span> </span>
<span></span>
<span><span class='va'>p2As</span> <span class='op'>/</span> <span class='va'>p2BC</span> <span class='op'>+</span> </span>
<span>  <span class='fu'><a href='https://patchwork.data-imaginist.com/reference/plot_layout.html'>plot_layout</a></span><span class='op'>(</span></span>
<span>    design <span class='op'>=</span> <span class='st'>"AAAAA</span></span>
<span><span class='st'>              BBBBB</span></span>
<span><span class='st'>              BBBBB</span></span>
<span><span class='st'>              BBBBB</span></span>
<span><span class='st'>              BBBBB"</span>      </span>
<span>    <span class='op'>)</span> <span class='op'>+</span>    </span>
<span>    <span class='fu'><a href='https://patchwork.data-imaginist.com/reference/plot_annotation.html'>plot_annotation</a></span><span class='op'>(</span></span>
<span>        title <span class='op'>=</span> <span class='st'>"Highest toxicity grade events in patients from different races, by treatment, organ system, and drug-relatedness of the event"</span>,</span>
<span>        theme <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span></span>
<span>            plot.title <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span></span>
<span>                face <span class='op'>=</span> <span class='st'>"bold"</span>,</span>
<span>                size <span class='op'>=</span> <span class='fl'>14</span>, </span>
<span>                hjust <span class='op'>=</span> <span class='fl'>0.5</span></span>
<span>            <span class='op'>)</span>,</span>
<span>            plot.caption <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span></span>
<span>                size <span class='op'>=</span> <span class='fl'>9</span>,</span>
<span>                hjust <span class='op'>=</span> <span class='fl'>0.5</span></span>
<span>            <span class='op'>)</span></span>
<span>        <span class='op'>)</span></span>
<span>    <span class='op'>)</span></span></code></pre>
</div>
</div>
<p><a href="#example7">Back to blog</a></p>
<p><a id="example8 code"></a></p>
<h3 id="examples-8-discretisation-of-biomarker-1-measurements">Examples 8: Discretisation of biomarker 1 measurements</h3>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># - Chunk 6</span></span>
<span><span class='co'># - Required: * R libraries (chunk libraries_and_data)</span></span>
<span><span class='co'># -           * dummyAEData_ed (chunk dataEd)</span></span>
<span></span>
<span></span>
<span><span class='co'>## Biomarkers</span></span>
<span></span>
<span><span class='va'>BMRKR1_lims</span> <span class='op'>&lt;-</span> <span class='va'>dummyAEData_ed</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>                 <span class='co'># categorise BMRKR1 by quantiles or range</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>SUBJID</span>, <span class='va'>BMRKR1</span>, <span class='va'>Group</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/pull.html'>pull</a></span><span class='op'>(</span><span class='va'>BMRKR1</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>  <span class='fu'><a href='https://rdrr.io/r/stats/quantile.html'>quantile</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.33</span>, <span class='fl'>0.67</span>, <span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>  <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='va'>.</span><span class='op'>)</span></span>
<span><span class='co'>#  range() %&gt;% </span></span>
<span><span class='co'>#  {c(.[1] + diff(.)/3 * c(0, 1, 2, 3))}</span></span>
<span></span>
<span></span>
<span><span class='co'># Biomarker 1 and 2 discretised values: distribution of measurements among treatment groups</span></span>
<span></span>
<span><span class='va'>p3A</span> <span class='op'>&lt;-</span> </span>
<span>  <span class='va'>dummyAEData_ed</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>SUBJID</span>, <span class='va'>BMRKR1</span>, <span class='va'>BMRKR2</span>, <span class='va'>Group</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span></span>
<span>        <span class='st'>"Biomarker 1"</span> <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/case_when.html'>case_when</a></span><span class='op'>(</span></span>
<span>            <span class='va'>BMRKR1</span> <span class='op'>&lt;</span> <span class='va'>BMRKR1_lims</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span> <span class='op'>~</span> <span class='st'>"LOW"</span>,</span>
<span>            <span class='va'>BMRKR1</span> <span class='op'>&lt;</span> <span class='va'>BMRKR1_lims</span><span class='op'>[</span><span class='fl'>3</span><span class='op'>]</span> <span class='op'>~</span> <span class='st'>"MEDIUM"</span>,</span>
<span>            <span class='cn'>TRUE</span> <span class='op'>~</span> <span class='st'>"HIGH"</span></span>
<span>        <span class='op'>)</span></span>
<span>    <span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/rename.html'>rename</a></span><span class='op'>(</span><span class='st'>"Biomarker 2"</span> <span class='op'>=</span> <span class='va'>BMRKR2</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>    <span class='fu'><a href='https://tidyr.tidyverse.org/reference/pivot_longer.html'>pivot_longer</a></span><span class='op'>(</span></span>
<span>        cols <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>`Biomarker 1`</span>, <span class='va'>`Biomarker 2`</span><span class='op'>)</span>,</span>
<span>        names_to <span class='op'>=</span> <span class='st'>"Biomarker"</span> </span>
<span>    <span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span></span>
<span>        color <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/case_when.html'>case_when</a></span><span class='op'>(</span></span>
<span>            <span class='va'>Group</span> <span class='op'><a href='https://rdrr.io/r/base/match.html'>%in%</a></span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span></span>
<span>                <span class='st'>"Placebo - Placebo"</span>, <span class='st'>"Drug X - Drug X"</span></span>
<span>            <span class='op'>)</span> <span class='op'>~</span> <span class='st'>"1"</span>,</span>
<span>            <span class='cn'>TRUE</span> <span class='op'>~</span> <span class='st'>"0"</span>          </span>
<span>        <span class='op'>)</span>,</span>
<span>    value <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>value</span>, levels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"LOW"</span>, <span class='st'>"MEDIUM"</span>, <span class='st'>"HIGH"</span><span class='op'>)</span><span class='op'>)</span></span>
<span>    <span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>    </span>
<span>    </span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span> </span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_histogram.html'>geom_histogram</a></span><span class='op'>(</span></span>
<span>        <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span></span>
<span>            x <span class='op'>=</span> <span class='va'>value</span>,</span>
<span>            fill <span class='op'>=</span> <span class='va'>color</span><span class='op'>)</span>,</span>
<span>        color <span class='op'>=</span> <span class='st'>"darkgrey"</span>,</span>
<span>        stat <span class='op'>=</span> <span class='st'>"count"</span>, </span>
<span>        position<span class='op'>=</span><span class='st'>"dodge"</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/facet_grid.html'>facet_grid</a></span><span class='op'>(</span></span>
<span>        <span class='va'>Biomarker</span> <span class='op'>~</span> <span class='va'>Group</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_manual.html'>scale_fill_manual</a></span> <span class='op'>(</span></span>
<span>        values <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"lightgrey"</span>, <span class='st'>"darkgrey"</span><span class='op'>)</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span></span>
<span>      <span class='co'># title = "Categorised levels of biomarker 1 and 2 in different treatment groups",</span></span>
<span>      y <span class='op'>=</span> <span class='st'>"Patients (N)"</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_light</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span></span>
<span>        plot.title <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span></span>
<span>            size <span class='op'>=</span> <span class='fl'>12</span>,</span>
<span>            hjust <span class='op'>=</span> <span class='fl'>0.5</span><span class='op'>)</span>,</span>
<span>        strip.background <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_rect</a></span><span class='op'>(</span></span>
<span>            fill <span class='op'>=</span> <span class='st'>"white"</span>, </span>
<span>            color <span class='op'>=</span> <span class='st'>"darkgrey"</span></span>
<span>        <span class='op'>)</span>, </span>
<span>        strip.text <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span></span>
<span>            colour<span class='op'>=</span><span class='st'>"black"</span>,</span>
<span>            size <span class='op'>=</span> <span class='fl'>12</span></span>
<span>        <span class='op'>)</span>,</span>
<span>    axis.title.x <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>    legend.position <span class='op'>=</span> <span class='st'>"none"</span></span>
<span>    <span class='op'>)</span>  </span>
<span></span>
<span></span>
<span><span class='co'># Biomarker 1 measurements: distribution of measurements among treatment groups</span></span>
<span></span>
<span><span class='va'>p3B</span> <span class='op'>&lt;-</span> </span>
<span>  <span class='va'>dummyAEData_ed</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>BMRKR1</span>, <span class='va'>Group</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span></span>
<span>      x <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>Group</span><span class='op'>)</span>,</span>
<span>      y <span class='op'>=</span> <span class='va'>BMRKR1</span></span>
<span>    <span class='op'>)</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_violin.html'>geom_violin</a></span><span class='op'>(</span></span>
<span>    color <span class='op'>=</span> <span class='st'>"lightgrey"</span>,</span>
<span>    fill  <span class='op'>=</span> <span class='st'>"lightgrey"</span>, </span>
<span>    width <span class='op'>=</span> <span class='fl'>0.45</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_jitter.html'>geom_jitter</a></span><span class='op'>(</span></span>
<span>    height <span class='op'>=</span> <span class='fl'>0</span>, width <span class='op'>=</span> <span class='fl'>0.1</span>, </span>
<span>    size <span class='op'>=</span> <span class='fl'>2</span>, </span>
<span>    alpha <span class='op'>=</span> <span class='fl'>0.2</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_boxplot.html'>geom_boxplot</a></span><span class='op'>(</span></span>
<span>    width <span class='op'>=</span> <span class='fl'>0.15</span> , </span>
<span>    outlier.shape <span class='op'>=</span> <span class='cn'>NA</span>,</span>
<span>    color <span class='op'>=</span> <span class='st'>"salmon"</span>,</span>
<span>    lwd <span class='op'>=</span> <span class='fl'>0.7</span>,</span>
<span>    alpha <span class='op'>=</span> <span class='fl'>0.5</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_abline.html'>geom_hline</a></span><span class='op'>(</span></span>
<span>    yintercept <span class='op'>=</span> <span class='va'>BMRKR1_lims</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>:</span><span class='fl'>3</span><span class='op'>]</span>,</span>
<span>    colour <span class='op'>=</span> <span class='st'>"darkgrey"</span>,</span>
<span>    alpha <span class='op'>=</span> <span class='fl'>0.3</span>,</span>
<span>    lwd <span class='op'>=</span> <span class='fl'>1.2</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span></span>
<span>    <span class='st'>"text"</span>,</span>
<span>    x <span class='op'>=</span> <span class='fl'>4.5</span>, </span>
<span>    y <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>BMRKR1_lims</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>  <span class='op'>{</span><span class='va'>.</span><span class='op'>[</span><span class='op'>-</span><span class='fl'>1</span><span class='op'>]</span> <span class='op'>-</span> <span class='fu'><a href='https://rdrr.io/r/base/diff.html'>diff</a></span><span class='op'>(</span><span class='va'>.</span><span class='op'>)</span><span class='op'>/</span><span class='fl'>2</span><span class='op'>}</span><span class='op'>)</span>, </span>
<span>    label <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"LOW"</span>, <span class='st'>"MEDIUM"</span>, <span class='st'>"HIGH"</span><span class='op'>)</span>,</span>
<span>    size <span class='op'>=</span> <span class='fl'>3.5</span>, </span>
<span>    angle <span class='op'>=</span> <span class='fl'>270</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/stat_summary.html'>stat_summary</a></span><span class='op'>(</span></span>
<span>    fun.data <span class='op'>=</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span><span class='op'>{</span></span>
<span>      <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span></span>
<span>        y <span class='op'>=</span> <span class='fl'>0</span>,</span>
<span>        label <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste</a></span><span class='op'>(</span><span class='st'>"N ="</span>, <span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span></span>
<span>        <span class='op'>)</span></span>
<span>      <span class='op'>)</span></span>
<span>    <span class='op'>}</span>, </span>
<span>    geom <span class='op'>=</span> <span class='st'>"text"</span>, </span>
<span>    vjust <span class='op'>=</span> <span class='fl'>0.5</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span></span>
<span>    <span class='co'>#title = "Biomarker 1 levels in different treatment groups",</span></span>
<span>    <span class='co'>#x = "Group",</span></span>
<span>    y <span class='op'>=</span> <span class='st'>"Biomarker 1 measurement"</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/expand_limits.html'>expand_limits</a></span><span class='op'>(</span>y <span class='op'>=</span> <span class='fl'>0</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_light</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span></span>
<span>    axis.text <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span></span>
<span>      size <span class='op'>=</span> <span class='fl'>12</span><span class='op'>)</span>,</span>
<span>    axis.title.x <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>    axis.ticks.x <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>    axis.text.x <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>    axis.text.y <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>size <span class='op'>=</span> <span class='fl'>10</span><span class='op'>)</span></span>
<span>    <span class='op'>)</span> </span>
<span></span>
<span><span class='va'>p3A</span> <span class='op'>/</span> <span class='va'>p3B</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://patchwork.data-imaginist.com/reference/plot_annotation.html'>plot_annotation</a></span><span class='op'>(</span></span>
<span>    title <span class='op'>=</span> <span class='st'>"Levels of biomarker 1 and 2 in different treatment groups"</span>,</span>
<span>    theme <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span></span>
<span>      plot.title <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span></span>
<span>        size <span class='op'>=</span> <span class='fl'>14</span>, </span>
<span>        hjust <span class='op'>=</span> <span class='fl'>0.5</span></span>
<span>        <span class='op'>)</span></span>
<span>      <span class='op'>)</span></span>
<span>    <span class='op'>)</span></span></code></pre>
</div>
</div>
<p><a href="#example8">Back to blog</a></p>
<p><a id="example9 code"></a></p>
<h3 id="examples-9-toxicity-grade-and-affected-primary-organ-system-of-the-most-severe-adverse-event-in-each-patient-stratified-by-treatment-adverse-event-relation-to-drug-and-biomarker-1-categorical-level">Examples 9: Toxicity grade and affected primary organ system of the most severe adverse event in each patient, stratified by treatment, adverse event relation to drug, and biomarker 1 categorical level</h3>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># - Chunk 7</span></span>
<span><span class='co'># - Required: * R libraries (chunk libraries_and_data)</span></span>
<span><span class='co'># -           * dummyAEData_ed (chunk dataEd)</span></span>
<span><span class='co'># -           * theme_facets_1 (chunk 4)</span></span>
<span><span class='co'># -           * BMRKR1_lims (chunk 6)</span></span>
<span></span>
<span><span class='co'>## Toxicity grade and affected primary organ system of the most severe adverse event in each patient, stratified by treatment, adverse event relation to drug,</span></span>
<span><span class='co'>## and biomarker 1 categorical levels</span></span>
<span></span>
<span><span class='va'>palette_4</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"#eb984e"</span>, <span class='st'>"#5dade2"</span>, <span class='st'>"#58d68d"</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>dummyAEData_bmrkr1Cat</span> <span class='op'>&lt;-</span> </span>
<span>  <span class='va'>dummyAEData_ed</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>                                        </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span></span>
<span>    <span class='va'>SUBJID</span>, <span class='va'>Group</span>, </span>
<span>    <span class='va'>AEREL</span>, <span class='va'>AETOXGR</span>, <span class='va'>AESEV</span>, <span class='va'>AESOC</span>, </span>
<span>    <span class='va'>BMRKR1</span></span>
<span>    <span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span></span>
<span>      BMRKR1cat <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/case_when.html'>case_when</a></span><span class='op'>(</span></span>
<span>      <span class='va'>BMRKR1</span> <span class='op'>&lt;</span> <span class='va'>BMRKR1_lims</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span> <span class='op'>~</span> <span class='st'>"LOW"</span>,</span>
<span>      <span class='va'>BMRKR1</span> <span class='op'>&lt;</span> <span class='va'>BMRKR1_lims</span><span class='op'>[</span><span class='fl'>3</span><span class='op'>]</span> <span class='op'>~</span> <span class='st'>"MEDIUM"</span>,</span>
<span>      <span class='cn'>TRUE</span> <span class='op'>~</span> <span class='st'>"HIGH"</span></span>
<span>      <span class='op'>)</span>,</span>
<span>    BMRKR1cat <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>BMRKR1cat</span>, </span>
<span>      levels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"HIGH"</span>, <span class='st'>"MEDIUM"</span>, <span class='st'>"LOW"</span><span class='op'>)</span></span>
<span>      <span class='op'>)</span></span>
<span>    <span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>SUBJID</span>, <span class='va'>AEREL</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>                             <span class='co'># select AEs with the highest toxicity grade in both the treatment-related and unrelated category for each patient</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/slice.html'>slice</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/which.min.html'>which.max</a></span><span class='op'>(</span><span class='va'>AETOXGR</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>                            </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>SUBJID</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>                                    <span class='co'># select AEs with the highest toxicity grade for each patient</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/slice.html'>slice</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/which.min.html'>which.max</a></span><span class='op'>(</span><span class='va'>AETOXGR</span><span class='op'>)</span><span class='op'>)</span> </span>
<span></span>
<span></span>
<span><span class='va'>p3A</span> <span class='op'>&lt;-</span> </span>
<span>  <span class='va'>dummyAEData_bmrkr1Cat</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>AETOXGR</span>, <span class='va'>AESEV</span>, <span class='va'>AESOC</span>, <span class='va'>BMRKR1cat</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise</a></span><span class='op'>(</span>N <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/context.html'>n</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>AESOC</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>  <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span> <span class='va'>.</span>, </span>
<span>    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise</a></span><span class='op'>(</span><span class='va'>.</span>, </span>
<span>      N_group <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>N</span><span class='op'>)</span></span>
<span>      <span class='op'>)</span></span>
<span>    <span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>  <span class='fu'><a href='https://purrr.tidyverse.org/reference/reduce.html'>reduce</a></span><span class='op'>(</span></span>
<span>    <span class='va'>left_join</span>, </span>
<span>    by <span class='op'>=</span> <span class='st'>"AESOC"</span></span>
<span>    <span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span></span>
<span>    Freq <span class='op'>=</span> <span class='va'>N</span> <span class='op'>/</span> <span class='va'>N_group</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>   <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span></span>
<span>    AESOC <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='va'>AESOC</span>, <span class='st'>" (N = "</span>, <span class='va'>N_group</span>, <span class='st'>")"</span> <span class='op'>)</span>,</span>
<span>    AESOC <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>AESOC</span><span class='op'>)</span>,</span>
<span>    AETOXGR <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>AETOXGR</span>, levels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>5</span><span class='op'>)</span><span class='op'>)</span>,</span>
<span>    AESEV <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span></span>
<span>      <span class='va'>AESEV</span>, </span>
<span>      levels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/rev.html'>rev</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/levels.html'>levels</a></span><span class='op'>(</span><span class='va'>AESEV</span><span class='op'>)</span> <span class='op'>)</span></span>
<span>      <span class='op'>)</span></span>
<span>    <span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>  </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span></span>
<span>      x <span class='op'>=</span> <span class='va'>AETOXGR</span>,</span>
<span>      y <span class='op'>=</span> <span class='va'>Freq</span>,</span>
<span>      fill <span class='op'>=</span> <span class='va'>BMRKR1cat</span></span>
<span>      <span class='op'>)</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_bar.html'>geom_col</a></span><span class='op'>(</span>alpha <span class='op'>=</span> <span class='fl'>0.8</span> <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://teunbrand.github.io/ggh4x/reference/facet_grid2.html'>facet_grid2</a></span><span class='op'>(</span></span>
<span>    <span class='va'>AESEV</span> <span class='op'>~</span> <span class='va'>AESOC</span>,</span>
<span>    scales <span class='op'>=</span> <span class='st'>"free_y"</span>,                                                  <span class='co'># makes facet height proportional to range of AETOXGR, and</span></span>
<span>    space <span class='op'>=</span> <span class='st'>"free"</span>                                                      <span class='co'># generates custom limits for the AETOXGR scale for each AESEV category</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_manual.html'>scale_fill_manual</a></span><span class='op'>(</span>values <span class='op'>=</span> <span class='va'>palette_4</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_discrete.html'>scale_x_discrete</a></span><span class='op'>(</span>breaks <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/levels.html'>levels</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>dummyAEData_ed</span><span class='op'>$</span><span class='va'>AETOXGR</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>)</span> <span class='op'>+</span>   <span class='co'># generates the appropriate custom breaks for each facet</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_y_continuous</a></span><span class='op'>(</span></span>
<span>    labels <span class='op'>=</span> <span class='fu'>scales</span><span class='fu'>::</span><span class='fu'><a href='https://scales.r-lib.org/reference/percent_format.html'>percent_format</a></span><span class='op'>(</span></span>
<span>      accuracy <span class='op'>=</span> <span class='fl'>1</span></span>
<span>      <span class='op'>)</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span></span>
<span>    title <span class='op'>=</span> <span class='st'>"Primary organ system: summary across treatment groups"</span>,</span>
<span>    x <span class='op'>=</span> <span class='st'>"Toxicity grade"</span>,</span>
<span>    y <span class='op'>=</span> <span class='st'>"Frequency in primary organ system"</span>,</span>
<span>    fill <span class='op'>=</span> <span class='st'>"Biomarker 1"</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>theme_facets_1</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span></span>
<span>    plot.margin <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/grid/unit.html'>unit</a></span><span class='op'>(</span></span>
<span>      <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.5</span>, <span class='fl'>0.5</span>, <span class='fl'>0.5</span> ,<span class='fl'>0.5</span><span class='op'>)</span>, <span class='st'>"cm"</span></span>
<span>      <span class='op'>)</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/coord_flip.html'>coord_flip</a></span><span class='op'>(</span><span class='op'>)</span></span>
<span></span>
<span></span>
<span><span class='va'>p3B</span> <span class='op'>&lt;-</span> </span>
<span>  <span class='va'>dummyAEData_bmrkr1Cat</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>Group</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>                                      <span class='co'># add group totals</span></span>
<span>  <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span> <span class='va'>.</span>, <span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise</a></span><span class='op'>(</span><span class='va'>.</span>, N_group <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/context.html'>n</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>  <span class='fu'><a href='https://purrr.tidyverse.org/reference/reduce.html'>reduce</a></span><span class='op'>(</span><span class='va'>left_join</span>, by <span class='op'>=</span> <span class='st'>"Group"</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span></span>
<span>    Group <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='va'>Group</span>, <span class='st'>" (N = "</span>, <span class='va'>N_group</span>, <span class='st'>")"</span> <span class='op'>)</span></span>
<span>    <span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span></span>
<span>      <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span></span>
<span>        x <span class='op'>=</span> <span class='va'>AESOC</span>,</span>
<span>        y <span class='op'>=</span> <span class='va'>AETOXGR</span> <span class='op'>+</span> <span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span><span class='op'>(</span><span class='va'>BMRKR1cat</span><span class='op'>)</span> <span class='op'>-</span> <span class='fl'>3</span><span class='op'>)</span><span class='op'>/</span><span class='fl'>17</span>,</span>
<span>        color <span class='op'>=</span> <span class='va'>BMRKR1cat</span></span>
<span>        <span class='op'>)</span>     </span>
<span>      <span class='op'>)</span> <span class='op'>+</span></span>
<span>    <span class='fu'><a href='https://rdrr.io/pkg/ggbeeswarm/man/geom_beeswarm.html'>geom_beeswarm</a></span><span class='op'>(</span></span>
<span>      <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>      cex <span class='op'>=</span> <span class='fl'>3</span>,</span>
<span>      size <span class='op'>=</span> <span class='fl'>4</span></span>
<span>      <span class='op'>)</span> <span class='op'>+</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_abline.html'>geom_hline</a></span><span class='op'>(</span></span>
<span>        yintercept <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>3.5</span>, <span class='fl'>1.5</span><span class='op'>)</span>,</span>
<span>        color <span class='op'>=</span>  <span class='st'>"darkgrey"</span>,</span>
<span>        lwd <span class='op'>=</span> <span class='fl'>0.7</span> </span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_abline.html'>geom_vline</a></span><span class='op'>(</span></span>
<span>        xintercept <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1.5</span><span class='op'>:</span><span class='fl'>3.5</span><span class='op'>)</span>,</span>
<span>        color <span class='op'>=</span> <span class='st'>"darkgrey"</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/facet_grid.html'>facet_grid</a></span><span class='op'>(</span></span>
<span>      <span class='va'>AEREL</span> <span class='op'>~</span> <span class='va'>Group</span></span>
<span>      <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_manual.html'>scale_color_manual</a></span><span class='op'>(</span>values <span class='op'>=</span> <span class='va'>palette_4</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_y_continuous</a></span><span class='op'>(</span> expand <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>0.06</span>, <span class='fl'>0.8</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>                             <span class='co'># adding limits improves alignment of the AESEV categories with p2C</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span></span>
<span>      title <span class='op'>=</span> <span class='st'>"Individual patients and treatment groups"</span>,</span>
<span>      x <span class='op'>=</span> <span class='st'>"Affected primary organ system"</span>,</span>
<span>      y <span class='op'>=</span> <span class='st'>"Toxicitiy grade"</span></span>
<span>      <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>theme_facets_1</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span></span>
<span>    panel.grid.major.x <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>    legend.position <span class='op'>=</span> <span class='st'>"none"</span></span>
<span>    <span class='op'>)</span> </span>
<span></span>
<span></span>
<span><span class='co'># Plot frequency of different toxicity grades of the most severe adverse event among drug-related and unrelated event categories</span></span>
<span></span>
<span><span class='va'>annotations_p3C</span> <span class='op'>&lt;-</span>                                        <span class='co'># figure annotations for severity category</span></span>
<span>  <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span></span>
<span>  x <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>4.5</span>, <span class='fl'>2.5</span>, <span class='fl'>1</span><span class='op'>)</span>,</span>
<span>  y <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.79</span>, <span class='fl'>0.79</span>, <span class='fl'>0.79</span><span class='op'>)</span>,</span>
<span>  label <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Severe"</span>, <span class='st'>"Moderate"</span>, <span class='st'>"Mild"</span><span class='op'>)</span></span>
<span>  <span class='op'>)</span></span>
<span></span>
<span><span class='va'>p3C</span> <span class='op'>&lt;-</span> </span>
<span>  <span class='va'>dummyAEData_bmrkr1Cat</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>                                        </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>AETOXGR</span>, <span class='va'>AEREL</span>, <span class='va'>BMRKR1cat</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise</a></span><span class='op'>(</span>N <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/context.html'>n</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>AEREL</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>  <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span> <span class='va'>.</span>, </span>
<span>    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise</a></span><span class='op'>(</span><span class='va'>.</span>, </span>
<span>      N_group <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>N</span><span class='op'>)</span></span>
<span>      <span class='op'>)</span></span>
<span>    <span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>  <span class='fu'><a href='https://purrr.tidyverse.org/reference/reduce.html'>reduce</a></span><span class='op'>(</span></span>
<span>    <span class='va'>left_join</span>, </span>
<span>    by <span class='op'>=</span> <span class='st'>"AEREL"</span></span>
<span>    <span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span></span>
<span>    Freq <span class='op'>=</span> <span class='va'>N</span> <span class='op'>/</span> <span class='va'>N_group</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>   <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span></span>
<span>    AEREL <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='va'>AEREL</span>, <span class='st'>" (N = "</span>, <span class='va'>N_group</span>, <span class='st'>")"</span> <span class='op'>)</span></span>
<span>    <span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span> </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span></span>
<span>      x <span class='op'>=</span> <span class='va'>AETOXGR</span>,</span>
<span>      y <span class='op'>=</span> <span class='va'>Freq</span>,</span>
<span>      fill <span class='op'>=</span> <span class='va'>BMRKR1cat</span></span>
<span>      <span class='op'>)</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_bar.html'>geom_col</a></span><span class='op'>(</span></span>
<span>    alpha <span class='op'>=</span> <span class='fl'>0.8</span>,</span>
<span>    width <span class='op'>=</span> <span class='fl'>0.5</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_abline.html'>geom_vline</a></span><span class='op'>(</span></span>
<span>    xintercept <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>3.5</span>, <span class='fl'>1.5</span><span class='op'>)</span>,</span>
<span>    color <span class='op'>=</span>  <span class='st'>"darkgrey"</span>,</span>
<span>    lwd <span class='op'>=</span> <span class='fl'>0.7</span> </span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/facet_wrap.html'>facet_wrap</a></span><span class='op'>(</span></span>
<span>    <span class='op'>~</span> <span class='va'>AEREL</span>, </span>
<span>    strip.position<span class='op'>=</span><span class='st'>"right"</span>,</span>
<span>    nrow <span class='op'>=</span> <span class='fl'>2</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_text.html'>geom_text</a></span><span class='op'>(</span></span>
<span>    data <span class='op'>=</span> <span class='va'>annotations_p3C</span>, </span>
<span>    inherit.aes <span class='op'>=</span> <span class='cn'>FALSE</span>, </span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span></span>
<span>      x <span class='op'>=</span> <span class='va'>x</span>, </span>
<span>      y <span class='op'>=</span> <span class='va'>y</span>, </span>
<span>      label <span class='op'>=</span> <span class='va'>label</span></span>
<span>      <span class='op'>)</span>, </span>
<span>    size <span class='op'>=</span> <span class='fl'>3.5</span>, </span>
<span>    angle <span class='op'>=</span> <span class='fl'>270</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_manual.html'>scale_fill_manual</a></span><span class='op'>(</span>values <span class='op'>=</span> <span class='va'>palette_4</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_discrete.html'>scale_x_discrete</a></span><span class='op'>(</span>limits <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>5</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_y_continuous</a></span><span class='op'>(</span></span>
<span>    labels <span class='op'>=</span> <span class='fu'>scales</span><span class='fu'>::</span><span class='fu'><a href='https://scales.r-lib.org/reference/percent_format.html'>percent_format</a></span><span class='op'>(</span></span>
<span>      accuracy <span class='op'>=</span> <span class='fl'>1</span></span>
<span>      <span class='op'>)</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span></span>
<span>    title <span class='op'>=</span> <span class='st'>"Toxicity grade: \nsummary across treatment groups"</span>,</span>
<span>    y <span class='op'>=</span> <span class='st'>'Frequency among "drug-related" \ncategory events'</span>,</span>
<span>    fill <span class='op'>=</span> <span class='st'>"Biomarker 1"</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>theme_facets_1</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span></span>
<span>    plot.margin <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/grid/unit.html'>unit</a></span><span class='op'>(</span></span>
<span>      <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.5</span>, <span class='fl'>0.5</span>, <span class='fl'>0.5</span> ,<span class='fl'>0.5</span><span class='op'>)</span>, <span class='st'>"cm"</span></span>
<span>      <span class='op'>)</span>,</span>
<span>    axis.title.y <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>    axis.text.y <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>    axis.ticks.y <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>    panel.grid.major.x <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>    legend.position <span class='op'>=</span> <span class='st'>"none"</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/coord_flip.html'>coord_flip</a></span><span class='op'>(</span><span class='op'>)</span></span>
<span></span>
<span></span>
<span><span class='va'>p3As</span> <span class='op'>&lt;-</span> </span>
<span>  <span class='va'>p3A</span> <span class='op'>+</span> <span class='fu'><a href='https://patchwork.data-imaginist.com/reference/plot_spacer.html'>plot_spacer</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>       <span class='co'># spacers added to reduce gap between plots B and C, and align A: values adjusted for a 1400 x 1400 png image file output</span></span>
<span>  <span class='fu'><a href='https://patchwork.data-imaginist.com/reference/plot_layout.html'>plot_layout</a></span><span class='op'>(</span></span>
<span>    widths <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>8</span>, <span class='fl'>0.7</span><span class='op'>)</span></span>
<span>    <span class='op'>)</span> </span>
<span></span>
<span><span class='va'>p3BC</span> <span class='op'>&lt;-</span> </span>
<span>  <span class='va'>p3B</span> <span class='op'>+</span> <span class='fu'><a href='https://patchwork.data-imaginist.com/reference/plot_spacer.html'>plot_spacer</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span> <span class='va'>p3C</span> <span class='op'>+</span>                 </span>
<span>  <span class='fu'><a href='https://patchwork.data-imaginist.com/reference/plot_layout.html'>plot_layout</a></span><span class='op'>(</span></span>
<span>    widths <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>8</span>, <span class='op'>-</span><span class='fl'>0.3</span> ,<span class='fl'>2</span><span class='op'>)</span></span>
<span>    <span class='op'>)</span> </span>
<span></span>
<span><span class='va'>p3As</span> <span class='op'>/</span> <span class='va'>p3BC</span> <span class='op'>+</span> </span>
<span>  <span class='fu'><a href='https://patchwork.data-imaginist.com/reference/plot_layout.html'>plot_layout</a></span><span class='op'>(</span></span>
<span>    design <span class='op'>=</span> <span class='st'>"AAAAA</span></span>
<span><span class='st'>              BBBBB</span></span>
<span><span class='st'>              BBBBB</span></span>
<span><span class='st'>              BBBBB</span></span>
<span><span class='st'>              BBBBB"</span>      </span>
<span>    <span class='op'>)</span> <span class='op'>+</span>    </span>
<span>    <span class='fu'><a href='https://patchwork.data-imaginist.com/reference/plot_annotation.html'>plot_annotation</a></span><span class='op'>(</span></span>
<span>        title <span class='op'>=</span> <span class='st'>"Patient biomarker 1 levels and highest toxicity grade events, by treatment, organ system, and drug-related type of event"</span>,</span>
<span>        theme <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span></span>
<span>            plot.title <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span></span>
<span>                face <span class='op'>=</span> <span class='st'>"bold"</span>,</span>
<span>                size <span class='op'>=</span> <span class='fl'>14</span>, </span>
<span>                hjust <span class='op'>=</span> <span class='fl'>0.5</span></span>
<span>            <span class='op'>)</span>,</span>
<span>            plot.caption <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span></span>
<span>                size <span class='op'>=</span> <span class='fl'>9</span>,</span>
<span>                hjust <span class='op'>=</span> <span class='fl'>0.5</span></span>
<span>            <span class='op'>)</span></span>
<span>        <span class='op'>)</span></span>
<span>    <span class='op'>)</span></span></code></pre>
</div>
</div>
<p><a href="#example9">Back to blog</a></p>
<p><a id="example10 code"></a></p>
<h3 id="examples-10-fatal-aes-and-cause-of-death-visualising-membership-in-multiple-sets-and-their-intersections">Examples 10: Fatal AEs and cause of death: Visualising membership in multiple sets and their intersections</h3>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># - Chunk_11</span></span>
<span><span class='co'># - Required: * R libraries (chunk libraries_and_data)</span></span>
<span><span class='co'># -           * dummyAEData_ed (chunk dataEd)</span></span>
<span></span>
<span></span>
<span><span class='co'>## Frequency of patients who suffered "Fatal" and/or "Cause of death" adverse events </span></span>
<span></span>
<span><span class='co'># Function for generating the Venn diagrams</span></span>
<span></span>
<span><span class='va'>drawVenn_fatalAE</span> <span class='op'>&lt;-</span> </span>
<span></span>
<span>  <span class='kw'>function</span><span class='op'>(</span><span class='va'>data</span>, <span class='va'>treatment</span><span class='op'>)</span> <span class='op'>{</span></span>
<span></span>
<span>  <span class='va'>patients_n</span> <span class='op'>&lt;-</span> </span>
<span>    <span class='va'>dummyAEData_ed</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>SUBJID</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/slice.html'>slice</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/which.min.html'>which.max</a></span><span class='op'>(</span><span class='va'>AETOXGR</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>Group</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise</a></span><span class='op'>(</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/context.html'>n</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>    <span class='fu'><a href='https://tibble.tidyverse.org/reference/enframe.html'>deframe</a></span><span class='op'>(</span><span class='op'>)</span></span>
<span>  </span>
<span>  <span class='va'>data</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>Group</span> <span class='op'>==</span> <span class='va'>treatment</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>  </span>
<span>    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>SUBJID</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>    <span class='op'>{</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span></span>
<span>      <span class='st'>"All\n"</span> <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/slice.html'>slice</a></span><span class='op'>(</span><span class='va'>.</span>, <span class='fu'><a href='https://rdrr.io/r/base/which.min.html'>which.max</a></span><span class='op'>(</span><span class='va'>AETOXGR</span><span class='op'>)</span><span class='op'>)</span>,</span>
<span>      <span class='st'>"Fatal\n"</span> <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>.</span>, <span class='va'>AEOUT</span> <span class='op'>==</span> <span class='st'>"FATAL"</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>        <span class='fu'><a href='https://dplyr.tidyverse.org/reference/slice.html'>slice</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/which.min.html'>which.max</a></span><span class='op'>(</span><span class='va'>AETOXGR</span><span class='op'>)</span><span class='op'>)</span>,</span>
<span>      <span class='st'>"Death cause\n"</span> <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>.</span>, <span class='va'>DTHCAUS</span> <span class='op'>==</span> <span class='st'>"ADVERSE EVENT"</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>        <span class='fu'><a href='https://dplyr.tidyverse.org/reference/slice.html'>slice</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/which.min.html'>which.max</a></span><span class='op'>(</span><span class='va'>AETOXGR</span><span class='op'>)</span><span class='op'>)</span>,</span>
<span>      <span class='st'>"Serious\n"</span> <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>.</span>, <span class='va'>AESER</span> <span class='op'>==</span> <span class='st'>"Y"</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>        <span class='fu'><a href='https://dplyr.tidyverse.org/reference/slice.html'>slice</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/which.min.html'>which.max</a></span><span class='op'>(</span><span class='va'>AETOXGR</span><span class='op'>)</span><span class='op'>)</span></span>
<span>        <span class='op'>)</span><span class='op'>}</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>      <span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>lapply</a></span><span class='op'>(</span><span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/pull.html'>pull</a></span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>SUBJID</span><span class='op'>)</span> <span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>      <span class='fu'><a href='https://gaospecial.github.io/ggVennDiagram/reference/ggVennDiagram.html'>ggVennDiagram</a></span><span class='op'>(</span></span>
<span>        label <span class='op'>=</span> <span class='st'>"percent"</span></span>
<span>        <span class='op'>)</span> <span class='op'>+</span></span>
<span>      <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_brewer.html'>scale_fill_distiller</a></span><span class='op'>(</span></span>
<span>        palette <span class='op'>=</span> <span class='st'>"BuPu"</span>, </span>
<span>        direction <span class='op'>=</span> <span class='fl'>1</span></span>
<span>        <span class='op'>)</span> <span class='op'>+</span></span>
<span>        <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span></span>
<span>        title <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste</a></span><span class='op'>(</span><span class='va'>treatment</span><span class='op'>)</span>,</span>
<span>        subtitle <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"N = "</span>, <span class='va'>patients_n</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste</a></span><span class='op'>(</span><span class='va'>treatment</span><span class='op'>)</span><span class='op'>]</span> <span class='op'>)</span></span>
<span>        <span class='op'>)</span> <span class='op'>+</span></span>
<span>      <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span></span>
<span>        plot.title <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span></span>
<span>          size <span class='op'>=</span> <span class='fl'>12</span>,</span>
<span>          hjust <span class='op'>=</span> <span class='fl'>0.5</span></span>
<span>          <span class='op'>)</span>,</span>
<span>        plot.subtitle <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span></span>
<span>          hjust <span class='op'>=</span> <span class='fl'>0.5</span></span>
<span>          <span class='op'>)</span>,</span>
<span>        legend.position <span class='op'>=</span> <span class='st'>"none"</span></span>
<span>        <span class='op'>)</span></span>
<span>      <span class='op'>}</span></span>
<span></span>
<span><span class='co'># Generate and combine Venn diagrams</span></span>
<span></span>
<span><span class='va'>p5A</span> <span class='op'>&lt;-</span> </span>
<span>  <span class='fu'>drawVenn_fatalAE</span><span class='op'>(</span><span class='va'>dummyAEData_ed</span>, <span class='st'>"Placebo - Placebo"</span><span class='op'>)</span> <span class='op'>+</span> </span>
<span>  <span class='fu'><a href='https://patchwork.data-imaginist.com/reference/plot_spacer.html'>plot_spacer</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>drawVenn_fatalAE</span><span class='op'>(</span><span class='va'>dummyAEData_ed</span>, <span class='st'>"Drug X - Placebo"</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://patchwork.data-imaginist.com/reference/plot_layout.html'>plot_layout</a></span><span class='op'>(</span>widths <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fl'>0.1</span>, <span class='fl'>1</span><span class='op'>)</span></span>
<span>  <span class='op'>)</span></span>
<span></span>
<span><span class='va'>p5B</span> <span class='op'>&lt;-</span></span>
<span>  <span class='fu'>drawVenn_fatalAE</span><span class='op'>(</span><span class='va'>dummyAEData_ed</span>, <span class='st'>"Placebo - Drug X"</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://patchwork.data-imaginist.com/reference/plot_spacer.html'>plot_spacer</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>drawVenn_fatalAE</span><span class='op'>(</span><span class='va'>dummyAEData_ed</span>, <span class='st'>"Drug X - Drug X"</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://patchwork.data-imaginist.com/reference/plot_layout.html'>plot_layout</a></span><span class='op'>(</span>widths <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fl'>0.1</span>, <span class='fl'>1</span><span class='op'>)</span></span>
<span>  <span class='op'>)</span></span>
<span></span>
<span><span class='va'>p5A</span> <span class='op'>/</span> <span class='va'>p5B</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://patchwork.data-imaginist.com/reference/plot_annotation.html'>plot_annotation</a></span><span class='op'>(</span></span>
<span>    title <span class='op'>=</span> <span class='st'>'Frequency of patients who suffered "Fatal" and/or "Cause of death" adverse events'</span>,</span>
<span>    caption <span class='op'>=</span> <span class='st'>'What is the difference between AEs recorded in AEOUT and DTHCAUS? \nIf "fatal adverse events", represent actual deaths, than their frequency appears extremely high. \nOn the other hand, if "cause of death" represents real fatal events, why is there so little overlap with "fatal" or "serious" adverse events? \nAll: all whole treatment group, Fatal: AEOUT = "Fatal", Death cause: DTHCAUS = "Y", Serious = AESER = "Y"'</span>, </span>
<span>    theme <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span></span>
<span>    plot.title <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span></span>
<span>      size <span class='op'>=</span> <span class='fl'>12</span>,</span>
<span>      hjust <span class='op'>=</span> <span class='fl'>0.5</span>,</span>
<span>      vjust <span class='op'>=</span> <span class='fl'>3.5</span></span>
<span>      <span class='op'>)</span>,   </span>
<span>    plot.caption <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span></span>
<span>      size <span class='op'>=</span> <span class='fl'>10</span>,</span>
<span>      hjust <span class='op'>=</span> <span class='fl'>0.5</span>,</span>
<span>      vjust <span class='op'>=</span> <span class='op'>-</span><span class='fl'>2</span></span>
<span>      <span class='op'>)</span>,</span>
<span>    plot.margin <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/grid/unit.html'>unit</a></span><span class='op'>(</span></span>
<span>      <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fl'>1</span>, <span class='fl'>1</span> , <span class='fl'>1</span><span class='op'>)</span>, <span class='st'>"cm"</span></span>
<span>      <span class='op'>)</span></span>
<span>    <span class='op'>)</span></span>
<span>  <span class='op'>)</span></span></code></pre>
</div>
</div>
<p><a href="#example10">Back to blog</a></p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>


<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom">
  <h3 id="citation">Citation</h3>
  <p>For attribution, please cite this work as</p>
  <pre class="citation-appendix short">SIG (2025, Feb. 12). VIS-SIG Blog: Wonderful Wednesdays February 2025 (59). Retrieved from https://graphicsprinciples.github.io/posts/2025-02-12-wonderful-wednesday-february-2025/</pre>
  <p>BibTeX citation</p>
  <pre class="citation-appendix long">@misc{sig2025wonderful,
  author = {SIG, PSI VIS},
  title = {VIS-SIG Blog: Wonderful Wednesdays February 2025 (59)},
  url = {https://graphicsprinciples.github.io/posts/2025-02-12-wonderful-wednesday-february-2025/},
  year = {2025}
}</pre>
</div>
<!--/radix_placeholder_appendices-->
<!--radix_placeholder_navigation_after_body-->
<!--/radix_placeholder_navigation_after_body-->

</body>

</html>
